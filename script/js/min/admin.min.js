"use strict";!function(e){function t(e,t=!1){return pt.infoBottom(e,t)}function i(e,t="info",i=!1,s="",a="",n=!1,o=!1,r=!1){return pt.infoPanel(e,t,i,s,a,n,o,r)}function s(e){return pt.activeUser(e)}function a(e){return pt.loading(e)}function n(e=!0,t=!0){return pt.loadingGlobal(e,t)}function o(e){return SB_TRANSLATIONS&&e in SB_TRANSLATIONS?SB_TRANSLATIONS[e]:e}function r(){typeof caches!==et&&caches.delete("sb-pwa-cache")}function l(e,t){pt.collapse(e,t)}function c(t,i){let s=e(t).parent().find("i"),a=e(t).val();SBF.search(a,()=>{s.sbLoading(!0),i(a,s)})}function d(t,i=!1,s=0){if(i)return e(t).scrollTop()+e(t).innerHeight()>=e(t)[0].scrollHeight-1;e(t).scrollTop(e(t)[0].scrollHeight-s)}function u(t=!1){if(!st){if(!1===it)return it=!0,void e.getScript(SB_URL+"/vendor/editorjs.js",()=>{u(t)});p(),st=!0,it=new EditorJS({data:h(t)?{time:Date.now(),blocks:[t?{id:"sb",type:"raw",data:{html:t}}:{id:"sb",type:"paragraph",data:{text:""}}]}:t,i18n:{messages:{ui:{blockTunes:{toggler:{"Click to tune":o("Click to tune")}},inlineToolbar:{converter:{"Convert to":o("Convert to")}},toolbar:{toolbox:{Add:o("Add")}}},toolNames:{Text:o("Text"),Heading:o("Heading"),List:o("List"),Image:o("Image"),Code:o("Code"),"Raw HTML":o("Raw HTML"),Bold:o("Bold"),Italic:o("Italic"),Link:o("Link")},tools:{list:{Ordered:o("Ordered"),Unordered:o("Unordered")}},blockTunes:{delete:{Delete:o("Delete")},moveUp:{"Move up":o("Move up")},moveDown:{"Move down":o("Move down")}}},direction:k.hasClass("sb-rtl")?"rtl":"ltr"},tools:{list:{class:List,inlineToolbar:!0},image:{class:ImageTool,config:{uploader:{uploadByFile(t){let i=new FormData;return i.append("file",t),new Promise(t=>{e.ajax({url:SB_URL+"/include/upload.php",cache:!1,contentType:!1,processData:!1,data:i,type:"POST",success:function(e){"success"==(e=JSON.parse(e))[0]?t({success:1,file:{url:e[1]}}):console.log(e)}})})}}}},divider:class{static get toolbox(){return{title:"Divider",icon:'<svg width="14" height="14" xmlns="http://www.w3.org/2000/svg"><path d="M2 7h10v1H2z" /></svg>'}}render(){const e=document.createElement("hr");return e.classList.add("ce-divider"),e}save(){}},info:class{static get toolbox(){return{title:"Info",icon:'<svg width="16" height="16" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="4" width="12" height="8" rx="2" ry="2" stroke="currentColor" fill="none" stroke-width="1.5"/></svg>'}}static get tunes(){return[{name:"ce-yellow"},{name:"ce-green"},{name:"ce-red"},{name:"ce-brown"},{name:"ce-blue"},{name:"ce-gray"}]}render(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("ce-info-block");const e=document.createElement("div");return e.classList.add("editor-box-input"),e.contentEditable=!0,e.innerHTML=this.data&&this.data.text?this.data.text:"",this.wrapper.classList.add(this.data.color?this.data.color:"ce-yellow"),this.wrapper.appendChild(e),this.input=e,this.wrapper}save(e){return{text:e.querySelector(".editor-box-input").innerHTML.trim(),color:this.color}}renderSettings(){const e=document.createElement("div");return["ce-yellow","ce-green","ce-black","ce-blue","ce-red","ce-gray"].forEach(t=>{const i=document.createElement("button");i.type="button",i.classList.add("cdx-settings-button"),t===this.color&&i.classList.add("cdx-settings-button--active"),i.innerHTML=`<svg width="16" height="16" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="2" width="12" height="12" rx="3" ry="3" fill="${{"ce-yellow":"#fcde66","ce-green":"#90c66f","ce-red":"#c44837","ce-black":"#6e6e6e","ce-gray":"#a9a9a9","ce-blue":"#8ab2d6"}[t]}" /></svg>`,i.addEventListener("click",()=>{this.color=t,this.wrapper.classList.remove("ce-yellow","ce-green","ce-red","ce-gray","ce-black","ce-blue"),this.wrapper.classList.add(this.color),Array.from(e.children).forEach(e=>e.classList.remove("cdx-settings-button--active")),i.classList.add("cdx-settings-button--active")}),e.appendChild(i)}),e}constructor({data:e}){this.data=e||{},this.color=this.data.color||"ce-yellow"}},header:Header,code:CodeTool,raw:RawTool},onReady:()=>{st=!1,Oe=!0,qe=!1},onChange:()=>{Oe?Oe=!1:qe=!0},minHeight:50})}}function p(){typeof it.destroy!==et&&(it.destroy(),it=!1)}function h(e){return"string"==typeof e}function f(e){tt||window.history.pushState("","",e)}function g(){return SB_ADMIN_SETTINGS.cloud?"&cloud="+SB_ADMIN_SETTINGS.cloud.token:""}function b(e){return e.replace("https://","").replace("http://","").replace("www.","").replace(/\/$/,"")}function v(e){SBF.search(e,()=>{let t="",i=!(e.length>1),s=Ee.find(".sb-replies-list > ul"),a=`<li class="sb-no-results">${o("No results found.")}</li>`;for(var n=0;n<Ne.length;n++){let s=Ne[n]["reply-name"];(i||s.toLowerCase().includes(e)||s.replaceAll("-"," ").toLowerCase().includes(e)||Ne[n]["reply-text"].toLowerCase().includes(e))&&(t+=`<li><div>${s}</div><div>${Ne[n]["reply-text"]}</div></li>`)}if(s.html(t),i||!SB_ADMIN_SETTINGS.dialogflow&&!SB_ADMIN_SETTINGS.chatbot_features)t||s.html(a);else{let i=s.closest(".sb-popup").find(".sb-icon-search");i.sbLoading(!0),SB_ADMIN_SETTINGS.dialogflow?nt.dialogflow.getIntents(n=>{let o=nt.dialogflow.searchIntents(e,!0),r="";for(var l=0;l<o.length;l++){let e=o[l].messages[0].text;e&&e.text&&(r+=`<li><div>${o[l].displayName}</div><div>${o[l].messages[0].text.text[0]}</div></li>`)}s.html(r?t+r:t||a),i.sbLoading(!1)}):SBF.ajax({function:"open-ai-message",model:SB_ADMIN_SETTINGS.open_ai_model,message:e},e=>{s.html(!e[1]||e[5]&&e[5].unknow_answer?t||a:`${t}<li><div></div><div>${e[1]}</div></li>`),i.sbLoading(!1)})}})}function m(e){let i=k.find("#sb-whatsapp-send-template-box");n(),SBF.ajax({function:"whatsapp-get-templates"},s=>{let a='<option value=""></option>',o=s[0],r="twilio"==o;if((s=s[1]).error)return t(s.error.message,"error");if(!Array.isArray(s))return t(s,"error");for(var l=0;l<s.length;l++)"official"!=o||"APPROVED"!=s[l].status||SB_ACTIVE_AGENT.department&&s[l].department.length&&!s[l].department.includes(SB_ACTIVE_AGENT.department)||(a+=`<option value="${s[l].name}" data-languages="${s[l].languages}" data-phone-id="${s[l].phone_number_id}">${s[l].name} (${s[l].label})</option>`),r&&(a+=`<option value="${s[l].sid}">${s[l].friendly_name}</option>`);i.attr("data-provider",o),i.find("#sb-whatsapp-send-template-list").html(a),SBForm.clear(i),i.find(".sb-direct-message-users").val(e.length?e.join(","):"all"),i.find(".sb-bottom > div").html(""),i.find(".sb-loading").sbLoading(!1),n(!1),i.sbShowLightbox()})}function _(e,t,s){window.open(e),i(`${o("For security reasons, delete the file after downloading it. Close this window to automatically delete it. File location:")}<pre>${e}</pre>`,"info",!1,t,s)}function S(){Ae=!1,Te=!1,setTimeout(()=>{Be&&(Be[1].css("transform",""),Be[1].removeClass("sb-touchmove"))},100)}function w(e){return C.find(`[data-conversation-id="${e}"]`)}function y(){SBF.ajax({function:"get-conversations"},e=>{e.length||A.find(".sb-board").addClass("sb-no-conversation"),dt.populateList(e),ze&&A.find(".sb-admin-list").sbActive(!0),SBF.getURL("conversation")?(A.sbActive()||x.find(".sb-admin-nav #sb-conversations").click(),dt.openConversation(SBF.getURL("conversation"))):ze||SBF.getURL("user")||SBF.getURL("setting")||SBF.getURL("report")||SBF.getURL("area")&&"conversations"!=SBF.getURL("area")||setTimeout(()=>{dt.clickFirst()},100),dt.startRealTime(),dt.datetime_last_conversation=SB_ADMIN_SETTINGS.now_db,n(!1)}),SBF.serviceWorker.init(),SB_ADMIN_SETTINGS.push_notifications&&SBF.serviceWorker.initPushNotifications(),setInterval(function(){SBF.ajax({function:"get-active-user",db:!0},e=>{e||SBF.reset()})},36e5)}var k,x,B,A,T,$,I,C,F,E,N,L,D,M,R,j,G,U,P,q,O,H,V,W,z,J,Y,X,Z,Q,K,ee,te,ie,se,ae,ne,oe,re,le,ce,de,ue,pe,he,fe,ge,be,ve,me,_e,Se,we,ye,ke,xe,Be,Ae,Te,$e,Ie,Ce,Fe=[],Ee=!1,Ne=!1,Le=!1,De=!1,Me=1,Re=1,je={},Ge=1,Ue=1,Pe=!0,qe=!1,Oe=!0,He=!1,Ve=[],We=[],ze=e(window).width()<465,Je={last:0,header:!0,always_hidden:!1},Ye="localhost"===location.hostname||"127.0.0.1"===location.hostname,Xe=new Date,Ze=!1,Qe=!0,Ke=!1,et="undefined",tt=!1,it=!1,st=!1,at="conversations";e.fn.miniTip=function(t){var i=e.extend({title:"",content:!1,delay:300,anchor:"n",event:"hover",fadeIn:200,fadeOut:200,aHide:!0,maxW:"250px",offset:5,stemOff:0,doHide:!1},t);k&&0==k.find("#miniTip").length&&k.append('<div id="miniTip" class="sb-tooltip"><div></div></div>');var s=k.find("#miniTip"),a=s.find("div");return i.doHide?(s.stop(!0,!0).fadeOut(i.fadeOut),!1):this.each(function(){var t=e(this),n=i.content?i.content:t.attr("title");if(""!=n&&void 0!==n){window.delay=!1;var o=!1,r=!0;i.content||t.removeAttr("title"),"hover"==i.event?(t.hover(function(){s.removeAttr("click"),r=!0,l.call(this)},function(){r=!1,c()}),i.aHide||s.hover(function(){o=!0},function(){o=!1,setTimeout(function(){!r&&!s.attr("click")&&c()},20)})):"click"==i.event&&(i.aHide=!0,t.click(function(){return s.attr("click","t"),s.data("last_target")!==t?l.call(this):"none"==s.css("display")?l.call(this):c(),s.data("last_target",t),e("html").unbind("click").click(function(t){"block"==s.css("display")&&!e(t.target).closest("#miniTip").length&&(e("html").unbind("click"),c())}),!1}));var l=function(){i.show&&i.show.call(this,i),i.content&&""!=i.content&&(n=i.content),a.html(n),i.render&&i.render(s),s.hide().width("").width(s.width()).css("max-width",i.maxW);var o=t.is("area");if(o){var r,l=[],c=[],d=t.attr("coords").split(",");function u(e,t){return e-t}for(r=0;r<d.length;r++)l.push(d[r++]),c.push(d[r]);var p=t.parent().attr("name"),h=e("img[usemap=\\#"+p+"]").offset(),f=parseInt(h.left,10)+parseInt((parseInt(l.sort(u)[0],10)+parseInt(l.sort(u)[l.length-1],10))/2,10),g=parseInt(h.top,10)+parseInt((parseInt(c.sort(u)[0],10)+parseInt(c.sort(u)[c.length-1],10))/2,10)}else g=parseInt(t.offset().top,10),f=parseInt(t.offset().left,10);var b=o?0:parseInt(t.outerWidth(),10),v=o?0:parseInt(t.outerHeight(),10),m=s.outerWidth(),_=s.outerHeight(),S=Math.round(f+Math.round((b-m)/2)),w=Math.round(g+v+i.offset+8),y=Math.round(m-16)/2-parseInt(s.css("borderLeftWidth"),10),k=0,x=f+b+m+i.offset+8>parseInt(e(window).width(),10),B=m+i.offset+8>f,A=_+i.offset+8>g-e(window).scrollTop(),T=g+v+_+i.offset+8>parseInt(e(window).height()+e(window).scrollTop(),10),$=i.anchor;B||"e"==i.anchor&&!x?"w"!=i.anchor&&"e"!=i.anchor||($="e",k=Math.round(_/2-8-parseInt(s.css("borderRightWidth"),10)),y=-8-parseInt(s.css("borderRightWidth"),10),S=f+b+i.offset+8,w=Math.round(g+v/2-_/2)):(x||"w"==i.anchor&&!B)&&("w"!=i.anchor&&"e"!=i.anchor||($="w",k=Math.round(_/2-8-parseInt(s.css("borderLeftWidth"),10)),y=m-parseInt(s.css("borderLeftWidth"),10),S=f-m-i.offset-8,w=Math.round(g+v/2-_/2))),T||"n"==i.anchor&&!A?"n"!=i.anchor&&"s"!=i.anchor||($="n",k=_-parseInt(s.css("borderTopWidth"),10),w=g-(_+i.offset+8)):(A||"s"==i.anchor&&!T)&&("n"!=i.anchor&&"s"!=i.anchor||($="s",k=-8-parseInt(s.css("borderBottomWidth"),10),w=g+v+i.offset+8)),"n"==i.anchor||"s"==i.anchor?m/2>f?(S=S<0?y+S:y,y=0):f+m/2>parseInt(e(window).width(),10)&&(S-=y,y*=2):A?(w+=k,k=0):T&&(w-=k,k*=2),delay&&clearTimeout(delay),delay=setTimeout(function(){s.css({"margin-left":S+"px","margin-top":w+"px"}).stop(!0,!0).fadeIn(i.fadeIn)},i.delay),s.attr("class","sb-tooltip "+$)},c=function(){(!i.aHide&&!o||i.aHide)&&(delay&&clearTimeout(delay),delay=setTimeout(function(){d()},i.delay))},d=function(){!i.aHide&&!o||i.aHide?(s.stop(!0,!0).fadeOut(i.fadeOut),i.hide&&i.hide.call(this)):setTimeout(function(){c()},200)}}})},e.fn.sbLanguageSwitcher=function(t=[],i="",s=!1){let a=`<div class="sb-language-switcher" data-source="${i}">`,n=[],r=e(this).hasClass("sb-language-switcher-cnt")?e(this):e(this).find(".sb-language-switcher-cnt");for(var l=0;l<t.length;l++){let e=h(t[l])?t[l]:t[l][0],i=!(h(t[l])||!t[l][1])&&t[l][1];n.includes(e)||(a+=`<span ${s==e?'class="sb-active" ':""}data-language="${e}"${i?' data-id="'+i+'"':""}><i class="sb-icon-close"></i><img src="${SB_URL}/media/flags/${e.toLowerCase()}.png" /></span>`,n.push(e))}return r.find(".sb-language-switcher").remove(),r.append(a+`<i data-sb-tooltip="${o("Add translation")}" class="sb-icon-plus"></i></div>`),r.sbInitTooltips(),this},e.fn.sbShowLightbox=function(t=!1,i=""){return k.find(".sb-lightbox").sbActive(!1),ke.sbActive(!0),e(this).sbActive(!0),t?e(this).addClass("sb-popup-lightbox").attr("data-action",i):e(this).css({"margin-top":e(this).outerHeight()/-2+"px","margin-left":e(this).outerWidth()/-2+"px"}),e("body").addClass("sb-lightbox-active"),setTimeout(()=>{pt.open_popup=this},500),this.preventDefault,this},e.fn.sbHideLightbox=function(){return e(this).find(".sb-lightbox,.sb-popup-lightbox").sbActive(!1).removeClass("sb-popup-lightbox").removeAttr("data-action"),ke.sbActive(!1),e("body").removeClass("sb-lightbox-active"),pt.open_popup=!1,this},e.fn.sbInitTooltips=function(){return e(this).find("[data-sb-tooltip]").each(function(){e(this).miniTip({content:e(this).attr("data-sb-tooltip"),anchor:"s",delay:500})}),this};var nt={dialogflow:{intents:!1,qea:[],dialogflow_languages:[],original_response:!1,smart_reply_busy:!1,smartReply:function(e=!1){let t=SBChat.conversation.id;this.smart_reply_busy!=t&&(this.smart_reply_busy=t,SBF.ajax({function:"dialogflow-smart-reply",message:e,conversation_id:t,dialogflow_languages:this.dialogflow_languages},e=>{if(this.smart_reply_busy=!1,SBChat.conversation.id&&t===SBChat.conversation.id){let t=e.suggestions,s="",a=Math.abs(T[0].scrollTop-(T[0].scrollHeight-T[0].offsetHeight))<=1,n=!(!SBChat.conversation||!SBChat.conversation.getLastMessage())&&SBChat.conversation.getLastMessage().message;for(var i=0;i<t.length;i++)t[i]!=n&&(s+=`<span>${SBF.escape(t[i])}</span>`);R.html(s),a&&SBChat.scrollBottom()}e.dialogflow_languages&&(this.dialogflow_languages=e.dialogflow_languages)}))},showCreateIntentBox:function(e){let t="",i=SBChat.conversation.getMessage(e),s=i.message;if(SBF.isAgent(i.get("user_type")))t=SBChat.conversation.getLastUserMessage(i.get("index")),t=t&&t.payload("sb-human-takeover")?SBChat.conversation.getLastUserMessage(t.get("index")).message:t.message;else{t=s;let e=SBChat.conversation.getNextMessage(i.id,"agent");e&&(s=e.message)}M.hasClass("sb-dialogflow-disabled")?(SBF.ajax({function:"open-ai-get-qea-training"},e=>{let t='<option value="">'+o("New Q&A")+"</option>";for(var i=0;i<e.length;i++)this.qea=e,t+=`<option value="${i}">${e[i][0][0]}</option>`;M.find("#sb-qea-select").html(t)}),nt.openAI.generateQuestions(t)):this.getIntents(e=>{let i='<option value="">'+o("New Intent")+"</option>";for(var s=0;s<e.length;s++)i+=`<option value="${e[s].name}">${e[s].displayName}</option>`;M.find("#sb-intents-select").html(i),nt.openAI.generateQuestions(t)}),M.attr("data-message-id",i.id),M.find(".sb-type-text:not(.sb-first)").remove(),M.find(".sb-type-text input").val(t),M.find("#sb-intents-select,#sb-qea-select").val(""),M.find(".sb-search-btn").sbActive(!1).find("input").val(""),this.searchIntents(""),this.original_response=s,M.find("textarea").val(s),M.sbShowLightbox()},submitIntent:function(i){if(a(i))return;let s=[],n=M.find("textarea").val(),o=M.find("#sb-intents-select,#sb-qea-select").val(),r=M.find("#sb-train-chatbots").val(),l="open-ai"==r||M.hasClass("sb-dialogflow-disabled");if(M.find(".sb-type-text input").each(function(){e(this).val()&&s.push(e(this).val())}),!n&&!o||0==s.length)SBForm.showErrorMessage(M,"Please insert the bot response and at least one user expression."),e(i).sbLoading(!1);else{let a;l&&(o?(this.qea[o][0]=this.qea[o][0].concat(s),a=this.qea[o]):a=[[s,n]]),SBF.ajax({function:l?"open-ai-qea-training":o?"dialogflow-update-intent":"dialogflow-create-intent",questions_answers:a,expressions:s,response:n,agent_language:M.find(".sb-dialogflow-languages select").val(),conversation_id:SBChat.conversation.id,intent_name:o,update_index:o,services:r,language:M.find(".sb-dialogflow-languages select").val()},s=>{e(i).sbLoading(!1),!0===s?(k.sbHideLightbox(),t("Training completed")):SBForm.showErrorMessage(M,s.error&&s.error.message?s.error&&s.error.message:"Error")})}},getIntents:function(e){!1===this.intents?SBF.ajax({function:"dialogflow-get-intents"},t=>{this.intents=Array.isArray(t)?t:[],e(this.intents)}):e(this.intents)},searchIntents:function(e,t=!1){if(M.hasClass("sb-dialogflow-disabled")){let t=!(e.length>1),s=t?`<option value="">${o("New Q&A")}</option>`:"";e=e.toLowerCase();for(i=0;i<this.qea.length;i++)(t||this.qea[i][0].join("").toLowerCase().includes(e)||this.qea[i][1].toLowerCase().includes(e))&&(s+=`<option value="${i}">${this.qea[i][0][0]}</option>`);M.find("#sb-qea-select").html(s).change(),t&&M.find("textarea").val(this.original_response)}else{let n=!(e.length>1),r=n?`<option value="">${o("New Intent")}</option>`:"",l=this.intents,c=[];e=e.toLowerCase();for(var i=0;i<l.length;i++){let o=n||l[i].displayName.toLowerCase().includes(e);if(!o&&l[i].trainingPhrases){let t=l[i].trainingPhrases;for(var s=0;s<t.length;s++){for(var a=0;a<t[s].parts.length;a++)if(t[s].parts[a].text.toLowerCase().includes(e)){o=!0;break}if(o)break}}o&&(t?c.push(l[i]):r+=`<option value="${l[i].name}">${l[i].displayName}</option>`)}if(t)return c;M.find("#sb-intents-select").html(r).change(),e||M.find("textarea").val(this.original_response)}},previewIntentDialogflow:function(e){let t="",s=this.getIntent(e);if(s){let e=s.trainingPhrases?s.trainingPhrases:[],o=e.length;if(o>1){for(var a=0;a<o;a++)for(var n=0;n<e[a].parts.length&&(t+=`<span>${e[a].parts[n].text}</span>`,15!=n);n++);i(t,"info",!1,"intent-preview-box","",o>10)}}},previewIntent:function(e){if(e){let s="",a=this.qea[e];if(a[0].length>1){let e=a[0].length>15?15:a[0].length;for(var t=0;t<e;t++)s+=`<span>${a[0][t]}</span>`;i(s,"info",!1,"qea-preview-box","",e>10)}}},getIntent:function(e){for(var t=0;t<this.intents.length;t++)if(this.intents[t].name==e)return this.intents[t];return!1},translate:function(e,t,i,s,a){e.length&&SBF.ajax({function:"google-translate",strings:e,language_code:t,message_ids:s,conversation_id:a},e=>{if(!Array.isArray(e))return SBF.error(JSON.stringify(e),"SBApps.dialogflow.translate"),!1;i(e)})}},openAI:{urls_history:[],progress:1,rewriteButton:function(e){j.length&&j.sbActive(e.length>2&&e.indexOf(" "))},rewrite:function(e,t){SBF.ajax({function:"open-ai-message",model:SB_ADMIN_SETTINGS.open_ai_model,message:e,extra:{rewrite:!0,language:SB_ADMIN_SETTINGS.active_agent_language}},i=>{i[0]||console.error("OpenAI: "+JSON.stringify(i[1])),dt.previous_editor_text=e,t(i)})},troubleshoot:function(){let e=SB_ADMIN_SETTINGS.open_ai_chatbot_status;return!0!==e&&t("inactive"==e?"Enable the chatbot in Settings > Artificial Intelligence > OpenAI > Chatbot.":"key"==e?"Enter the OpenAI API key in Settings > Artificial Intelligence > OpenAI > API key.":"The training data is ignored. Change the chatbot mode in Settings > Artificial Intelligence > OpenAI > Chatbot mode.","error"),e},getCode:{set_data:function(e){let t="",i=this.select_user_details();e&&e.length||(e=[["",""]]);for(var s=0;s<e.length;s++)t+=`<div class="repeater-item"><div>${i.replace(`"${e[s][0]}"`,`"${e[s][0]}" selected`)}<div class="sb-setting"><input type="url" placeholder="${o("Enter the value")}" value="${e[s][1]}"></div></div><i class="sb-icon-close"></i></div>`;return this.repeater_("Data",t)},actions:function(e){let t=[["tags","Assign tags"],["department","Assign a department"],["agent","Assign an agent"],["redirect","Go to URL"],["open_article","Show an article"],["transcript","Download transcript"],["transcript_email","Email transcript"],["send_email","Send email to user"],["send_email_agents","Send email to agents"],["archive_conversation","Archive the conversation"],["human_takeover","Human takeover"]],i="",s="";e&&e.length||(e=[["tags",""]]);for(a=0;a<t.length;a++)i+=`<option value="${t[a][0]}">${o(t[a][1])}</option>`;for(var a=0;a<e.length;a++)s+=`<div class="repeater-item"><div><div class="sb-setting"><select>${i.replace(`"${e[a][0]}"`,`"${e[a][0]}" selected`)}</select></div>${this.action(e[a][0],e[a][1])}</div><i class="sb-icon-close"></i></div>`;return this.repeater_("Actions",s)},action:function(e,t){let i={department:"number",agent:"number",redirect:"url"};return["send_email_agents","send_email","open_article","redirect","agent","department","tags"].includes(e)?`<div class="sb-setting"><input type="${i[e]?i[e]:"text"}" value="${t}" placeholder="${o({tags:"Enter tag names, separated by commas",department:"Enter the department ID",agent:"Enter the agent ID",redirect:"Enter the URL",open_article:"Enter the article ID",send_email:"Enter a message",send_email_agents:"Enter a message"}[e])}" value="${t}"></div>`:""},select_user_details:function(){let e='<div class="sb-setting"><select>',t=[["full_name","Name"],["email","Email"],["password","Password"]].concat(ct.getExtraDetailsList());for(var i=0;i<t.length;i++)e+=`<option value="${t[i][0]}">${o(t[i][1])}</option>`;return e+"</select></div>"},repeater_:function(e,t){return`<div class="sb-title">${o(e)}</div><div data-type="repeater" class="sb-setting sb-type-repeater"><div class="input"><div class="sb-repeater sb-repeater-block-${SBF.stringToSlug(e)}">${t}</div><div class="sb-btn sb-btn-white sb-repeater-add sb-icon"><i class="sb-icon-plus"></i>${o("Add new item")}</div></div></div>`}},generateQuestions:function(e){if(SB_ADMIN_SETTINGS.open_ai_user_expressions&&e){let t=M.find('[data-value="add"]');t.sbLoading(!0),M.find(".sb-open-ai-intent").remove(),SBF.ajax({function:"open-ai-user-expressions",message:e},e=>{let i="";for(var s=0;s<e.length;s++)e[s]&&(i+=`<div class="sb-setting sb-type-text sb-open-ai-intent"><input type="text" value="${e[s].replace(/"/g,"")}"></div>`);i&&M.find("> div > .sb-type-text").last().after(i),t.sbLoading(!1)})}},flows:{flows:[],set:function(e){if("string"==typeof e)(e=e.trim().replaceAll('"',"").replaceAll("_","-"))&&(e={name:e.replace(/[^a-zA-Z\u00C0-\u1FFF\u2C00-\uD7FF\uAC00-\uD7A3]/g,""),label:e,steps:[[[{type:"start",start:"message",message:"",conditions:[],disabled:!1}]],[[]]]});else for(var t=0;t<this.flows.length;t++)if(this.flows[t].name==e.name)return this.flows[t]=e,this.show(e.name),!0;this.flows.push(e),ce.find(".sb-active").sbActive(!1),ce.append(this.navCode(e.name,e.label,!0)),this.show(e.name)},get:function(e=!1){e||(e=this.getActiveName());for(var t=0;t<this.flows.length;t++)if(this.flows[t].name==e)return this.flows[t].steps||(this.flows[t].steps=[]),this.flows[t];return!1},show:function(t=!1){t||(t=this.getActiveName());let i,s=this.get(t),a="";if(s){let t=[],d=[];for(var n=0;n<s.steps.length;n++){let e=s.steps[n],u=0;t=d,d=[],a+="<div><div>";for(var r=0;r<e.length;r++){let s=e[r];a+='<div class="sb-flow-block-cnt">',t[r]&&(a+=`<div class="sb-flow-block-cnt-name">${t[r]}</div>`);for(var l=0;l<s.length;l++){let e=s[l].message?Array.isArray(s[l].message)?s[l].message.length?s[l].message[0].message:"":s[l].message:"";switch(e&&(e=`<div>${e.length>45?e.substring(0,45)+"...":e}</div>`),a+=`<div class="sb-flow-block" data-type="${s[l].type}"><div>${o(SBF.slugToString(s[l].type))}</div>${e}`,s[l].type){case"get_user_details":d.push(!1);break;case"condition":case"choices":case"button_list":let t="condition"==s[l].type,n=t?[o("True"),o("False")]:s[l].options;if(t){a+="<div>",i=s[l].conditions;for(c=0;c<i.length;c++)a+=`<div>${SBF.slugToString(i[c][0]+" "+i[c][1])}${i[c][2]?": "+i[c][2]:""}</div>`;a+="</div>"}a+='<div class="sb-flow-connectors">';for(c=0;c<n.length;c++)d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZ"[u]+(c+1)),a+=`<div>${n[c].replaceAll("\\,",", ")}<span>${d[d.length-1]}</span></div>`;a+="</div>",u++;break;case"video":a+=`<div>${s[l].url}</div>`;break;case"action":case"set_data":a+="<div>",i=s[l]["set_data"==s[l].type?"data":"actions"];for(var c=0;c<i.length;c++)a+=`<div>${SBF.slugToString(i[c][0])}${i[c][1]?": "+i[c][1]:""}</div>`;a+="</div>";break;case"rest_api":a+=`<div>${s[l].url}</div>`;break;case"flow_connector":a+=`<div>${s[l].flow_name}</div>`}a+="</div>"}s.length<4&&(a+='<div class="sb-flow-add-block sb-icon-plus"></div>'),a+="</div>"}a+='</div><div class="sb-flow-add-step sb-icon-plus"></div></div>'}de.html(a),e(k).find(".sb-flow-scroll").sbActive(250*s.steps.length>de.outerWidth())}},delete:function(e){for(var t=0;t<this.flows.length;t++)if(this.flows[t].name==e){let i=ce.find(`[data-value="${e}"]`);return this.flows[t].steps.forEach(e=>{e.forEach(e=>{e.forEach(e=>{e.attachments&&e.attachments.forEach(e=>{SBF.ajax({function:"delete-file",path:e})})})})}),this.flows.splice(t,1),i.sbActive()&&(i.prev().length?i.prev().click():i.next().length?i.next().click():de.html("")),i.remove(),!0}return!1},save:function(e=!1){SBF.ajax({function:"open-ai-flows-save",flows:JSON.stringify(this.flows)},t=>{e(t)})},navCode:function(e,t,i=!1){return`<li${i?' class="sb-active"':""} data-value="${e}">${t||e}<i class="sb-icon-delete"></i></li>`},getActive:function(){return ce.find(".sb-active")},getActiveName:function(){return this.getActive().attr("data-value")},getActiveIndex:function(){return this.getActive().index()},steps:{get:function(e=!1,t=!1){return nt.openAI.flows.get(e).steps[t||this.getActiveIndex()]},getActiveIndex:function(){return nt.openAI.flows.blocks.getActive().parent().parent().parent().index()}},blocks:{set:function(e,t=!1,i=!1,s=!1,a=!1){let n=this.getIndexes(t,i,s,a),o=nt.openAI.flows.get(t);if(o){let i=!1;if(o.steps.length>n.step){let t=o.steps[n.step];if(t.length>n.cnt){let s=t[n.cnt];s.length>n.block&&(s[n.block]=e,i=!0)}i||(o.steps[n.step][n.cnt].push(e),i=!0)}i||o.steps.push([[e]]);let s=o.steps[n.step],a=o.steps[nt.openAI.flows.steps.getActiveIndex()+1],c=0;for(l=0;l<s.length;l++)for(var r=0;r<s[l].length;r++)switch(s[l][r].type){case"get_user_details":c+=1;break;case"choices":case"button_list":c+=s[l][r].options.length;break;case"condition":c+=2}if(a)if(a.length>c)a.splice(-1*(c-1),c);else{let e=a.length;for(e;e<c;e++)a.splice(n.cnt,0,[])}else{a=[];for(var l=0;l<c;l++)a.push([]);a.length&&o.steps.push(a)}return nt.openAI.flows.show(t),!0}return!1},get:function(e=!1,t=!1,i=!1,s=!1){let a=nt.openAI.flows.get(e);if(a){let n=this.getIndexes(e,t,i,s);return a.steps[n.step][n.cnt][n.block]}return!1},add:function(e,t=!1,i=!1,s=!1,a=!1){let n=this.getIndexes(t,i,s,a);this.set(Object.assign({button_list:{message:"",options:[]},choices:{message:"",options:[],conversational_mode:!1},message:{message:""},video:{message:"",url:""},get_user_details:{message:"",details:[]},set_data:{data:[]},action:{actions:[]},rest_api:{url:"",method:"",headers:[],body:"",save_response:[]},condition:{conditions:[]},tools:{message:"",url:"",method:"",headers:[],properties:[]},flow_connector:{flow_name:""}}[e],{type:e}),n.name,n.step,n.cnt,n.block),nt.openAI.flows.show(t),setTimeout(()=>{de.find("> div").eq(n.step).find(".sb-flow-block-cnt").eq(n.cnt).find(".sb-flow-block").eq(n.block).click()},100)},delete:function(e=!1,t=!1,i=!1,s=!1){let a=this.getIndexes(e,t,i,s);for(var n=0;n<nt.openAI.flows.flows.length;n++){let e=nt.openAI.flows.flows[n];if(a.name==e.name){if(["get_user_details","button_list","choices","condition","tools"].includes(e.steps[a.step][a.cnt][a.block].type)){let t=this.delete_(n,a.step,a.cnt),i=Object.assign({},e);for(o=0;o<t.length;o++)e.steps[t[o][0]][t[o][1]]=!1;e.steps[a.step][a.cnt].splice(a.block,1),i.steps=[];for(var o=0;o<e.steps.length;o++){let t=[];for(var r=0;r<e.steps[o].length;r++)e.steps[o][r]&&t.push(e.steps[o][r]);t.length&&i.steps.push(t)}nt.openAI.flows.flows[n]=i}else e.steps[a.step][a.cnt].splice(a.block,1);return nt.openAI.flows.show(a.name),!0}}return!1},delete_:function(e,t,i,s=[]){let a=nt.openAI.flows.blocks.getNextCntIndexes(e,t,i);for(var n=0;n<a.length;n++)s.push([t+1,a[n]]),this.delete_(e,t+1,a[n],s);return s},getActive:function(){return de.find(".sb-flow-add-block.sb-active, .sb-flow-block.sb-active")},getActiveIndex:function(){let e=this.getActiveCnt().find(".sb-flow-block"),t=e.index(this.getActive());return-1===t?e.length:t},getActiveCnt:function(){return this.getActive().parent()},getActiveCntIndex:function(){return this.getActive().parent().index()},getNextCnt:function(e,t,i,s=0){let a=this.getNextCntIndexes(e,t,i,s);return a.length>s&&nt.openAI.flows.flows[e].steps[t+1][a[s]]},getNextCntIndexes:function(e,t,i){let s=nt.openAI.flows.flows[e],a=[];if(s&&s.steps[t+1]){let e=0;for(var n=0;n<=i;n++){let l=s.steps[t][n];for(var o=0;o<l.length;o++)if("button_list"==l[o].type||"choices"==l[o].type)for(r=0;r<l[o].options.length;r++)n==i&&a.push(e),e++;else if("get_user_details"==l[o].type)n==i&&a.push(e),e++;else if("condition"==l[o].type)for(var r=0;r<2;r++)n==i&&a.push(e),e++}}return a},getPreviousCntIndex:function(e,t,i){let s=nt.openAI.flows.flows[e].steps[t-1];if(s){let e=0;for(var a=0;a<s.length;a++){let t=s[a];for(var n=0;n<t.length;n++)e+="button_list"==t[n].type||"choices"==t[n].type?t[n].options.length:"get_user_details"==t[n].type?1:"condition"==t[n].type?2:0;if(e>i)return a}return e}},getIndexes:function(e,t,i,s){return{name:e||nt.openAI.flows.getActiveName(),step:t||nt.openAI.flows.steps.getActiveIndex(),cnt:i||this.getActiveCntIndex(),block:s||this.getActiveIndex()}},activateLinkedCnts:function(t){let i=e(t).parent(),s=nt.openAI.flows.getActiveIndex(),a=i.parent().parent().index(),n=de.find("> div"),o=n.eq(a-1).find(".sb-flow-block-cnt").eq(nt.openAI.flows.blocks.getPreviousCntIndex(s,a,i.index()));if(!He){let e=n.eq(a+1).find(".sb-flow-block-cnt"),t=nt.openAI.flows.blocks.getNextCntIndexes(s,a,i.index());for(var r=0;r<t.length;r++)e.eq(t[r]).sbActive(!0)}de.find(".sb-flow-connectors > div").sbActive(!1),o.sbActive(!0).find(".sb-flow-block-cnt-name").sbActive(!0),i.find(".sb-flow-block-cnt-name").length&&o.find(".sb-flow-connectors > div").sbActive(!1).eq(parseInt(i.find(".sb-flow-block-cnt-name").html().substring(1))-1).sbActive(!0)}}},train:{urls:[],errors:[],base_url:!1,start_urls:[],sitemap_processed_urls:[],active_source:!1,history:[],training_button:!1,extract_url:[],skip_files:[],files:function(e,t=0){let i=pe.prop("files");if(t>=i.length)return e(!0);let s=i[t].name;this.isFile(s)&&!this.skip_files.includes(s)?(k.find("#sb-embeddings-box p").html(o("We are processing the source")+"<pre>"+s+"</pre><span>"+o("Only {R} sources left to complete.").replace("{R}",i.length-t)+"</span>"),pe.sbUploadFiles(i=>{"success"==(i=JSON.parse(i))[0]&&SBF.ajax({function:"open-ai-file-training",url:i[1]},i=>{this.isError(i)||this.files(e,t+1)})},t)):this.files(e,t+1)},website:function(e,t=0){if(t>=this.urls.length)return e(!0);let i=this.urls[t];i&&i.includes("http")?(k.find("#sb-embeddings-box p").html(o("We are processing the source")+"<pre>"+i+"</pre><span>"+o("Only {R} sources left to complete.").replace("{R}",this.urls.length-t)+"</span>"),i.includes(".xml")?SBF.ajax({function:"get-sitemap-urls",sitemap_url:i},i=>{Array.isArray(i)?this.urls=this.urls.concat(i):this.errors.push(i),this.website(e,t+1)}):!this.sitemap_processed_urls.includes(i)&&this.extract_url[t]?(this.sitemap_processed_urls.push(i),this.sitemap(i,i=>{this.urls=this.urls.concat(i),this.website(e,t+1)})):SBF.ajax({function:"open-ai-url-training",url:i},i=>{this.isError(i)||(i[0]||i[1].includes("http-error-404")||i[1].includes("http-error-302")||(i[1].includes("http-error")&&0===t?this.errors.push(i[2]):!0!==i[0][0]&&this.errors.push(i)),this.website(e,t+1))})):(i&&this.errors.push(o("Use a valid URL starting with http. The URL {R} is not valid.").replace("{R}",i)),this.website(e,t+1))},sitemap:function(e,t,i=[]){k.find("#sb-embeddings-box p").html(o("We are generating the sitemap")+"<pre>"+e+"</pre>"),SBF.ajax({function:"generate-sitemap",url:e},e=>{t(e)})},qea:function(e){k.find("#sb-embeddings-box p").html(o("We are processing the Q&A."));let t=ot.repeater.get(ne.find(".sb-repeater").eq(0).find("> .repeater-item")).map(e=>[e["open-ai-faq-questions"].map(e=>e.question),e["open-ai-faq-answer"],e["open-ai-faq-function-calling-url"],e["open-ai-faq-function-calling-method"],e["open-ai-faq-function-calling-headers"],!!e["open-ai-faq-function-calling-properties"].length&&e["open-ai-faq-function-calling-properties"].map(e=>[e.name,e.description,e.allowed]),e["open-ai-faq-set-data"].map(e=>[e.id,e.value])]);SBF.ajax({function:"open-ai-qea-training",questions_answers:t,reset:!0},t=>{e(t)})},articles:function(e){k.find("#sb-embeddings-box p").html(o("We are processing the articles.")),SBF.ajax({function:"open-ai-articles-training"},t=>{e(t)})},isFile:function(e){return e.includes(".pdf")||e.includes(".txt")||e.includes(".json")||e.includes(".csv")},isError:function(e){let t="chars-limit-exceeded"==e[1],s=t||e[1]&&e[1][0]&&e[1][0].error;return s&&(ie.find("#sb-train-chatbot").sbLoading(!1),i(t?o("The chatbot cannot be trained with these sources because the limit of your plan is {R} characters. Upgrade your plan to increase the number of characters.").replace("{R}",e[2]):e[1][0].error.message)),s}},playground:{last_response:!1,history:!1,deleteData:function(e="delete",t=!1,i=!1){SBF.ajax({function:"open-ai-playground-data",action:e,extra:i},i=>{"delete"==e&&(this.last_response=!1),t&&t(i)})}},init:function(){SBF.ajax({function:"open-ai-get-training-files"},e=>{let t=["",""];for(var i=0;i<e.length;i++)if(!["sb-conversations","sb-articles","sb-database","sb-flows"].includes(e[i])){let s=this.train.isFile(e[i]);t[s?1:0]+=`<tr data-url="${e[i]}"><td><input type="checkbox" /></td><td>${s?SBF.beautifyAttachmentName(e[i].split("/").pop()):b(e[i])}</td><td></td><td><i class="sb-icon-delete"></i></td></tr>`}se.html(t[1]).sbLoading(!1),ae.html(t[0]).sbLoading(!1),ie.find("#sb-chatbot-delete-website").setClass("sb-hide",!t[0])}),SBF.ajax({function:"open-ai-get-qea-training"},t=>{for(var i=0;i<t.length;i++)t[i][0]&&!Array.isArray(t[i][0])&&(t[i][0]=[t[i][0]]);let s=t.map(e=>({"open-ai-faq-questions":e[0]?e[0].map(e=>({question:e})):[""],"open-ai-faq-answer":e[1],"open-ai-faq-function-calling-url":e[2],"open-ai-faq-function-calling-method":e[3],"open-ai-faq-function-calling-headers":e[4],"open-ai-faq-function-calling-properties":e[5]&&e[5].length?e[5].map(e=>({name:e[0],description:e[1],allowed:e[2]})):[["","",""]],"open-ai-faq-set-data":e[6]&&e[6].length?e[6].map(e=>({id:e[0],value:e[1]})):[["",""]]}));s.length&&(ne.find("> div > .sb-repeater").html(ot.repeater.set(s,ne.find("> div > .sb-repeater > .repeater-item:last-child"))),ne.find(".sb-enlarger").each(function(){let t=e(this).find("select"),i=["transcript","transcript_email","human_takeover","archive_conversation"];(e(this).find("input").val()||i.includes(t.val()))&&(e(this).sbActive(!0),e(this).hasClass("sb-enlarger-function-calling")&&e(this).closest(".repeater-item").find(".sb-qea-repeater-answer").addClass("sb-hide")),t.each(function(){i.includes(e(this).val())&&e(this).parent().next().find("input").addClass("sb-hide")})}))})}},messenger:{check:function(e){return["fb","ig"].includes(e.get("source"))},send:function(e,t,i="",s=[],a,n=!1,o=!1,r=!1){SBF.ajax({function:"messenger-send-message",psid:e,facebook_page_id:t,message:i,message_id:n,attachments:s,metadata:a,reply_to:o},e=>{r&&r(e),nt.unsupportedRichMessages(i,"Messenger")})}},whatsapp:{check:function(e){return"wa"==e.get("source")},send:function(e,t="",s=[],a=!1,n=!1,o=!1,r=!1){SBF.ajax({function:"whatsapp-send-message",to:e,message:t,attachments:s,phone_id:a,reply_to:n,message_id:o},e=>{e.error&&i(e.error.message,"info",!1,"error-wa"),r&&r(e),nt.unsupportedRichMessages(t,"WhatsApp")})},activeUserPhone:function(e=s()){return!!e.getExtra("phone")&&e.getExtra("phone").value.replace("+","")}},telegram:{check:function(e){return"tg"==e.get("source")},send:function(e,t="",i=[],s=!1,a=!1,n=!1,o=!1){SBF.ajax({function:"telegram-send-message",chat_id:e,message:t,message_id:n,attachments:i,conversation_id:s,reply_to:a},e=>{o&&o(e),nt.unsupportedRichMessages(t,"Telegram")})}},viber:{check:function(e){return"vb"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"viber-send-message",viber_id:e,message:t,attachments:i},e=>{s&&s(e),nt.unsupportedRichMessages(t,"Viber")})}},zalo:{check:function(e){return"za"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"zalo-send-message",zalo_id:e,message:t,attachments:i},e=>{s&&s(e),nt.unsupportedRichMessages(t,"Zalo")})}},twitter:{check:function(e){return"tw"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"twitter-send-message",twitter_id:e,message:t,attachments:i},e=>{s&&s(e),nt.unsupportedRichMessages(t,"Twitter")})}},line:{check:function(e){return"ln"==e.get("source")},send:function(e,t="",i=[],s=!1,a=!1){SBF.ajax({function:"line-send-message",line_id:e,message:t,attachments:i,conversation_id:s},e=>{a&&a(e),nt.unsupportedRichMessages(t,"LINE")})}},wechat:{token:!1,check:function(e){return"wc"==e.get("source")},send:function(e,t="",i=[],s=!1){SBF.ajax({function:"wechat-send-message",open_id:e,message:t,attachments:i,token:this.token},e=>{Array.isArray(e)&&(this.token=e[1],e=e[0]),s&&s(e),nt.unsupportedRichMessages(t,"WeChat")})}},aecommerce:{conversationPanel:function(){let t="",i=s().getExtra("aecommerce-id");this.panel||(this.panel=A.find(".sb-panel-aecommerce")),i&&!a(this.panel)&&SBF.ajax({function:"aecommerce-get-conversation-details",aecommerce_id:i.value},i=>{t=`<h3>${SB_ADMIN_SETTINGS.aecommerce_panel_title}</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of orders")}</div><span>${i.orders_count} ${o("orders")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.total} ${i.currency_symbol}</span></div></div><div class="sb-title">${o("Cart")}</div><div class="sb-list-items sb-list-links sb-aecommerce-cart">`;for(s=0;s<i.cart.length;s++){let e=i.cart[s];t+=`<a href="${e.url}" target="_blank" data-id="${e.id}"><span>#${e.id}</span> <span>${e.name}</span> <span>x ${e.quantity}</span></a>`}if(t+=(i.cart.length?"":"<p>"+o("The cart is currently empty.")+"</p>")+"</div>",i.orders.length){t+=`<div class="sb-title">${o("Orders")}</div><div class="sb-list-items sb-list-links sb-aecommerce-orders">`;for(var s=0;s<i.orders.length;s++){let e=i.orders[s],a=e.id;t+=`<a data-id="${a}" href="${e.url}" target="_blank"><span>#${e.id}</span> <span>${SBF.beautifyTime(e.time,!0)}</span> <span>${e.price} ${i.currency_symbol}</span></a>`}t+="</div>"}e(this.panel).html(t).sbLoading(!1),l(this.panel,160)}),e(this.panel).html(t)}},martfury:{conversationPanel:function(){let t=s().getExtra("martfury-id");this.panel||(this.panel=A.find(".sb-panel-martfury")),t&&!a(this.panel)&&SBF.ajax({function:"martfury-get-conversation-details",martfury_id:t.value},t=>{e(this.panel).html(t).sbLoading(!1),l(this.panel,160)}),e(this.panel).html("")}},whmcs:{conversationPanel:function(){let t="",i=s().getExtra("whmcs-id");this.panel||(this.panel=A.find(".sb-panel-whmcs")),i&&!a(this.panel)&&SBF.ajax({function:"whmcs-get-conversation-details",whmcs_id:i.value},i=>{let s=["products","addons","domains"];t=`<h3>WHMCS</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of services")}</div><span>${i.services_count} ${o("services")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.total} ${i.currency_symbol}</span></div></div></div>`;for(var a=0;a<s.length;a++){let e=i[s[a]];if(e.length){t+=`<div class="sb-title">${o(SBF.slugToString(s[a]))}</div><div class="sb-list-items">`;for(var n=0;n<e.length;n++)t+=`<div>${e[n].name}</div>`;t+="</div>"}}t+=`<a href="${SB_ADMIN_SETTINGS.whmcs_url}/clientssummary.php?userid=${i["client-id"]}" target="_blank" class="sb-btn sb-whmcs-link">${o("View on WHMCS")}</a>`,e(this.panel).html(t).sbLoading(!1),l(this.panel,160)}),e(this.panel).html(t)}},perfex:{conversationPanel:function(){let e=s().getExtra("perfex-id");A.find(".sb-panel-perfex").html(e?`<a href="${SB_ADMIN_SETTINGS.perfex_url}/admin/clients/client/${e.value}" target="_blank" class="sb-btn sb-perfex-link">${o("View on Perfex")}</a>`:"")}},calendar:{conversationPanel:function(){let e=A.find(".sb-panel-calendar");e.addClass("sb-hide"),e.length&&SBF.ajax({function:"calendar-panel"},t=>{e.find("> div").html(t),e.removeClass("sb-hide")})},cancelBooking:function(e,t){SBF.ajax({function:"calendar-cancel-booking",booking_id:e},e=>{t(e)})},getAvailableSlots:function(e,t,i=1){SBF.ajax({function:"calendar-get-available-slots",date:e,max_days:i},e=>{t(e)})},addBooking:function(e,t){SBF.ajax({function:"calendar-create-booking",start_date:e},e=>{t(e)})}},ump:{conversationPanel:function(){if(a(this.panel))return;this.panel||(this.panel=A.find(".sb-panel-ump"));let t,i="";SBF.ajax({function:"ump-get-conversation-details"},s=>{if((t=s.subscriptions).length){i='<i class="sb-icon-refresh"></i><h3>Membership</h3><div class="sb-list-names">';for(var a=0;a<t.length;a++){let e=t[a].expired;i+=`<div${e?' class="sb-expired"':""}><span>${t[a].label}</span><span>${o(e?"Expired on":"Expires on")} ${SBF.beautifyTime(t[a].expire_time,!1,!e)}</span></div>`}i+=`</div><span class="sb-title">${o("Total spend")} ${s.total} ${s.currency_symbol}</span>`}e(this.panel).html(i).sbLoading(!1),l(this.panel,160)})}},armember:{conversationPanel:function(){let t=s().getExtra("wp-id");if(this.panel||(this.panel=A.find(".sb-panel-armember")),SBF.null(t)||a(this.panel))e(this.panel).html("");else{let i,a="";t=t.value,SBF.ajax({function:"armember-get-conversation-details",wp_user_id:t},t=>{if((i=t.subscriptions).length){a=`<i class="sb-icon-refresh"></i><h3>${o("Plans")}</h3><div class="sb-list-names">`;for(var n=0;n<i.length;n++){let e=i[n].expired;a+=`<div${e?' class="sb-expired"':""}><span>${i[n].arm_current_plan_detail.arm_subscription_plan_name}</span><span>${"never"==i[n].expire_time?"":o(e?"Expired on":"Expires on")+" "+SBF.beautifyTime(i[n].expire_time,!1,!e)}</span></div>`}a+=`</div><span class="sb-title">${o("Total spend")} ${t.total} ${t.currency_symbol}<a href="${window.location.href.substr(0,window.location.href.lastIndexOf("/"))+"?page=arm_manage_members&member_id="+s().getExtra("wp-id").value}" target="_blank" class="sb-btn-text"><i class="sb-icon-user"></i> ${o("View member")}</a></span>`}e(this.panel).html(a).sbLoading(!1),l(this.panel,160)})}}},zendesk:{conversationPanel:function(){if(!SB_ADMIN_SETTINGS.zendesk_active)return;let t=s().getExtra("zendesk-id"),i=s().getExtra("phone"),n=s().get("email"),o=A.find(".sb-panel-zendesk");(t||i||n)&&!a(o)?SBF.ajax({function:"zendesk-get-conversation-details",conversation_id:SBChat.conversation.id,zendesk_id:!!t&&t.value,phone:!!i&&i.value,email:n},t=>{e(o).html(t).sbLoading(!1),o.find(".sb-zendesk-date").each(function(){e(this).html(SBF.beautifyTime(e(this).html()))}),l(o,160)}):e(o).html("")}},woocommerce:{timeout:!1,conversationPanel:function(){if(a(this.panel))return;this.panel||(this.panel=A.find(".sb-panel-woocommerce"));let t="";SBF.ajax({function:"woocommerce-get-conversation-details"},i=>{t=`<i class="sb-icon-refresh"></i><h3>WooCommerce</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of orders")}</div><span>${i.orders_count} ${o("orders")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.total} ${i.currency_symbol}</span></div></div><div class="sb-title">${o("Cart")}<i class="sb-add-cart-btn sb-icon-plus"></i></div><div class="sb-list-items sb-list-links sb-woocommerce-cart">`;for(s=0;s<i.cart.length;s++){let e=i.cart[s];t+=`<a href="${e.url}" target="_blank" data-id="${e.id}"><span>#${e.id}</span> <span>${e.name}</span> <span>x ${e.quantity}</span><i class="sb-icon-close"></i></a>`}if(t+=(i.cart.length?"":"<p>"+o("The cart is currently empty.")+"</p>")+"</div>",i.orders.length){t+=`<div class="sb-title">${o("Orders")}</div><div class="sb-list-items sb-woocommerce-orders sb-accordion">`;for(var s=0;s<i.orders.length;s++){let e=i.orders[s],a=e.id;t+=`<div data-id="${a}"><span><span>#${a}</span> <span>${SBF.beautifyTime(e.date,!0)}</span><a href="${xe}/wp-admin/post.php?post=${a}&action=edit" target="_blank" class="sb-icon-next"></a></span><div></div></div>`}t+="</div>"}e(this.panel).html(t).sbLoading(!1),l(this.panel,160)})},conversationPanelOrder:function(e){let t=this.panel.find(`[data-id="${e}"] > div`);t.html(""),SBF.ajax({function:"woocommerce-get-order",order_id:e},e=>{let i="",s=this.panel.find(".sb-collapse-btn:not(.sb-active)");if(e){let t=e.products;i+=`<div class="sb-title">${o("Order total")}: <span>${e.total} ${e.currency_symbol}<span></div><div class="sb-title">${o("Order status")}: <span>${SBF.slugToString(e.status.replace("wc-",""))}<span></div><div class="sb-title">${o("Date")}: <span>${SBF.beautifyTime(e.date,!0)}<span></div><div class="sb-title">${o("Products")}</div>`;for(a=0;a<t.length;a++)i+=`<a href="${xe}?p=${t[a].id}" target="_blank"><span>#${t[a].id}</span> <span>${t[a].quantity} x</span> <span>${t[a].name}</span></a>`;for(var a=0;a<2;a++){let t=0==a?"shipping":"billing";e[t+"_address"]&&(i+=`<div class="sb-title">${o((0==a?"Shipping":"Billing")+" address")}</div><div class="sb-multiline">${e[t+"_address"].replace(/\\n/g,"<br>")}</div>`)}}s.length&&s.click(),t.html(i)})},conversationPanelUpdate:function(e,t="added"){let i=!1,s=0;this.timeout=setInterval(()=>{i||(SBF.ajax({function:"woocommerce-get-conversation-details"},a=>{let n=!0;for(var o=0;o<a.cart.length;o++)a.cart[o].id==e&&("added"==t?s=61:n=!1);(s>60||n)&&(this.conversationPanel(),A.find(".sb-add-cart-btn,.sb-woocommerce-cart > a i").sbLoading(!1),clearInterval(this.timeout)),s++,i=!1}),i=!0)},1e3)}},opencart:{conversationPanel:function(){let e=A.find(".sb-panel-opencart"),t=s().getExtra("opencart_id"),i=s().getExtra("opencart_store_url");if(!t)return e.html("");a(e)||SBF.ajax({function:"opencart-panel",opencart_id:t.value,store_url:!!i&&i.value},t=>{e.html(t).sbLoading(!1),l(this.panel,160)})},openOrder:function(e){SBF.ajax({function:"opencart-order-details",order_id:e},t=>{pt.infoPanel(t,"info",!1,"opencart-order-details",o("Order")+" #"+e,!0)})}},wordpress:{ajax:function(t,i,s){e.ajax({method:"POST",url:SB_WP_AJAX_URL,data:e.extend({action:"sb_wp_ajax",type:t},i)}).done(e=>{!1!==s&&s(e)})}},is:function(e){if(typeof SB_VERSIONS==et)return!1;switch(e){case"opencart":case"zendesk":case"twitter":case"wechat":case"line":case"viber":case"zalo":case"telegram":case"armember":case"aecommerce":case"martfury":case"whmcs":case"perfex":case"ump":case"messenger":case"whatsapp":case"woocommerce":case"dialogflow":case"slack":case"tickets":return typeof SB_VERSIONS[e]!=et&&SB_VERSIONS[e];case"wordpress":return typeof SB_WP!=et;case"sb":return!0}return!1},unsupportedRichMessages:function(e,i,s=[]){s.push("timetable","registration","table","inputs"),["Messenger","WhatsApp"].includes(i)||s.push("email");for(var a=0;a<s.length;a++)e.includes("["+s[a])&&t("The {R} rich message is not supported by {R2}. The rich message was not sent to {R2}.".replace(/{R}/g,SBF.slugToString(s[a])).replace(/{R2}/g,i),"error")},getMessagingAppName:function(e=!1){let t={fb:"Facebook",wa:"WhatsApp",tm:"Text message",ig:"Instagram",tg:"Telegram",tk:"Tickets",wc:"WeChat",em:"Email",tw:"Twitter",vb:"Viber",ln:"LINE",za:"Zalo"};return e?e in t?t[e]:e:t},getSelectMessagingApps:function(e=!1,t=!1){let i=this.getMessagingAppName(),s='<select class="sb-select-messaging-apps"><option value=""></option>';t&&(i.ch="Chat");for(let t in i)s+=`<option value="${t}"${e&&e==t?" selected":""}>${i[t]}</option>`;return s+"</select>"},itemsPanel:{pagination_reference:1,panel_language:"",code:function(e,t,i=!0){let s="";for(var a=0;a<e.length;a++)s+=`<li data-id="${e[a].id.split("/").pop()}"><div class="sb-image" style="background-image:url('${e[a].image?"shopify"==t?e[a].image.replace(".jpg","_small.jpg"):e[a].image:SB_URL+"/media/thumb.svg"}')"></div><div><span>${e[a].name?e[a].name:e[a].title}</span><span>${e[a].price?e[a].price:e[a].variants.edges[0].node.price} ${SB_ADMIN_SETTINGS.currency}</span></div></li>`;return i?s||`<p class="sb-no-results">${o("No products found")}</p>`:s},getAppInfo:function(e){switch(e){case"woocommerce":return{area:Le,ul:De,search:"woocommerce-search-products",filter:"woocommerce-get-products",populate:"woocommerce-products-popup",pagination:"woocommerce-get-products"};case"shopify":return{area:SBCloud.shopify_products_box,ul:SBCloud.shopify_products_box_ul,search:"shopify-get-products",filter:"shopify-get-products",populate:"shopify-get-products",pagination:"shopify-get-products"}}},search:function(t,i){let s=this.getAppInfo(i);c(t,(t,a)=>{t?(this.pagination_reference=1,SBF.ajax({function:s.search,search:t},t=>{"shopify"==i&&(this.pagination_reference=t[1],t=t[0]),this.getAppInfo(i).ul.html(this.code(t,i)),e(a).sbLoading(!1)})):this.populate(i,function(){e(a).sbLoading(!1)})})},filter:function(t,i){let s=this.getAppInfo(i),n=e(t).data("value");a(s.ul)||(s.ul.html(""),this.pagination_reference=1,SBF.ajax({function:s.filter,user_language:this.panel_language,filters:{taxonomy:n},collection:n},e=>{"shopify"==i&&(this.pagination_reference=e[1],e=e[0]),s.ul.html(this.code(e,i)).sbLoading(!1)}))},populate:function(e,t=!1){let i=this.getAppInfo(e);this.panel_language=s()&&SB_ADMIN_SETTINGS.languages&&SB_ADMIN_SETTINGS.languages.includes(s().language)?s().language:"",this.pagination_reference=1,i.ul.html("").sbLoading(!0),SBF.ajax({function:i.populate,user_language:this.panel_language},s=>{let a="",n=i.area.find(".sb-select");for(var r=0;r<s[1].length;r++)a+=`<li data-value="${s[1][r].id}">${s[1][r].name}</li>`;s[2]&&(this.pagination_reference=s[2]),s[3]&&(SB_ADMIN_SETTINGS.currency=s[3]),n.find("> p").html(o("All")),n.find("ul").html(`<li data-value="" class="sb-active">${o("All")}</li>`+a),i.ul.html(this.code(s[0],e)).sbLoading(!1),!1!==t&&t()})},pagination:function(t,i){let s=this.getAppInfo(i),a=e(t).parent().find(".sb-select p").attr("data-value");this.pagination_reference&&(s.ul.sbLoading(t),SBF.ajax({function:s.pagination,filters:{taxonomy:a},collection:a,pagination:this.pagination_reference,user_language:this.panel_language},e=>{"shopify"==i?(this.pagination_reference=e[1],e=e[0]):this.pagination_reference++,s.ul.append(this.code(e,i,!1)).sbLoading(!1),e.length||(this.pagination_reference=0)}))}}},ot={init:!1,save:function(i=!1){if(i&&a(i))return;let s={},n={};switch(W.find(" > .sb-tab > .sb-nav .sb-active").attr("id")){case"tab-automations":let a=Y.find(".sb-active").attr("data-id");ot.automations.save(s=>{t(!0===s?"Automations saved":s),ot.automations.populate(),Y.find(`[data-id="${a}"]`).click(),i&&e(i).sbLoading(!1)});break;case"tab-translations":this.translations.updateActive(),SBF.ajax({function:"save-translations",translations:JSON.stringify(this.translations.to_update)},()=>{t("Translations saved"),i&&e(i).sbLoading(!1)});break;default:W.find(".sb-setting").each((t,i)=>{let a=this.get(i),o=e(i).data("setting");if(a[0])if(typeof o!=et){let t=!1;if(e(i).find("[data-language]").length){let s=e(i).find("[data-language].sb-active");if(t=a[0]in this.translations.originals&&this.translations.originals[a[0]],this.translations.save(i,!!s.length&&s.attr("data-language")),t&&"string"!=typeof t)for(var r in t)t[r]=[t[r],a[1][r][1]]}o in s||(s[o]={}),s[o][a[0]]=[t||a[1],a[2]]}else n[a[0]]=[a[1],a[2]]}),n["timetable-utc"][0]||(n["timetable-utc"][0]=Xe.getTimezoneOffset()/60+"|"+Intl.DateTimeFormat().resolvedOptions().timeZone),SBF.ajax({function:"save-settings",settings:JSON.stringify(n),external_settings:s,external_settings_translations:this.translations.translations},()=>{i&&(t("Settings saved. Reload to apply the changes."),e(i).sbLoading(!1)),SBF.event("SBSettingsSaved",{settings:n,external_settings:s,external_settings_translations:this.translations.translations})})}},get:function(t){let i=(t=e(t)).attr("id"),s=t.data("type");switch(s){case"upload":case"range":case"number":case"text":case"password":case"color":case"upload-file":return[i,t.find("input").val(),s];case"textarea":return[i,t.find("textarea").val(),s];case"select":return[i,t.find("select").val(),s];case"checkbox":return[i,t.find("input").is(":checked"),s];case"radio":let a=t.find("input:checked").val();return SBF.null(a)&&(a=""),[i,a,s];case"upload-image":let n=t.find(".image").attr("data-value");return SBF.null(n)&&(n=""),[i,n,s];case"multi-input":let o={};return t.find(".input > div").each((e,t)=>{let i=this.get(t);i[0]&&(o[i[0]]=[i[1],i[2]])}),[i,o,s];case"select-images":return[i,t.find(".input > .sb-active").data("value"),s];case"repeater":return[i,this.repeater.get(t.find(".repeater-item")),s];case"double-select":let r={};return t.find(".input > div").each(function(){let t=e(this).find("select").val();-1!=t&&(r[e(this).attr("data-id")]=[t])}),[i,r,s];case"select-checkbox":return[i,t.find(".sb-select-checkbox input:checked").map(function(){return e(this).attr("id")}).get(),s];case"timetable":let l={};return t.find(".sb-timetable > [data-day]").each(function(){let t=e(this).attr("data-day"),i=[];e(this).find("> div > div").each(function(){let t=e(this).html(),s=e(this).attr("data-value");SBF.null(s)?i.push(["","Closed"]):"closed"==s?i.push(["closed","Closed"]):i.push([s,t])}),l[t]=i}),[i,l,s];case"color-palette":return[i,t.attr("data-value"),s]}return["","",""]},set:function(t,i){let s=e(i)[1],a=e(i)[0];switch(t=`#${t}`,s){case"color":case"upload":case"number":case"text":case"password":case"upload-file":W.find(`${t} input`).val(a);break;case"textarea":W.find(`${t} textarea`).val(a);break;case"select":W.find(`${t} select`).val(a);break;case"checkbox":W.find(`${t} input`).prop("checked","false"!=a&&a);break;case"radio":W.find(`${t} input[value="${a}"]`).prop("checked",!0);break;case"upload-image":a&&W.find(t+" .image").attr("data-value",a).css("background-image",`url("${a}")`);break;case"multi-input":for(var n in a)this.set(n,a[n]);break;case"range":let i=a;W.find(t+" input").val(i),W.find(t+" .range-value").html(i);break;case"select-images":W.find(t+" .input > div").sbActive(!1),W.find(t+` .input > [data-value="${a}"]`).sbActive(!0);break;case"select-checkbox":for(o=0;o<a.length;o++)W.find(`input[id="${a[o]}"]`).prop("checked",!0);W.find(t+" .sb-select-checkbox-input").val(a.join(", "));break;case"repeater":let r=this.repeater.set(a,W.find(t+" .repeater-item:last-child"));r&&W.find(t+" .sb-repeater").html(r);break;case"double-select":for(var n in a)W.find(`${t} .input > [data-id="${n}"] select`).val(a[n]);break;case"timetable":for(var n in a){let i=W.find(`${t} [data-day="${n}"] > div > div`);for(var o=0;o<i.length;o++)e(i[o]).attr("data-value",a[n][o][0]).html(a[n][o][1])}break;case"color-palette":a&&W.find(t).attr("data-value",a)}},repeater:{set:function(t,i){var s="";if(this.clear(e(i)),i=e(i).html(),t.length){e(i).find("> .sb-icon-close").remove();for(var a=0;a<t.length;a++){let o=e(e.parseHTML(`<div>${i}</div>`));for(var n in t[a])ot.input.set(o.find(`[data-id="${n}"]`),t[a][n]);s+=`<div class="repeater-item">${o.html().replaceAll('<i class="sb-icon-close"></i>',"")}<i class="sb-icon-close"></i></div>`}}return s},get:function(t){let i=[];return e(t).each(function(){let t={},s=!0;e(this).find("[data-id]").removeClass("sb-exclude"),e(this).find(".sb-repeater [data-id]").addClass("sb-exclude"),e(this).find("[data-id]:not(.sb-exclude)").each(function(){let i=ot.input.get(this);s&&i&&"hidden"!=e(this).attr("type")&&"auto-id"!=e(this).attr("data-type")&&(s=!1),t[e(this).attr("data-id")]=i}),s||i.push(t)}),i},add:function(t){let i=e(t).parent();t=e(e.parseHTML(`<div>${i.find("> .sb-repeater > .repeater-item:last-child").html()}</div>`)),this.clear(t),t.find(".repeater-item:not(:first-child)").remove(),t.find("[data-id]").each(function(){if(ot.input.reset(this),"auto-id"==e(this).data("type")){let t=1;i.find('[data-type="auto-id"]').each(function(){let i=parseInt(e(this).val());i>t&&(t=i)}),e(this).attr("value",t+1)}}),i.find("> .sb-repeater").append(`<div class="repeater-item">${t.html()}</div>`)},delete:function(t){let i=e(t).parent(),s=i.parent();s.parent().find(".sb-repeater-upload").length&&SBF.ajax({function:"delete-file",path:i.find("input").val()}),s.find("> .repeater-item").length>1?i.remove():i.find('[data-id]:not([data-type="auto-id"]').each((e,t)=>{ot.input.reset(t)})},clear:function(e){e.find(".sb-active").sbActive(!1),e.find('input:not([data-type="auto-id"]').removeAttr("value checked"),e.find("option").removeAttr("selected"),e.find(".sb-hide").removeClass("sb-hide")}},input:{set:function(t,i){if(t=e(t),"object"!=typeof i&&(i=e.trim(i)),t.is("select"))t.find(`option[value="${i}"]`).attr("selected","");else if(t.is(":checkbox")&&i&&"false"!=i)t.attr("checked","");else if(t.is("textarea"))t.html(i);else{let e=t.is("div");t.hasClass("sb-repeater")?t.html(ot.repeater.set(i,"<div>"+t.find("> .repeater-item").eq(0).html()+"</div>").replaceAll("sb-icon-close","sb-icon-close sb-sub-repeater-close")):e||t.is("i")||t.is("li")?(t.attr("data-value",i),e&&t.hasClass("image")&&t.css("background-image",i?`url("${i}")`:"")):t.attr("value",i)}},get:function(t){if((t=e(t)).is(":checkbox"))return t.is(":checked");if(t.hasClass("sb-repeater"))return ot.repeater.get(t.find("> .repeater-item"));if(t.is("div")||t.is("i")||t.is("li")){let e=t.attr("data-value");return e||""}return t.val()},reset:function(t){(t=e(t)).is("select")?t.val("").find("[selected]").removeAttr("selected"):t.is(":checkbox")?t.removeAttr("checked").prop("checked",!1):t.is("textarea")?(t.val(""),t.html("")):t.hasClass("sb-repeater")?t.find(".repeater-item:not(:first-child)").remove():t.removeAttr("value style data-value").val("")}},initColorPicker:function(t=!1){e(t||W).find(".sb-type-color input").colorPicker({renderCallback:function(t,i){e(t.context).closest(".input").find("input").css("background-color",t.text)}})},loadDatePicker:function(t){typeof e.fn.daterangepicker===et?e.getScript(SB_URL+"/vendor/moment.min.js",()=>{e.getScript(SB_URL+"/vendor/daterangepicker.min.js",()=>{t()})}):t()},getDatePickerSettings:function(e=!1,t=!1){let i={ranges:{},locale:{format:"DD/MM/YYYY",separator:" - ",applyLabel:o("Apply"),cancelLabel:o("Cancel"),fromLabel:o("From"),toLabel:o("To"),customRangeLabel:o("Custom"),weekLabel:o("W"),daysOfWeek:[o("Su"),o("Mo"),o("Tu"),o("We"),o("Th"),o("Fr"),o("Sa")],monthNames:[o("January"),o("February"),o("March"),o("April"),o("May"),o("June"),o("July"),o("August"),o("September"),o("October"),o("November"),o("December")],firstDay:1},showCustomRangeLabel:!e,alwaysShowCalendars:!0,autoApply:!0,opens:k.hasClass("sb-rtl")?"left":"right"};return e?i.singleDatePicker=!0:(i.ranges[o("Today")]=[moment(),moment()],i.ranges[o("Yesterday")]=[moment().subtract(1,"days"),moment().subtract(1,"days")],i.ranges[o("Last 7 Days")]=[moment().subtract(6,"days"),moment()],i.ranges[o("Last 30 Days")]=[moment().subtract(29,"days"),moment()],i.ranges[o("This Month")]=[moment().startOf("month"),moment().endOf("month")],i.ranges[o("Last Month")]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]),t&&(i.minDate=moment()),i},getSettingObject:function(t){return e(t)[0].hasAttribute("data-setting")?e(t):e(t).closest("[data-setting]")},visibility:function(e,t){let i=[["#push-notifications-onesignal-sw-url, #push-notifications-onesignal-app-id, #push-notifications-onesignal-api-key, #push-notifications-sw-path","#push-notifications-id, #push-notifications-key"],["#messenger-key, #messenger-path-btn","#messenger-sync-btn"],["#open-ai-assistant-id","#open-ai-prompt,#open-ai-model, #open-ai-tokens, #open-ai-temperature, #open-ai-presence-penalty, #open-ai-frequency-penalty, #open-ai-logit-bias, #open-ai-custom-model, #open-ai-source-links"]];W.find(i[e][0]).sbActive(!t),W.find(i[e][1]).setClass("sb-hide",!t)},open:function(e,t=!1){x.find("#sb-settings").click(),t&&setTimeout(()=>{W.find("#tab-"+e).click().get(0).scrollIntoView()},300)},automations:{items:{messages:[],emails:[],sms:[],popups:[],design:[],more:[]},translations:{},conditions:function(){let e={datetime:["Date time",["Is between","Is exactly"],"dd/mm/yyyy hh:mm - dd/mm/yyyy hh:mm"],repeat:["Repeat",["Every day","Every week","Every month","Every year"]],browsing_time:["Browsing time",[],"seconds"],scroll_position:["Scroll position",[],"px"],url:["Current URL",["Contains","Does not contain"],"URLs parts separated by commas"],referring:["Referring URL",["Contains","Does not contain"],"URLs parts separated by commas"],user_type:["User type",["Is visitor","Is lead","Is user","Is not visitor","Is not lead","Is not user"]],returning_visitor:["Returning visitor",["First time visitor","Returning visitor"]],countries:["Country",["Is included","Is not included","Is set","Is not set"],"Country codes separated by commas"],languages:["Language",["Is included","Is not included","Is set","Is not set"],"Language codes separated by commas"],cities:["City",["Is included","Is not included","Is set","Is not set"],"Cities separated by commas"],website:["Website",["Contains","Does not contain","Is set","Is not set"],"URLs parts separated by commas"],birthdate:["Birthdate",["Is between","Is exactly","Is set","Is not set"],"dd/mm - dd/mm"],company:["Company",["Is included","Is not included","Is set","Is not set"],"Company names separated by commas"],postal_code:["Postal code",["Is included","Is not included","Is set","Is not set"],"Postal codes separated by commas"],email:["Email",["Contains","Does not contain","Is set","Is not set"],"Email addresses separated by commas"],phone:["Phone",["Contains","Does not contain","Is set","Is not set"],"Phone numbers separated by commas"],creation_time:["Creation time",["Is between","Is exactly"],"dd/mm/yyyy hh:mm - dd/mm/yyyy hh:mm"],custom_variable:["Custom variable",[],"variable=value"]},t=ct.getExtraDetailsList(!0);for(var i=0;i<t.length;i++)e[t[i][0]]=[t[i][1],["Contains","Does not contain","Is set","Is not set"],"Values separated by commas"];return e},get:function(e){SBF.ajax({function:"automations-get"},t=>{this.items=t[0],this.translations=Array.isArray(t[1])&&!t[1].length?{}:t[1],e(t)})},save:function(e=!1){this.updateActiveItem(),SBF.ajax({function:"automations-save",automations:this.items,translations:this.translations},t=>{e&&e(t)})},show:function(e=!1,t=!1){this.updateActiveItem();let i=t?t in this.translations?this.translations[t]:[]:this.items,s=z.find(" > .sb-tab > .sb-content");!1===e&&(e=this.activeID()),this.hide(!1);for(var a in i)for(var n=0;n<i[a].length;n++){let o=i[a][n];if(o.id==e){for(var a in o){let e=s.find(`[data-id="${a}"]`);e.hasClass("image")?(e.css("background-image",`url(${o[a]})`).attr("data-value",o[a]),o[a]||e.removeAttr("data-value")):"checkbox"==e.attr("type")?e.prop("checked",o[a]):e.val(o[a])}return this.setConditions(o.conditions,X),X.parent().setClass("sb-hide",t),s.sbLanguageSwitcher(this.getTranslations(e),"automations",t),!0}}return!1},add:function(){let e=SBF.random(),t=`${o("Item")} ${Y.find("li:not(.sb-no-results)").length+1}`;this.updateActiveItem(),this.items[this.activeType()].push(this.itemArray(this.activeType(),e,t)),this.hide(!1),Y.find(".sb-active").sbActive(!1),Y.find(".sb-no-results").remove(),Y.append(`<li class="sb-active" data-id="${e}">${t}<i class="sb-icon-delete"></i></li>`),z.find(".sb-automation-values").find("input, textarea").val(""),z.sbLanguageSwitcher([],"automations"),X.html("")},delete:function(t){this.items[this.activeType()].splice(e(t).parent().index(),1),e(t).parent().remove(),this.hide(),0==this.items[this.activeType()].length&&Y.html(`<li class="sb-no-results">${o("No results found.")}</li>`)},populate:function(e=!1){!1===e&&(e=this.activeType());let t="",i=this.items[e];if(this.updateActiveItem(),i.length)for(s=0;s<i.length;s++)t+=`<li data-id="${i[s].id}">${i[s].name}<i class="sb-icon-delete"></i></li>`;else t=`<li class="sb-no-results">${o("No results found.")}</li>`;switch(Y.html(t),t="",e){case"emails":t=`<h2>${o("Subject")}</h2><div class="sb-setting sb-type-text"><div><input data-id="subject" type="text"></div></div>`;break;case"popups":t=`<h2>${o("Title")}</h2><div class="sb-setting sb-type-text"><div><input data-id="title" type="text"></div></div><h2>${o("Profile image")}</h2><div data-type="upload-image" class="sb-setting sb-type-upload-image"><div class="input"><div data-id="profile_image" class="image"><i class="sb-icon-close"></i></div></div></div><h2>${o("Message fallback")}</h2><div class="sb-setting sb-type-checkbox"><div><input data-id="fallback" type="checkbox"></div></div>`;break;case"design":t=`<h2>${o("Header title")}</h2><div class="sb-setting sb-type-text"><div><input data-id="title" type="text"></div></div>`;for(s=1;s<4;s++)t+=`<h2>${o((1==s?"Primary":2==s?"Secondary":"Tertiary")+" color")}</h2><div data-type="color" class="sb-setting sb-type-color"><div class="input"><input data-id="color_${s}" type="text"><i class="sb-close sb-icon-close"></i></div></div>`;for(var s=1;s<4;s++)t+=`<h2>${o(1==s?"Header background image":2==s?"Header brand image":"Chat button icon")}</h2><div data-type="upload-image" class="sb-setting sb-type-upload-image"><div class="input"><div data-id="${1==s?"background":2==s?"brand":"icon"}" class="image"><i class="sb-icon-close"></i></div></div></div>`;break;case"more":t=`<h2>${o("Department ID")}</h2><div class="sb-setting sb-type-number"><div><input data-id="department" type="number"></div></div><h2>${o("Agent ID")}</h2><div class="sb-setting sb-type-number"><div><input data-id="agent" type="number"></div></div><h2>${o("Tags")}</h2><div class="sb-setting sb-type-text"><div><input data-id="tags" type="text"></div></div><h2>${o("Article IDs")}</h2><div class="sb-setting sb-type-number"><div><input data-id="articles" type="text"></div></div><h2>${o("Articles category")}</h2><div class="sb-setting sb-type-number"><div><input data-id="articles_category" type="text"></div></div>`}z.find(".sb-automation-extra").html(t),z.attr("data-automation-type",e),ot.initColorPicker(z),this.hide()},updateActiveItem:function(){let t=this.activeID();if(t){let s=z.find(".sb-language-switcher [data-language].sb-active").attr("data-language"),a=this.activeType(),n=s?s in this.translations?this.translations[s][a]:[]:this.items[a];for(var i=0;i<n.length;i++)if(n[i].id==t){n[i]={id:t,conditions:[]},z.find(".sb-automation-values").find('input,textarea,[data-type="upload-image"] .image').each(function(){n[i][e(this).attr("data-id")]=e(this).hasClass("image")&&e(this)[0].hasAttribute("data-value")?e(this).attr("data-value"):"checkbox"==e(this).attr("type")?e(this).is(":checked"):e(this).val()}),n[i].conditions=this.getConditions(X),SBF.null(n[i].name)&&this.delete(Y.find(`[data-id="${t}"] i`));break}}},getConditions:function(t){let i=[];return t.find(" > div").each(function(){let t=[];e(this).find("input,select").each(function(){t.push(e(this).val())}),t[0]&&t[1]&&(2==t.length||t[2]||["is-set","is-not-set"].includes(t[1]))&&i.push(t)}),i},setConditions:function(e,t){if(t.html(""),e)for(var i in e){this.addCondition(t);let s=t.find(" > div:last-child");s.find("select").val(e[i][0]),this.updateCondition(s.find("select")),s.find(" > div").eq(1).find("select,input").val(e[i][1]),e[i].length>2&&(["is-set","is-not-set"].includes(e[i][1])?s.find(" > div").eq(2).addClass("sb-hide"):s.find(" > div").eq(2).find("input").val(e[i][2]))}},addCondition:function(e){e.append(`<div><div class="sb-setting sb-type-select sb-condition-1"><select>${this.getAvailableConditions()}</select></div></div>`)},updateCondition:function(t){e(t).parent().siblings().remove();let i=e(t).parents().eq(1);if(e(t).val()){let a=this.conditions()[e(t).val()],n="";if(a[1].length){n='<div class="sb-setting sb-type-select sb-condition-2"><select>';for(var s=0;s<a[1].length;s++)n+=`<option value="${SBF.stringToSlug(a[1][s])}">${o(a[1][s])}</option>`;n+="</select></div>"}i.append(n+(a.length>2?`<div class="sb-setting sb-type-text"><input placeholder="${o(a[2])}" type="text"></div>`:"")),i.siblings().find(".sb-condition-1 select").each(function(){let t=e(this).val();e(this).html(ot.automations.getAvailableConditions([t])),e(this).val(t)})}else i.remove()},getAvailableConditions:function(t=[],i=[]){let s='<option value=""></option>',a=[],n=this.conditions();X.find(".sb-condition-1 select").each(function(){a.push(e(this).val())});for(var r in n)i.includes(r)||a.includes(r)&&!t.includes(r)||(s+=`<option value="${r}">${o(n[r][0])}</option>`);return s},addTranslation:function(e=!1,t=!1,i){if(!1===e&&(e=this.activeID()),!1===t&&(t=this.activeType()),this.getTranslations(e).includes(e))return console.warn("Automation translation already in array.");i in this.translations||(this.translations[i]={messages:[],emails:[],sms:[],popups:[],design:[]}),t in this.translations[i]||(this.translations[i][t]=[]),this.translations[i][t].push(this.itemArray(t,e))},getTranslations:function(e=!1){let t=[];!1===e&&(e=this.activeID());for(var i in this.translations){let n=this.translations[i];for(var s in n){let o=n[s];for(var a=0;a<o.length;a++)if(o[a].id==e){t.push(i);break}}}return t},deleteTranslation:function(e=!1,t){if(!1===e&&(e=this.activeID()),t in this.translations){let a=this.translations[t];for(var i in a){let n=a[i];for(var s=0;s<n.length;s++)if(n[s].id==e)return this.translations[t][i].splice(s,1),!0}}return!1},activeID:function(){let e=Y.find(".sb-active");return!!e.length&&e.attr("data-id")},activeType:function(){return J.find("li.sb-active").data("value")},itemArray:function(t,i,s="",a=""){return e.extend({id:i,name:s,message:a},"emails"==t?{subject:""}:"popups"==t?{title:"",profile_image:""}:"design"==t?{title:"",color_1:"",color_2:"",color_3:"",background:"",brand:"",icon:""}:{})},hide:function(e=!0){z.find(" > .sb-tab > .sb-content").setClass("sb-hide",e)}},translations:{translations:{},originals:{},to_update:{},add:function(e){let t=ot.getSettingObject(be),i=t.attr("id"),s=be.find("[data-language].sb-active");this.save(t,!!s.length&&s.attr("data-language")),t.find('textarea,input[type="text"]').val(""),this.save(t,e),be.remove(),t.sbLanguageSwitcher(this.getLanguageCodes(i),"settings",e)},delete:function(e,t){let i=(e=ot.getSettingObject(e)).attr("id");delete this.translations[t][i],e.find(`.sb-language-switcher [data-language="${t}"]`).remove(),this.activate(e)},activate:function(e,t=!1){let i=(e=ot.getSettingObject(e)).attr("id"),s=t?this.translations[t][i]:this.originals[i];if(h(s))e.find("input, textarea").val(s);else for(var a in s)e.find("#"+a).find("input, textarea").val(h(s[a])?s[a]:s[a][0])},updateActive:function(){let t=W.find(".sb-translations-list"),i={front:{},admin:{},"admin/js":{},"admin/settings":{}},s=t.attr("data-value");if(!SBF.null(s)){for(var a in i)t.find(' > [data-area="'+a+'"] .sb-setting:not(.sb-new-translation)').each(function(){i[a][e(this).find("label").html()]=e(this).find("input").val()}),t.find('> [data-area="'+a+'"] .sb-new-translation').each(function(){let t=e(this).find("input:first-child").val(),s=e(this).find("input:last-child").val();t&&s&&(i[a][t]=s)});this.to_update[s]=i}},save:function(t,i=!1){t=ot.getSettingObject(t);let s={},a=e(t).attr("id");"multi-input"==t.data("type")?t.find(".multi-input-textarea,.multi-input-text").each(function(){s[e(this).attr("id")]=e(this).find("input, textarea").val()}):s=t.find("input, textarea").val(),i?(i in this.translations||(this.translations[i]={}),this.translations[i][a]=s):this.originals[a]=s},load:function(e){let t=W.find(".sb-translations > .sb-content");t.find(" > .sb-hide").removeClass("sb-hide"),this.updateActive(),SBF.ajax({function:"get-translation",language_code:e},i=>{e in this.to_update&&(i=this.to_update[e]);let s="",a=["front","admin","admin/js","admin/settings"];for(var n=0;n<a.length;n++){let e=i[a[n]];s+=`<div${n?"":' class="sb-active"'} data-area="${a[n]}">`;for(var o in e)s+=`<div class="sb-setting sb-type-text"><label>${o}</label><div><input type="text" value="${e[o]}"></div></div>`;s+="</div>"}t.find(".sb-translations-list").attr("data-value",e).html(s),t.find(".sb-menu-wide li").sbActive(!1).eq(0).sbActive(!0),t.sbLoading(!1)}),t.sbLoading(!0)},getLanguageCodes:function(e){let t=[];for(var i in this.translations)e in this.translations[i]&&t.push(i);return t}},getSelectDepartments:function(e=!1){if(SB_ADMIN_SETTINGS.departments.length){let t='<select class="sb-select-departments"><option value=""></option>';for(let i in SB_ADMIN_SETTINGS.departments){let s=SB_ADMIN_SETTINGS.departments[i];t+=`<option value="${s["department-id"]}"${e&&e==s["department-id"]?" selected":""}>${s["department-name"]}</option>`}return t+"</select>"}return""}},rt={category_list:[],page_url:!1,get:function(e,t=!1,i=!1,s=!0,a=!1){SBF.ajax({function:"get-articles",id:t,categories:i,articles_language:a,full:s},t=>{e(t)})},save:function(e=!1){let t,i=this.activeID();if(!(t={id:i,title:Z.find(".sb-article-title input").val(),content:Z.find(".sb-article-content textarea").val(),link:Z.find(".sb-article-link input").val(),parent_category:te.val(),category:ee.val(),language:Z.find(".sb-language-switcher [data-language].sb-active").attr("data-language")}).title&&!t.content)return e(!1);t.language&&(t.parent_id=this.activeID(!0)),it&&typeof it.save!==et?it.save().then(i=>{t.editor_js=i,t.content=function(e){let t="";return e.map(e=>{switch(e.type){case"header":t+=`<h${e.data.level}>${e.data.text}</h${e.data.level}>`;break;case"paragraph":t+=`<p>${e.data.text}</p>`;break;case"image":t+=`<img class="img-fluid" src="${e.data.file.url}" title="${e.data.caption}" /><em>${e.data.caption}</em>`;break;case"list":t+='<ul class="sb-ul-'+e.data.style+'">',e.data.items.forEach(function(e){t+=`<li>${e}</li>`}),t+="</ul>";break;case"code":t+=`<code>${e.data.code}</code>`;break;case"raw":t+=`<div class="sb-raw-html">${e.data.html}</div>`;break;case"divider":t+='<hr class="sb-divider" />';break;case"info":t+=`<p class="sb-info-box ${e.data.color}">${e.data.text}</p>`}}),t}(i.blocks),this.save_2(t,e)}).catch(e=>{console.log(e)}):this.save_2(t,e)},save_2:function(e,i=!1){SBF.ajax({function:"save-article",article:JSON.stringify(e)},s=>{let a=!0!==s&&!isNaN(s);if(qe=!1,a&&(Q.attr("data-id",s),e.id=s,this.viewButton(s),e.language)){let t=rt.translations.get(e.parent_id);Q.find(`.sb-language-switcher [data-language="${e.language}"]`).attr("data-id",s);for(var n=0;n<t.length;n++)if(t[n][0]==e.language){t[n][1]=e.id,rt.translations.list[e.parent_id]=t;break}}e.language||Z.find(".ul-articles .sb-active").html(e.title+'<i class="sb-icon-delete"></i>').attr("data-id",e.id),i&&i(s),t(!0===s||a?"Article saved":s)})},show:function(e){e&&(a(Q),this.get(t=>{Q.sbLoading(!1),t=t[0],Q.sbLanguageSwitcher(this.translations.get(t.parent_id?t.parent_id:e),"articles",t.language),Q.attr("data-id",e),Z.find(".sb-article-title input").val(t.title),Z.find(".sb-article-link input").val(t.link),Z.find("#sb-article-id").html(`ID <span>${e}</span>`),Z.find(".sb-article-categories").setClass("sb-hide",t.language),it||Z.find("#editorjs").length?u(t.editor_js?h(t.editor_js)?JSON.parse(t.editor_js):t.editor_js:t.content):Z.find(".sb-article-content textarea").val(t.content),t.language||(te.val(t.parent_category),ee.val(t.category)),this.viewButton(e),qe=!1},e))},add:function(){let e=Z.find(".ul-articles");e.find(".sb-active").sbActive(!1),e.append('<li class="sb-active"></li>'),Q.sbLanguageSwitcher([],"articles"),this.clear()},clear:function(){Q.removeAttr("data-id").removeClass("sb-hide"),Q.find("input, textarea, select").val(""),Q.find("input").prop("checked",!1),u(),this.viewButton(),qe=!1},delete:function(e,t=!1){SBF.ajax({function:"save-article",article:JSON.stringify({id:e,delete:!0})},e=>{this.clear(),t&&t(e)})},populate:function(t,i=!1){let s="";for(var a=0;a<t.length;a++)s+=`<li data-id="${t[a].id}">${t[a].title}<i class="sb-icon-delete"></i></li>`;Z.find(i?".ul-categories":".ul-articles").html(s),Z.find(i?".ul-categories > li":".ul-articles > li").eq(0).click(),t.length||e(i?K:Q).sbLoading(!1).addClass("sb-hide")},activeID:function(e=!1){return e?Z.find(".ul-articles .sb-active").attr("data-id"):Q.attr("data-id")},viewButton:function(e=!1){if(this.page_url){Z.find(".sb-view-article").attr("href",e?this.page_url+(this.is_url_rewrite?("/"==this.page_url.charAt(this.page_url.length-1)?"":"/")+(this.cloud_chat_id?this.cloud_chat_id+"/":""):"?article_id=")+e:"")}},categories:{list:[],save:function(e=!1){this.updateActive(),SBF.ajax({function:"save-articles-categories",categories:JSON.stringify(this.list)},i=>{e&&e(i),t(!0===i?"Categories saved":i)})},show:function(t,i=!1){let s=this.getIndex(t);if(!1!==s){let t=i?this.list[s].languages[i]:this.list[s],a=K.find("#category-image");this.updateActive(),K.find("#category-title").val(t.title),K.find("#category-description").val(t.description),K.find("#category-parent").prop("checked",!!t.parent),K.sbLanguageSwitcher(e.map(this.list[s].languages,function(e,t){return t}),"article-categories",i),t.image?a.attr("data-value",t.image).css("background-image",`url("${t.image}")`):a.removeAttr("data-value style"),K.find(".category-parent").setClass("sb-hide",i)}K.sbLoading(!1)},add:function(){let e=SBF.random();this.list.push({id:e,title:"",description:"",image:"",languages:[]});let t=`<li data-id="${e}">${o("New category")}<i class="sb-icon-delete"></i></li>`;Z.find(".ul-categories").append(t),Z.find(".ul-categories li").eq(Z.find(".ul-categories li").length-1).click(),K.removeClass("sb-hide")},delete:function(e){let t=this.getIndex(e),i=Z.find(".ul-categories");return!1!==t&&(this.list.splice(t,1),i.find(`[data-id="${e}"]`).remove(),i.find("li").eq(0).click(),!0)},update:function(){let e=ee.val(),t=te.val(),i=["","<option></option>"],s=this.list.map(function(e){return e.id});for(var a=0;a<this.list.length;a++)i[this.list[a].parent?0:1]+=`<option value="${this.list[a].id}">${this.list[a].title}</option>`;te.html(i[0]),ee.html(i[1]),this.list.length&&(te.val(s.includes(t)?t:te[0].selectedIndex>-1?this.list[te[0].selectedIndex].id:""),ee.val(s.includes(e)?e:ee[0].selectedIndex>-1?this.list[ee[0].selectedIndex].id:""))},updateActive:function(){let e=this.activeID();if(e){let t=this.getIndex(e),i=K.find(".sb-language-switcher .sb-active").attr("data-language"),s={title:K.find("#category-title").val(),description:K.find("#category-description").val(),image:K.find("#category-image").attr("data-value")};i?this.list[t].languages[i]=s:(s.id=SBF.stringToSlug(s.title),s.parent=K.find("#category-parent").is(":checked"),s.languages=this.list[t].languages,this.list[t]=s,Z.find(".ul-categories .sb-active").html(s.title+'<i class="sb-icon-delete"></i>').attr("data-id",s.id))}},clear:function(){K.find("input, textarea").val(""),K.find("#category-image").removeAttr("data-value style")},getIndex:function(e){for(var t=0;t<this.list.length;t++)if(this.list[t].id==e)return t;return!1},activeID:function(){return Z.find(".ul-categories .sb-active").attr("data-id")},translations:{add:function(t,i=!1){rt.categories.updateActive(),i||(i=rt.categories.activeID());let s=rt.categories.getIndex(i);SBF.null(rt.categories.list[s].languages)&&(rt.categories.list[s].languages={}),rt.categories.list[s].languages[t]={title:"",description:"",image:""},K.sbLanguageSwitcher(e.map(rt.categories.list[s].languages,function(e,t){return t}),"article-categories",t),rt.categories.clear()},delete:function(e,t=!1){let i=rt.categories.activeID();t||(t=rt.categories.activeID(i)),delete rt.categories.list[rt.categories.getIndex(t)].languages[e],rt.categories.show(i)}}},translations:{list:{},add:function(e,t=!1){t||(t=rt.activeID(!0));let i=this.get(t);i.push([e,!1]),this.list[t]=i,Q.sbLanguageSwitcher(i,"articles",e),rt.clear()},delete:function(e,t=!1){t||(t=rt.activeID(!0));let i=this.get(t);for(var s=0;s<i.length;s++)if(i[s][0]==e){rt.delete(i[s][1],e=>{!0===e&&(i.splice(s,1),this.list[t]=i,rt.show(t))});break}return!1},get:function(e){return e in this.list?this.list[e]:[]}}},lt={chart:!1,active_report:!1,active_date_range:!1,initChart:function(e,t="line",i=1){let s=[],a=[],n=SB_ADMIN_SETTINGS.color?[SB_ADMIN_SETTINGS.color]:["#049CFF","#74C4F7","#B9E5FF","#0562A0","#003B62","#1F74C4","#436786"];for(var o in e)s.push(e[o][0]),a.push(o);if("line"!=t&&s.length>6)for(var r=0;r<s.length;r++)n.push("hsl(210, "+Math.floor(100*Math.random())+"%, "+Math.floor(100*Math.random())+"%)");this.chart&&this.chart.destroy(),this.chart=new Chart(Ie.find("canvas"),{type:t,data:{labels:a,datasets:s&&Array.isArray(s[0])?[{data:s.map(e=>e[0]),backgroundColor:"#13ca7e"},{data:s.map(e=>e[1]),backgroundColor:"#ca3434"}]:[{data:s,backgroundColor:"line"==t?SB_ADMIN_SETTINGS.color?"#cbcbcb82":"#028be530":n,borderColor:"line"==t?SB_ADMIN_SETTINGS.color?SB_ADMIN_SETTINGS.color:"#049CFF":"#FFFFFF",borderWidth:0}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{callback:function(e,t,s){return 1==i?e:2==i?new Date(1e3*e).toISOString().substr(11,8):e},beginAtZero:!0}}],xAxes:[{ticks:{beginAtZero:!0}}]},tooltips:{callbacks:{label:function(e,t){let a=e.index,n=t.datasets[e.datasetIndex].data[a];switch(i){case 1:return n;case 2:return new Date(1e3*s[a]).toISOString().substr(11,8);case 3:return n+"%";case 4:let e=Ie.find(".sb-table tbody tr").eq(a).find("td");return e.eq(0).text()+" "+e.eq(1).text()}}},displayColors:!1}}})},initTable:function(e,t,i=!1){let s="<thead><tr>",a=t[Object.keys(t)[0]].length-1,n=[];for(r=0;r<e.length;r++)s+=`<th>${e[r]}</th>`;s+="</tr></thead><tbody>";for(var o in t)0!=t[o][a]&&n.push([o,t[o][a]]);i&&n.reverse();for(var r=0;r<n.length;r++)s+=`<tr><td><div>${n[r][0]}</div></td><td>${n[r][1]}</td></tr>`;s+="</tbody>",Ie.find("table").html(s)},initReport:function(e=!1,t=!1){let i=Ie.find(".sb-tab > .sb-content");t=SBF.null(t)?[!1,!1]:t.split(" - "),i.sbLoading(!0),e&&(this.active_report=e),this.active_report&&(this.active_date_range=t,this.getData(this.active_report,t[0],t[1],e=>{0==e?i.addClass("sb-no-results-active"):(i.removeClass("sb-no-results-active"),this.initChart(e.data,e.chart_type,e.label_type),this.initTable(e.table,e.data,e.table_inverse),Ie.find(".sb-reports-title").html(e.title),Ie.find(".sb-reports-text").html(e.description),Ie.find(".sb-collapse-btn").remove(),ze||l(Ie.find(".sb-collapse"),Ie.find("canvas").outerHeight()-135)),i.sbLoading(!1)}))},getData:function(e,t=!1,i=!1,s){SBF.ajax({function:"reports",name:e,date_start:t,date_end:i,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},e=>{s(e)})},export:function(e){SBF.ajax({function:"reports-export",name:this.active_report,date_start:this.active_date_range[0],date_end:this.active_date_range[1],timezone:Intl.DateTimeFormat().resolvedOptions().timeZone},t=>{e(t)})},open:function(e){x.find(".sb-admin-nav #sb-reports").click(),setTimeout(()=>{Ie.find("#"+e).click().get(0).scrollIntoView()},300)}},ct={real_time:null,datetime_last_user:"2000-01-01 00:00:00",sorting:["creation_time","DESC"],user_types:["visitor","lead","user"],user_main_fields:["id","first_name","last_name","email","password","profile_image","user_type","creation_time","token","last_activity","department"],search_query:"",init:!1,busy:!1,table_extra:!1,history:[],get:function(e,t=!1,i=!1){let s=[];for(var n=0;n<O.length;n++)s.push(O.eq(n).find("li.sb-active").data("value"));i||a(P),SBF.ajax({function:t?"get-online-users":"get-users",sorting:t?this.sorting[0]:this.sorting,pagination:!!i&&Ge,user_types:this.user_types,search:this.search_query,extra:this.table_extra,department:s[0],source:s[1],tag:s[2]},t=>{e(t),P.sbLoading(!1)})},filter:function(e){e="all"==e?["visitor","lead","user"]:"agent"==e?["agent","admin"]:[e],this.user_types=e,Ge=1,Ue=1,this.get(e=>{this.populate(e)},"online"==e[0])},sort:function(e,t="DESC"){this.sorting=[e,t],Ge=1,Ue=1,this.get(e=>{this.populate(e)})},search:function(t){c(t,(t,i)=>{Ge=1,Ue=1,this.search_query=t,this.get(t=>{this.user_types=["visitor","lead","user"],this.populate(t),e(i).sbLoading(!1),q.find("li").sbActive(!1).eq(0).sbActive(!0)})})},populate:function(t){let i="",s=t.length;if(s)for(var a=0;a<s;a++)i+=this.getRow(new SBUser(t[a],t[a].extra));else i=`<p class="sb-no-results">${o("No users found.")}</p>`;P.parent().scrollTop(0),P.find("tbody").html(i),this.user_types.includes("agent")&&SBF.ajax({function:"get-online-users",agents:!0},t=>{let i=[];for(var s=0;s<t.length;s++)i.push(t[s].id);P.find("[data-user-id]").each(function(){e(this).find(".sb-td-profile").addClass("sb-"+(i.includes(e(this).attr("data-user-id"))?"online":"offline"))})})},update:function(){if(!this.busy){let e=["user","visitor","lead","agent"],t=e.includes(this.user_types[0])&&!this.search_query,i=q.find(".sb-active").data("type");"online"==i?this.filter(i):(this.busy=!0,SBF.ajax({function:"get-new-users",datetime:this.datetime_last_user},s=>{let a=s.length;if(this.busy=!1,a>0){let o="";for(n=0;n<a;n++){let e=new SBUser(s[n]);je[e.id]=e,this.updateMenu("add",e.type),t&&(o+=this.getRow(e))}if(t&&(P.find("tbody").prepend(o),e.includes(i))){let t="";for(var n=0;n<e.length;n++)t+=e[n]==i?"":`[data-user-type="${e[n]}"],`;P.find(t.slice(0,-1)).remove()}this.datetime_last_user=s[0].creation_time}}))}},getRow:function(e){if(e instanceof SBUser){let i="";if(e.name.includes("open-ai-temp-user"))return ie.sbActive()||nt.openAI.playground.deleteData(),"";for(var t=0;t<this.table_extra.length;t++){let s=this.table_extra[t];i+=`<td class="sb-td-${s}">${this.user_main_fields.includes(s)?e.get(s):e.getExtra(s)}</td>`}return`<tr data-user-id="${e.id}" data-user-type="${e.type}"><td><input type="checkbox" /></td><td class="sb-td-profile"><a class="sb-profile"><img loading="lazy" src="${e.image}" /><span>${e.name}</span></a></td>${i}<td class="sb-td-email">${e.get("email")}</td><td class="sb-td-ut">${o(e.type)}</td><td>${SBF.beautifyTime(e.get("last_activity"),!0)}</td><td>${SBF.beautifyTime(e.get("creation_time"))}</td></tr>`}return SBF.error("User not of type SBUser","SBUsers.getRow"),!1},updateRow:function(e){let t=P.find(`[data-user-id="${e.id}"]`);if(t.length){let i=q.find(".sb-active").data("type");if(e.type==i||"admin"==e.type&&"agent"==i||"all"==i)t.replaceWith(this.getRow(e));else{let i=k.find(`[data-type="${"admin"==e.type?"agent":e.type}"] span`),s=parseInt(i.attr("data-count"));i.html(s+1).attr("data-count",s+1),t.remove()}}else P.find("tbody").append(this.getRow(e))},updateMenu:function(e="all",t=!1){let i=["all","user","lead","visitor"];"all"==e?SBF.ajax({function:"count-users"},e=>{for(var t=0;t<i.length;t++)this.updateMenuItem("set",i[t],e[i[t]])}):this.updateMenuItem(e,t)},updateMenuItem:function(e="set",t=!1,i=1){let s=q.find(`[data-type="${t}"] span`),a=["user","lead","visitor"];"set"!=e&&(i=parseInt(s.attr("data-count"))+1*("add"==e?1:-1)),s.html(`(${i})`).attr("data-count",i),i=0;for(var n=0;n<a.length;n++)i+=parseInt(q.find(`[data-type="${a[n]}"] span`).attr("data-count"));q.find('[data-type="all"] span').html(`(${i})`).attr("data-count",i)},delete:function(e){if(a(P),Array.isArray(e)){if(SB_ADMIN_SETTINGS.cloud&&!(e=SBCloud.removeAdminID(e)).length)return;SBF.ajax({function:"delete-users",user_ids:e},()=>{for(var i=0;i<e.length;i++)delete je[e[i]],P.find(`[data-user-id="${e[i]}"]`).remove(),C.find(`[data-user-id="${e[i]}"]`).remove(),SBF.event("SBUserDeleted",e[i]);0==P.find("[data-user-id]").length&&this.filter(q.find(".sb-active").data("type")),t("Users deleted"),this.updateMenu(),P.sbLoading(!1)})}else je[e].delete(()=>{let i=C.find(`[data-user-id="${e}"]`);s().id==e&&s(!1),i.sbActive()&&(SBChat.conversation=!1,setTimeout(()=>{dt.clickFirst()},300)),delete je[e],P.find(`[data-user-id="${e}"]`).remove(),i.remove(),k.sbHideLightbox(),t("User deleted"),this.updateMenu(),P.sbLoading(!1)})},startRealTime:function(){SBPusher.active||(this.stopRealTime(),this.real_time=setInterval(()=>{this.update()},1e3))},stopRealTime:function(){clearInterval(this.real_time)},csv:function(){SBF.ajax({function:"csv-users",users_id:ct.getSelected()},e=>{_(e,"sb-export-users-close","Users exported"),window.open(e)})},updateUsersActivity:function(){SBF.updateUsersActivity(Qe?SB_ACTIVE_AGENT.id:-1,s()?s().id:-1,function(e){ct.setActiveUserStatus("online"==e)})},setActiveAgentStatus:function(e=!0){let t=e?"online":"offline";Qe=e,x.find('[data-value="status"]').html(o(SBF.slugToString(t))).attr("class","sb-"+t),SBPusher.active&&(e?(SBPusher.presence(),"queue"!=SB_ADMIN_SETTINGS.routing&&"routing"!=SB_ADMIN_SETTINGS.routing||SBF.ajax({function:"assign-conversations-active-agent",is_queue:"queue"==SB_ADMIN_SETTINGS.routing},()=>{dt.update()})):SBPusher.presenceUnsubscribe()),SB_ADMIN_SETTINGS.reports_disabled||SBF.ajax({function:"reports-update",name:t})},setActiveUserStatus:function(e=!0){let t=A.find(".sb-conversation .sb-top > .sb-labels");t.find(".sb-status-online").remove(),e&&t.prepend(`<span class="sb-status-online">${o("Online")}</span>`),SBChat.user_online=e},onlineUserNotification:function(e){let t=SB_ADMIN_SETTINGS.online_users_notification;if(t){let i=e.info.first_name+" "+e.info.last_name,s=this.userProfileImage(e.info.profile_image);SB_ADMIN_SETTINGS.push_notifications&&e.info.id&&!this.history.includes(e.info.id)?SBF.ajax({function:"push-notification",title:t,message:i,icon:s,interests:SB_ACTIVE_AGENT.id,user_id:e.info.id}):dt.desktop_notifications&&SBChat.desktopNotification(t,i,s,!1,e.info.id),this.history.push(e.info.id)}},userProfileImage:function(e){return!e||e.indexOf("user.svg")?SB_ADMIN_SETTINGS.notifications_icon:e},getSelected:function(){let t=[];return P.find("tr").each(function(){e(this).find('td input[type="checkbox"]').is(":checked")&&t.push(e(this).attr("data-user-id"))}),t},getExtraDetailsList:function(t=!1){return V.find(".sb-additional-details .sb-edit-box > "+(t?".sb-custom-detail":".sb-input")).map(function(){return[[e(this).attr("id"),e(this).find("span").html().trim()]]}).get()}},dt={real_time:null,datetime_last_conversation:!1,user_typing:!1,desktop_notifications:!1,flash_notifications:!1,notifications_list:{},busy:!1,busy_2:!1,is_search:!1,menu_count_ajax:!1,previous_editor_text:!1,message_drafts:{},open:function(e=-1,t){-1!=e&&this.openConversation(e,t),k.sbHideLightbox(),x.find(".sb-admin-nav a").sbActive(!1).parent().find("#sb-conversations").sbActive(!0),k.find(" > main > div").sbActive(!1),A.sbActive(!0).find(".sb-board").removeClass("sb-no-conversation"),Ce.find(" > p").attr("data-id","").attr("data-value","").html(o("None")),this.notes.update([]),this.tags.update([]),this.startRealTime()},openConversation:function(i,a=!1,n=!0){if(SBChat.label_date.sbActive(!1),SBChat.label_date_show=!1,this.busy_2!=i)if(!1===a&&i)this.busy_2=i,SBF.ajax({function:"get-user-from-conversation",conversation_id:i},e=>{this.busy_2=!1,SBF.null(e.id)?this.clickFirst():this.openConversation(i,e.id,n)});else{let r=SBF.null(je[a])||!je[a].details.email,l=A.find(`[data-conversation-id="${i}"]`),c=C.find("li"),d=this.getSelectedConversations();T.html(""),T.sbLoading(!0),d.length&&(this.message_drafts[d[0].id]=G.val().trim(),SBF.storage("message-drafts",dt.message_drafts)),G.val(""),SBChat.insertText(this.message_drafts[i]?this.message_drafts[i]:""),r?(s(new SBUser({id:a})),s().update(()=>{je[a]=s(),this.updateUserDetails()})):(s(je[a]),this.updateCurrentURL()),SBPusher.active&&(SBPusher.event("client-typing",e=>{e.user_id==s().id&&(dt.typing(!0),clearTimeout(Se),Se=setTimeout(()=>{dt.typing(!1)},1e3))}),SBPusher.event("new-message",()=>{SBChat.update()}),SBPusher.event("agent-active-conversation-changed",e=>{e.previous_conversation_id==i&&A.find(".sb-conversation-busy").remove()},"agents"),SBPusher.event("init",e=>{dt.updateCurrentURL(e.current_url)}),SBPusher.event("message-status-update",e=>{SBChat.conversation&&SBChat.conversation.updateMessagesStatus(e.message_ids)})),SB_ADMIN_SETTINGS.smart_reply&&R.html(""),c.sbActive(!1),SB_ADMIN_SETTINGS.departments_show||c.attr("data-color",""),l.sbActive(!0),-1!=i?(this.busy_2=i,s().getFullConversation(i,a=>{let r=a.status_code,d=F.eq(0),u=d.find(".sb-active").attr("data-value");if(this.busy_2=!1,SBChat.setConversation(a),SBChat.populate(),this.setReadIcon(r),A.find(".sb-conversation-busy").remove(),this.updateUserDetails(),A.find(".sb-top > a").html(a.get("title")),pt.must_translate=SB_ADMIN_SETTINGS.translation&&s().language&&SB_ADMIN_SETTINGS.active_agent_language!=s().language,pt.must_translate){let e=[],t=[],s=[],n=[];for(f=0;f<a.messages.length;f++){let i=a.messages[f];i.message&&(i.payload("original-message")&&(!i.payload("original-message-language")||i.payload("original-message-language")==SB_ADMIN_SETTINGS.active_agent_language)||i.payload("translation")&&(!i.payload("translation-language")||i.payload("translation-language")==SB_ADMIN_SETTINGS.active_agent_language)?n.push(i):(e.push(i.message),t.push(i.id),s.push(i.get("user_type"))))}e.length?nt.dialogflow.translate(e,SB_ADMIN_SETTINGS.active_agent_language,e=>{if(e)for(var i=0;i<e.length;i++){let a=SBChat.conversation.getMessage(t[i]);a.payload("translation",e[i]),a.payload("translation-language",SB_ADMIN_SETTINGS.active_agent_language),this.openConversation_2(t[i],s[i])}SB_ADMIN_SETTINGS.smart_reply&&this.openConversation_1(SBChat.conversation,R)},t,i):SB_ADMIN_SETTINGS.smart_reply&&this.openConversation_1(SBChat.conversation,R);for(f=0;f<n.length;f++)this.openConversation_2(n[f].id,n[f].get("user_type"))}if(Ce.length){let e=!!a.get("department")&&this.getDepartments(a.get("department")),t=e?e["department-color"]:"";SB_ADMIN_SETTINGS.departments_show||c.attr("data-color",""),w(i).attr("data-color",t),Ce.find(" > p").attr("data-id",e?e["department-id"]:"").attr("data-value",t).html(e?e["department-name"]+"<span></span>":o("None"))}let p=A.find("#conversation-agent");if(p.length){let e=p.find(`[data-id="${a.get("agent_id")}"]`);p.find(" > p").attr("data-value",e.data("id")).html(e.html())}[1,2,"1","2"].includes(r)&&(r=0),u==r||e(I).find(".sb-search-btn").sbActive()||dt.filters()[1]||dt.filters()[3]||(d.find(`[data-value="${r}"]`).click(),d.find("ul").sbActive(!1)),ze&&this.mobileOpenConversation(),l.length||u!=r&&(0!=u||1!=r)||C.prepend(dt.getListCode(a)),C.find("li").sbActive(!1),l.sbActive(!0),n&&this.scrollTo(),this.notificationsCounterReset(i,l),T.sbInitTooltips();let h=a.get("busy");if(h&&A.find(".sb-editor > .sb-labels").prepend(`<span data-agent="${h.id}" class="sb-status-warning sb-conversation-busy">${h.first_name} ${h.last_name} ${o("is replying to this conversation")}</span>`),nt.is("woocommerce")&&nt.woocommerce.conversationPanel(),nt.is("ump")&&nt.ump.conversationPanel(),nt.is("perfex")&&nt.perfex.conversationPanel(),nt.is("whmcs")&&nt.whmcs.conversationPanel(),nt.is("aecommerce")&&nt.aecommerce.conversationPanel(),nt.is("martfury")&&nt.martfury.conversationPanel(),nt.is("armember")&&nt.armember.conversationPanel(),nt.is("zendesk")&&nt.zendesk.conversationPanel(),nt.is("opencart")&&nt.opencart.conversationPanel(),s()&&SB_ADMIN_SETTINGS.cloud&&(SBCloud.shopify.panel&&SBCloud.shopify.panel.html(""),SBCloud.shopify.conversationPanel()),nt.calendar.conversationPanel(),this.notes.update(a.details.notes),this.tags.update(a.details.tags),this.attachments(),SB_ADMIN_SETTINGS.smart_reply&&!pt.must_translate&&this.openConversation_1(a,R),"em"==a.get("source")&&this.cc(a.get("extra").split(",")),"wa"==a.get("source")){let e=a.getLastUserMessage();e&&new Date-new Date(e.get("creation_time").replace(" ","T"))>864e5&&t(o("You can't send a WhatsApp message more than 24 hours after the user's last messageuse a template instead.")+'<i id="sb-whatsapp-alert-btn" class="sb-icon-social-wa"</i>',"info")}if(s().getConversations(function(e){A.find(".sb-user-conversations").html(1==e.length?"":s().getConversationsCode(e)).prev().setClass("sb-hide",1==e.length)}),this.is_search){let e=I.find(".sb-search-btn input").val();for(var f=0;f<a.messages.length;f++)a.messages[f].message.toLowerCase().includes(e)&&this.highlightMessage(a.messages[f].id)}T.sbLoading(!1)})):(SBChat.clear(),C.find("li").sbActive(!1),T.sbLoading(!1),A.find(".sb-top > a").html(""),r||this.updateUserDetails()),A.find(".sb-board").removeClass("sb-no-conversation"),dt.previous_editor_text=!1,ct.updateUsersActivity(),this.startRealTime(),SBF.getURL("conversation")!=i&&-1!=i&&f("?conversation="+i)}},openConversation_1:function(e,t){let i=e.getLastUserMessage();t.html(""),i&&i.payload("sb-human-takeover")&&(i=e.getLastUserMessage(i.get("index"))),i&&nt.dialogflow.smartReply(i.message)},openConversation_2:function(e,t){let i=SBChat.conversation.getMessage(e);if(i){let s=SBF.isAgent(t)&&"bot"!=t;T.find(`[data-id="${e}"]`).replaceWith(i.getCode()),T.find(`[data-id="${e}"] .sb-menu`).prepend(`<li data-value="${s?"translation":"original"}">${o(s?"View translation":"View original message")}</li>`)}},highlightMessage:function(t){setTimeout(()=>{let i="";T.find("> div").each(function(){let s=e(this);s.attr("data-id")==t?(s.addClass("sb-highlight"),setTimeout(()=>{s.removeClass("sb-highlight")},5e3),SBChat.label_date.html(i),SBChat.label_date_show=!0,s.index()?s.prev()[0].scrollIntoView():s[0].scrollIntoView()):s.hasClass("sb-label-date")&&(i=s.html())})},300)},populateList:function(e){let t="";Fe=[];for(var i=0;i<e.length;i++)t+=this.getListCode(e[i]),Fe.push(new SBConversation([new SBMessage(e[i])],e[i]));t||(t=`<p class="sb-no-results">${o("No conversations found.")}</p>`),C.html(t),this.updateMenu(),SBF.event("SBAdminConversationsLoaded",{conversations:e})},update:function(){if(!this.busy&&0==F.eq(0).find("p").attr("data-value")&&this.datetime_last_conversation&&"conversations"==at){let t=dt.filters();if(this.busy=!0,SBF.ajax({function:"get-new-conversations",datetime:this.datetime_last_conversation,department:t[1],source:t[2],tag:t[3],agent_id:t[4]},t=>{if(this.busy=!1,t.length){let n,o="",r="",l=SBChat.conversation?SBChat.conversation.id:-1,c=!1,d=[];t[0].last_update_time&&(this.datetime_last_conversation=t[0].last_update_time);for(i=0;i<t.length;i++)if(!d.includes(t[i].id)){let e=new SBMessage(t[i]),a=new SBConversation([e],t[i]),u=a.status_code,p=2==u||SB_ADMIN_SETTINGS.order_by_date&&(0==u||1==u),h=a.user_id,f=a.id,g=w(f),b=g.length,v=e.get("user_type"),m=a.get("message"),_=l==f,S=!SBF.isAgent(v);!m&&e.payload("preview")&&(m=e.payload("preview")),!p||_&&"hidden"!=SBF.visibility_status||!S&&!e.payload("human-takeover-message-confirmation")||(dt.notifications_list=SBF.storage("notifications-counter"),dt.notifications_list||(dt.notifications_list={}),dt.notifications_list[f]||(dt.notifications_list[f]=[]),dt.notifications_list[f].includes(e.id)||(dt.notifications_list[f].push(e.id),SBF.storage("notifications-counter",dt.notifications_list)));let y=this.getListCode(a,null);_?(this.updateUserDetails(),b?(m&&g.replaceWith(y),this.setStatus(u,f)):c=!0):b&&(Fe[g.index()]=a,w(f).remove()),h in je||(je[h]=new SBUser({id:h,first_name:a.get("first_name"),last_name:a.get("last_name"),profile_image:a.get("profile_image"),user_type:v})),_&&b||(p?(o+=y,Fe.unshift(a)):0!=u&&1!=u||((n=C.find('[data-conversation-status="2"]').last()).length?(Fe.splice(n.index()+1,0,a),r+=y):o+=y),s()&&h==s().id&&s().getConversations(e=>{A.find(".sb-user-conversations").html(s().getConversationsCode(e))}),SBF.event("SBAdminNewConversation",{conversation:a})),!s()||"update-user"!=e.payload("event")&&je[h].type==v||s().update(()=>{this.updateUserDetails(),je[s().id]=s()});let k=e.payload("preview");if(!SBChat.tab_active&&2==u&&(S||k)&&(m||a.getAttachments().length||k)){if(this.desktop_notifications){let e=[je[h].nameBeautified,je[h].image];SBChat.desktopNotification(e[0],k||m,e[1],f,h)}this.flash_notifications&&SBChat.flashNotification(),SBChat.audio&&SB_ADMIN_SETTINGS.sound&&SBChat.playSound()}d.push(f)}dt.is_search||(o&&C.prepend(o),r&&e(r).insertAfter(n),c&&this.scrollTo(),this.updateMenu());for(var i=0;i<SBChat.notifications.length;i++){let e=!1;for(var a=0;a<Fe.length;a++)if(Fe[a].id==SBChat.notifications[i][0]){e=2==Fe[a].status_code;break}e||(SBChat.notifications.splice(i,1),i--)}}}),SB_ADMIN_SETTINGS.assign_conversation_to_agent||SB_ACTIVE_AGENT.department){let t=C.find(" > li").map(function(){return e(this).attr("data-conversation-id")}).get();t.length&&SBF.ajax({function:"check-conversations-assignment",conversation_ids:t,agent_id:!!SB_ADMIN_SETTINGS.assign_conversation_to_agent&&SB_ACTIVE_AGENT.id,department:SB_ACTIVE_AGENT.department},e=>{if(e)for(var t=0;t<e.length;t++)w(e[t]).remove()})}}},updateMenu:function(){let e=C.find('[data-conversation-status="2"]').length,t=F.eq(0),i=t.find(" > p span");if(100==e||this.menu_count_ajax||SB_ADMIN_SETTINGS.order_by_date){let e=t.find("li.sb-active").data("value");this.menu_count_ajax=!0,SBF.ajax({function:"count-conversations",status_code:0==e?2:e},e=>{i.html(`(${e})`)})}else i.html(`(${e})`)},messageMenu:function(e,t=!1,i=!1){return`<i class="sb-menu-btn sb-icon-menu"></i><ul class="sb-menu">${(t&&SB_ADMIN_SETTINGS.chatbot_features?`<li data-value="bot">${o("Train chatbot")}</li>`:"")+(e&&!SB_ADMIN_SETTINGS.supervisor&&SB_ADMIN_SETTINGS.allow_agent_delete_message||SB_ADMIN_SETTINGS.supervisor&&SB_ADMIN_SETTINGS.allow_supervisor_delete_message?`<li data-value="delete">${o("Delete")}</li>`:"")+(i?`<li data-value="reply">${o("Reply")}</li>`:"")}</ul>`},updateUserDetails(){s()&&(A.find(`[data-user-id="${s().id}"] .sb-name`).html(s().name),A.find(".sb-top > a").html(SBChat.conversation?SBChat.conversation.title:s().name),$.find(".sb-profile").setProfile(),ut.populate(s(),A.find(".sb-profile-list")))},setReadIcon(e){let t=2==e;A.find('.sb-top [data-value="read"],.sb-top [data-value="unread"]').sbActive([0,1,2].includes(parseInt(e))).attr("data-value",t?"read":"unread").attr("data-sb-tooltip",o(t?"Mark as read":"Mark as unread")).parent().sbInitTooltips().find("i").attr("class",t?"sb-icon-check-circle":"sb-icon-circle")},setStatus(e,t=!1,i=!1){t||(t=SBChat.conversation.id),t&&(Fe[w(t).index()].set("status_code",e),this.setReadIcon(e),i&&w(t).attr("data-conversation-status",e))},getListCode:function(e,t){if(e instanceof SBConversation||(e=new SBConversation([new SBMessage(e)],e)),"open-ai-temp-conversation"==e.details.title)return ie.sbActive()||nt.openAI.playground.deleteData(),"";let i=e.getCode(!0),s=SB_ADMIN_SETTINGS.tags_show?e.get("tags"):"",a=e.get("department"),n="",o=e.get("last_update_time"),r=SBChat.conversation&&SBChat.conversation.id==e.id;if(SBF.null(t)&&(t=e.status_code),s&&(s=dt.tags.codeLeft(s)),!SBChat.conversation||!r||"hidden"==SBF.visibility_status){let i=SBF.storage("notifications-counter");i&&i[e.id]&&i[e.id].length&&(2==t?n=`<span class="sb-notification-counter">${i[e.id].length}</span>`:(i[e.id]=[],SBF.storage("notifications-counter",i),this.notifications_list=i))}return o||(o=e.getLastMessage()?e.getLastMessage().get("creation_time"):e.get("creation_time")),`<li${r?' class="sb-active"':""} data-user-id="${e.get("user_id")}" data-conversation-id="${e.id}" data-conversation-status="${t}"${a?` data-department="${a}"${SB_ADMIN_SETTINGS.departments_show?' data-color="'+this.getDepartments(a)["department-color"]+'"':""}`:""}${SBF.null(e.get("source"))?"":` data-conversation-source="${e.get("source")}"`}>${""+n}<div class="sb-profile"><img loading="lazy" src="${e.get("profile_image")}"><span class="sb-name">${e.get("first_name")+" "+e.get("last_name")}</span>${s}<span class="sb-time">${SBF.beautifyTime(o)}</span></div><p>${i}</p></li>`},startRealTime:function(){SBPusher.active||(this.stopRealTime(),this.real_time=setInterval(()=>{this.update(),this.updateCurrentURL()},1e4),SBChat.startRealTime())},stopRealTime:function(){clearInterval(this.real_time),SBChat.stopRealTime()},transcript:function(e,t,i=!1,a=!1){SBF.ajax({function:"transcript",conversation_id:e},e=>{"email"==i?s()&&s().id==t&&!s().get("email")||SBChat.sendEmail(SB_ADMIN_SETTINGS.transcript_message,[[e,e]],t,t=>{a&&a(!0===t?e:t)}):(a&&a(e),window.open(e))})},typing:function(e){e?(SBChat.user_online||ct.setActiveUserStatus(!0),this.user_typing||(A.find(".sb-conversation .sb-top > .sb-labels").append('<span class="sb-status-typing">'+o("Typing")+"</span>"),this.user_typing=!0)):this.user_typing&&(A.find(".sb-conversation .sb-top .sb-status-typing").remove(),this.user_typing=!1)},scrollTo:function(){let e=C.find(".sb-active"),t=e.length?e[0].offsetTop:0;C.parent().scrollTop(t-(ze?120:80))},search:function(t){t&&c(t,(t,i)=>{if(Re=1,t.length>1)SBF.ajax({function:"search-conversations",search:t},t=>{dt.populateList(t),e(i).sbLoading(!1),this.scrollTo(),this.is_search=!0});else{let t=dt.filters();Me=1,SBF.ajax({function:"get-conversations",status_code:t[0],department:t[1],source:t[2],tag:t[3],agent_id:t[4]},t=>{dt.populateList(t),e(i).sbLoading(!1),this.is_search=!1,SBChat.conversation&&(w(SBChat.conversation.id).sbActive(!0),this.scrollTo())})}})},notificationsCounterReset:function(e,t=!1){let i=SBF.storage("notifications-counter");if(i&&i[e]){t||(t=C.find('[data-conversation-id="'+e+'"]'));let s=t.find(".sb-notification-counter");i[e]=[],SBF.storage("notifications-counter",i),this.notifications_list=i,s.addClass("sb-fade-out"),setTimeout(()=>{s.remove()},200)}},getNotificationsCounterCount:function(){let e=SBF.storage("notifications-counter"),t={},i=0;if(e){for(let s in e)e[s]&&e[s].length&&(i+=e[s].length,t[s]=e[s]);SBF.storage("notifications-counter",t)}return i},updateCurrentURL:function(e=!1){e?this.ucurl(e):SBChat.user_online&&s()&&s().getExtra("current_url")&&SBF.ajax({function:"current-url"},e=>{e&&this.ucurl(e)})},ucurl(e){let t=s().getExtra("current_url");e=b(e),A.find('.sb-profile-list [data-id="current_url"] label').attr("data-value",e).html(e),t&&(t.value=e,s().setExtra("current_url",t))},assignDepartment:function(e,t,i){SBF.ajax({function:"update-conversation-department",conversation_id:e,department:t,message:SBChat.conversation.getLastMessage().message},e=>{i(e)})},assignAgent:function(e,t,i=!1){SBF.ajax({function:"update-conversation-agent",conversation_id:e,agent_id:t,message:SBChat.conversation.getLastMessage().message},e=>{i&&i(e)})},setActiveDepartment:function(e){if(SBChat.conversation&&SBChat.conversation.get("department")==e)return;let i=!!e&&this.getDepartments(e),s=i?i["department-color"]:"",a=w(SBChat.conversation.id),n=dt.filters()[1];Ce.find(" > p").attr("data-id",i?i["department-id"]:"").attr("data-value",s).html((i?i["department-name"]:o("None"))+"<span></span>").next().sbActive(!1),SBChat.conversation.set("department",e),n&&n!=e||"agent"==SB_ACTIVE_AGENT.user_type&&SB_ACTIVE_AGENT.department&&SB_ACTIVE_AGENT.department!=e?(a.remove(),dt.clickFirst()):a.attr("data-color",s),t("Department updated. The agents have been notified.")},getDepartments:function(e=!1){if(e){for(var t=0;t<SB_ADMIN_SETTINGS.departments.length;t++)if(SB_ADMIN_SETTINGS.departments[t]["department-id"]==e)return SB_ADMIN_SETTINGS.departments[t];return!1}return SB_ADMIN_SETTINGS.departments},setActiveAgent:function(e){let i=A.find("#conversation-agent"),s=i.find(`[data-id="${e}"]`);SBChat.conversation.set("agent_id",e),i.find(" > p").attr("data-value",s.data("id")).html(s.html()).next().sbActive(!1),"agent"!=SB_ACTIVE_AGENT.user_type||SB_ADMIN_SETTINGS.assign_conversation_to_agent&&!e||(w(SBChat.conversation.id).remove(),dt.clickFirst()),e&&t("Agent assigned. The agent has been notified.")},getSelectedConversations:function(){return C.find(".sb-active").map(function(){return{id:e(this).attr("data-conversation-id"),user_id:e(this).attr("data-user-id"),status_code:e(this).attr("data-conversation-status")}}).toArray()},mobileOpenConversation:function(){A.find(".sb-admin-list").sbActive(!1),B.sbActive(!0),x.addClass("sb-hide")},mobileCloseConversation:function(){C.find("li.sb-active").sbActive(!1),A.find(".sb-admin-list").sbActive(!0),A.find(".sb-conversation,.sb-user-details").removeClass("sb-active"),k.find('.sb-menu-mobile [data-value="panel"]').sbActive(!1),x.removeClass("sb-hide"),window.history.replaceState({},document.title,SBF.URL())},clickFirst:function(e=!1){e&&e.length||(e=C.find("li:first-child")),e.length?(e.click(),dt.scrollTo()):(A.find(".sb-board").addClass("sb-no-conversation"),C.find("li").length||C.html(`<p class="sb-no-results">${o("No conversations found.")}</p>`),SBF.getURL("conversation")&&window.history.replaceState({},document.title,SBF.URL().replace("?conversation="+SBF.getURL("conversation"),"")))},savedReplies:function(t,i){let s=i.charAt(t.selectionStart-1),a=i.substr(0,i.lastIndexOf("#"));if("#"==s){if(i.length>1&&"#"==i.charAt(t.selectionStart-2))return e(t).val(a.substr(0,a.length-1)),B.find(".sb-btn-saved-replies").click();SBChat.editor_listening=!0}if(SBChat.editor_listening&&" "==s){let s=i.substr(i.lastIndexOf("#")+1).replace(" ","");SBChat.editor_listening=!1;for(var n=0;n<Ne.length;n++)if(Ne[n]["reply-name"]==s)return void e(t).val(a+Ne[n]["reply-text"])}},attachments:function(){if(L.length){let i=SBChat.conversation.getAttachments(),s="",a="",n=[],r={audio:["mp3","wav","ogg","m4a"],video:["mp4","avi","mov","mkv","webm","wmv"],pdf:["pdf"],doc:["doc","docx","txt","rtf","odt"],ppt:["ppt","pptx","key","odp"],xls:["xls","xlsx","csv","ods"],archive:["zip","rar","7z","tar","gz","bz2"],image:["jpg","jpeg","png","gif","bmp","webp","svg","tiff","heic","psd","ai"],text:["txt","log","md","json"]};for(t=i.length-1;t>-1;t--){let e,a=SBF.getFileType(i[t][1]),o=i[t][1].split(".").pop().split("?")[0].toLowerCase();for(let t in r)if(r[t].includes(o)){e=t;break}s+=`<a href="${i[t][1]}" target="_blank"><img src="${SB_URL}/media/files/${e||"default"}.svg">${i[t][0]}</a>`,n.includes(a)||n.push(a)}if(i.length>4&&n.length>1){a=`<div id="sb-attachments-filter" class="sb-select"><p>${o("All")}</p><ul><li data-value="">${o("All")}</li>`;for(var t=0;t<n.length;t++)a+=`<li data-value="${n[t]}">${o(SBF.slugToString(n[t])+"s")}</li>`;a+="</ul></div>"}e(L).html(s?`<h3${a?' class="sb-flex"':""}>${o("Attachments")}${a}</h3><div class="sb-list-items sb-list-links">${s}</div>`:""),l(L,160)}},filters:function(){let e=[];for(var t=0;t<F.length;t++)e.push(F.eq(t).find("li.sb-active").data("value"));return e},notes:{busy:!1,add:function(e,t,i,s,a=!1,n=!1){SBF.ajax({function:n?"update-note":"add-note",conversation_id:e,user_id:t,note_id:n,name:i,message:s},e=>{a&&a(e)})},update:function(e,t=!1){if(E.length){let s="",a=E.find(" > div");if(e){for(var i=0;i<e.length;i++){let t=e[i];s+=`<div data-id="${t.id}"><span${SB_ADMIN_SETTINGS.notes_hide_information?' class="sb-note-hide-info"':""}>${SB_ADMIN_SETTINGS.notes_hide_information?"":t.name}${SB_ADMIN_SETTINGS.notes_hide_information||!t.date?"":`<span>${SBF.beautifyTime(t.date,!0)}</span>`}${SB_ACTIVE_AGENT.id==t.user_id?'<i class="sb-edit-note sb-icon-edit"></i><i class="sb-delete-note sb-icon-close"></i>':""}</span><span class="sb-note-text">${t.message.replace(/\n/g,"<br>")}</span></div>`}s=s.autoLink({target:"_blank"})}t?a.append(s):a.html(s),a.attr("style",""),E.find(".sb-collapse-btn").remove(),l(E,155),this.busy=!1}},delete:function(e,t,i=!1){this.busy||(this.busy=!0,SBF.ajax({function:"delete-note",conversation_id:e,note_id:t},e=>{this.busy=!1,i&&i(e)}))}},tags:{busy:!1,update:function(e){if(N.length){let i="",s=N.find(" > div");for(var t=0;t<e.length;t++){let s=this.get(e[t]);s&&(i+=this.code(s))}s.html(i),this.busy=!1}},get:function(e){for(var t=0;t<SB_ADMIN_SETTINGS.tags.length;t++)if(e==SB_ADMIN_SETTINGS.tags[t]["tag-name"])return SB_ADMIN_SETTINGS.tags[t]},getAll:function(e=[]){let t="";for(var i=0;i<SB_ADMIN_SETTINGS.tags.length;i++)t+=this.code(i,e.includes(SB_ADMIN_SETTINGS.tags[i]["tag-name"]));return t},code:function(e,t){let i=isNaN(e)?e:SB_ADMIN_SETTINGS.tags[e];if(i){let e=i["tag-name"];return`<span data-value="${e}" data-color="${i["tag-color"]}"${t?' class="sb-active"':""}>${o(e)}</span>`}return""},codeLeft:function(e){let t='<span class="sb-tags-area">';for(var i=0;i<e.length;i++){let s=this.get(e[i]);s&&(t+=`<i class="sb-icon-tag" data-color-text="${s["tag-color"]}"></i>`)}return t+"</span>"}},showDirectMessageBox:function(e,t=[]){if("whatsapp"==e)m(t);else{let i="custom_email"==e;SBForm.clear(D),D.find(".sb-direct-message-users").val(t.length?t.join(","):"all"),D.find(".sb-bottom > div").html(""),D.find(".sb-top-bar > div:first-child").html(o(`Send a ${{sms:"text message",custom_email:"email",message:"chat message"}[e]}`)),D.find(".sb-loading").sbLoading(!1),D.find(".sb-direct-message-subject").sbActive(i).find("input").attr("required",i),D.attr("data-type",e),D.sbShowLightbox()}},getDeliveryFailedMessage:function(e){return`<i class="sb-icon-warning sb-delivery-failed" data-sb-tooltip="${o("Message not delivered to {R}.").replace("{R}",nt.getMessagingAppName(e))}" data-sb-tooltip-init></i>`},cc:function(e){let t="";for(var i=0;i<e.length;i++)e[i]&&(t+=`<li data-id="cc"><i class="sb-icon sb-icon-envelope"></i><span>CC</span><label>${e[i]}</label></li>`);A.find('[data-id="cc"]').remove(),A.find('[data-id="email"]').attr("data-em","true").after(t)}},ut={getAll:function(e){return SBForm.getAll(e)},get:function(e){return SBForm.get(e)},set:function(e,t){return SBForm.set(e,t)},show:function(e){n(),s(new SBUser({id:e})),s().update(t=>{t?(this.populate(s(),H.find(".sb-profile-list")),H.find(".sb-profile").setProfile(),s().getConversations(t=>{let i=s().type,a=s().getConversationsCode(t);SBF.isAgent(i)&&this.agentData(),H.find(".sb-user-conversations").html(a).prev().setClass("sb-hide",!a),H.find(".sb-top-bar [data-value]").sbActive(!1),SBF.null(s().get("email"))||H.find('.sb-top-bar [data-value="email"]').sbActive(!0),s().getExtra("phone")&&(SB_ADMIN_SETTINGS.sms&&H.find('.sb-top-bar [data-value="sms"]').sbActive(!0),H.find('.sb-top-bar [data-value="whatsapp"]').sbActive(!0)),this.boxClasses(H,i),H.attr("data-user-id",s().id).sbShowLightbox(),n(!1,!1),SBF.event("SBProfileBoxOpened",{user_id:e})}),je[e]=s(),SBF.getURL("user")==e||SBF.getURL("conversation")||f("?user="+e)):k.sbHideLightbox()})},showEdit:function(e){if(!(e instanceof SBUser))return SBF.error("User not of type SBUser","SBUsers.showEdit"),!1;{let i=V.find("#password input"),s=e.type,a=V.find("#user_type select");V.removeClass("sb-user-new").attr("data-user-id",e.id),V.find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Save changes")}`),V.find(".sb-profile").setProfile(),V.find(".sb-unlisted-detail").remove(),V.find("input,select,textara").removeClass("sb-error");let n="",r=V.find(".sb-additional-details [id]").map(function(){return this.id}).get().concat(["wp-id","perfex-id","whmcs-id","aecommerce-id","facebook-id","ip","os","current_url","country_code","browser_language","browser","martfury-id","martfury-session"]);for(var t in e.extra)r.includes(t)||(n+=`<div id="${t}" data-type="text" class="sb-input sb-unlisted-detail"><span>${o(e.extra[t].name)}</span><input type="text"></div>`);V.find(".sb-additional-details .sb-edit-box").append(n),this.populateEdit(e,V),this.updateRequiredFields(s),"admin"==SB_ACTIVE_AGENT.user_type&&SBF.isAgent(s)&&a.html(`<option value="agent">${o("Agent")}</option><option value="admin"${"admin"==s?" selected":""}>${o("Admin")}</option>`),i.val()&&i.val("********"),SB_ADMIN_SETTINGS.cloud&&V.setClass("sb-cloud-admin",1==e.id),this.boxClasses(V,s),V.sbShowLightbox(),SBF.event("SBProfileEditBoxOpened",{user_id:e.id})}},populate:function(e,t,i=!0){let s=["first_name","last_name","password","profile_image"],a=["","",""];if(t.hasClass("sb-profile-list-conversation")&&SBChat.conversation){let e=SBChat.conversation.get("source");a[1]=this.profileRow("conversation-id",SBChat.conversation.id,o("Conversation ID")),SBF.null(e)||(a[1]+=this.profileRow("conversation-source",nt.getMessagingAppName(e),o("Source")));let t=SBChat.conversation.messages;for(var n=t.length-1;n>0;n--){let e=t[n].get("payload");if(e.rating){a[1]+=`<li data-id="rating" data-message-id="${t[n].id}"><i class="sb-icon sb-icon-${1==e.rating?"like":"dislike"}"></i><span>${o("User rating")}</span><label>${o(1==e.rating?"Helpful":"Not helpful")}</label></li>`;break}}}"admin"!=SB_ACTIVE_AGENT.user_type&&s.push("token");for(var r in e.details)s.includes(r)||(a[0]+=this.profileRow(r,e.get(r),"id"==r?"User ID":r));if(e.isExtraEmpty()&&i)SBF.ajax({function:"get-user-extra",user_id:e.id},i=>{for(var s=0;s<i.length;s++)e.setExtra(i[s].slug,i[s]);return this.populate(e,t,!1)});else{for(var r in e.extra){let t=e.getExtra(r);a[["os","ip","browser"].includes(r)?2:0]+=this.profileRow(r,t.value,t.name)}t.html(`<ul class="ul-user">${a[0]}</ul>${a[1]?`<div class="sb-title">${o("Conversation")}</div><ul class="ul-conversation">${a[1]}</ul>`:""}${a[2]?`<div class="sb-title">${o("Technology")}</div><ul class="ul-technology">${a[2]}</ul>`:""}`),l(t,145),SBF.event("SBUserLoaded",e)}},profileRow:function(e,t,i=e){if(!t)return"";let s,a={id:"user",full_name:"user",email:"envelope",phone:"phone",user_type:"user",last_activity:"calendar",creation_time:"calendar",token:"shuffle",currency:"currency",location:"marker",country:"marker",address:"marker",city:"marker",postal_code:"marker",browser:"desktop",os:"desktop",current_url:"next",timezone:"clock"},n=`<i class="sb-icon sb-icon-${e in a?a[e]:"plane"}"></i>`,r=!1;switch(e){case"last_activity":case"creation_time":t=SBF.beautifyTime(t);break;case"user_type":t=SBF.slugToString(t);break;case"country":case"country_code":case"language":case"browser_language":let i=t;"ar"!=t||"language"!=e&&"browser_language"!=e||(i="arc"),r=`flags/${i.toLowerCase()}.png`;break;case"browser":(s=t.toLowerCase()).includes("chrome")?r="devices/chrome.svg":s.includes("edge")?r="devices/edge.svg":s.includes("firefox")?r="devices/firefox.svg":s.includes("opera")?r="devices/opera.svg":s.includes("safari")&&(r="devices/safari.svg");break;case"os":(s=t.toLowerCase()).includes("windows")?r="devices/windows.svg":s.includes("mac")||s.includes("apple")||s.includes("ipad")||s.includes("iphone")?r="devices/apple.svg":s.includes("android")?r="devices/android.svg":s.includes("linux")?r="devices/linux.svg":s.includes("ubuntu")&&(r="devices/ubuntu.svg");break;case"conversation-source":r=`apps/${t.toLowerCase()}.svg`;break;case"location":r="apps/google-maps.svg";break;case"current_url":t=b(t)}return`<li data-id="${e}">${r?`<img src="${SB_URL}/media/${r}" />`:n}<span>${o(SBF.slugToString(i))}</span><label>${t}</label></li>`},populateEdit:function(t,i){i.find(".sb-details .sb-input").each((i,s)=>{this.set(s,t.details[e(s).attr("id")])}),i.find(".sb-additional-details .sb-input").each((i,s)=>{let a=e(s).attr("id");a in t.extra?this.set(s,t.extra[a].value):this.set(s,"")})},clear:function(e){SBForm.clear(e)},errors:function(e){return SBForm.errors(e.find(".sb-details"))},showErrorMessage:function(e,t){SBForm.showErrorMessage(e,t)},agentData:function(){let e=`<div class="sb-title">${o("Feedback rating")}</div><div class="sb-rating-area sb-loading"></div>`,t=H.find(".sb-agent-area");t.html(e),SBF.ajax({function:"get-rating"},i=>{if(0==i[0]&&0==i[1])e=`<p class="sb-no-results">${o("No ratings yet.")}</p>`;else{let t=i[0]+i[1],s=100*i[0]/t,a=100*i[1]/t;e=`<div><div>${o("Helpful")}</div><span data-count="${i[0]}" style="width: ${Math.round(2*s)}px"></span><div>${s.toFixed(2)} %</div></div><div><div>${o("Not helpful")}</div><span data-count="${i[1]}" style="width: ${Math.round(2*a)}px"></span><div>${a.toFixed(2)} %</div></div><p class="sb-rating-count">${t} ${o("Ratings")}</p>`}t.find(".sb-rating-area").html(e).sbLoading(!1)})},boxClasses:function(t,i=!1){e(t).removeClass("sb-type-admin sb-type-agent sb-type-lead sb-type-user sb-type-visitor").addClass(`${0!=i?`sb-type-${i}`:""} sb-agent-${SB_ACTIVE_AGENT.user_type}`)},updateRequiredFields:function(e){let t=SBF.isAgent(e);V.find("#password input").prop("required",t),V.find("#email input").prop("required",t)}},pt={infoBottom:function(e,t=!1){var i=k.find(".sb-info-card");t?"error"==t?i.addClass("sb-info-card-error"):i.addClass("sb-info-card-info"):(i.removeClass("sb-info-card-error sb-info-card-warning sb-info-card-info"),clearTimeout(ve),ve=setTimeout(()=>{i.sbActive(!1)},5e3)),i.html(`<h3>${o(e)}</h3>`).sbActive(!0)},infoPanel:function(t,i="info",s=!1,a="",n="",r=!1,l=!1,c=!1){if(l&&s)return s();let d=k.find(".sb-dialog-box").attr("data-type",i),u=d.find("p");d.attr("id",a).setClass("sb-scroll-area",r).css("height",r?parseInt(e(window).height())-200+"px":""),d.find(".sb-title").html(o(n)),u.html(("alert"==i?o("Are you sure?")+" ":"")+o(t)),d.sbActive(!0).css({"margin-top":d.outerHeight()/-2+"px","margin-left":d.outerWidth()/-2+"px"}),ke.sbActive(!0),me=s,_e=c,setTimeout(()=>{pt.open_popup=d},500)},genericPanel:function(e,t,i,s=[],a="",n=!1){let r="",l=k.find("#sb-generic-panel");for(var c=0;c<s.length;c++)s[c]=h(s[c])||s[c]instanceof String?[s[c],!1]:s[c],r+=`<a id="sb-${SBF.stringToSlug(s[c][0])}" class="sb-btn${s[c][1]?" sb-icon":""}">${s[c][1]?`<i class="sb-icon-${s[c][1]}"></i>`:""} ${o(s[c][0])}</a>`;l.html(`<div class="sb-lightbox sb-${e}-box"${a}><div class="sb-info"></div><div class="sb-top-bar"><div>${o(t)}</div>\n                        <div>\n                            ${r}\n                            <a class="sb-close sb-btn-icon sb-btn-red">\n                                <i class="sb-icon-close"></i>\n                            </a>\n                        </div>\n                    </div>\n                    <div class="sb-main${n?" sb-scroll-area":""}">\n                        ${i}\n                    </div>\n             </div>`),l.find("> div").sbShowLightbox()},activeUser:function(e){if(typeof e==et)return window.sb_current_user;window.sb_current_user=e},loadingGlobal:function(t=!0,i=!0){k.find(".sb-loading-global").sbActive(t),i&&(ke.sbActive(t),e("body").setClass("sb-lightbox-active",t))},loading:function(t){return!!e(t).sbLoading()||(e(t).sbLoading(!0),!1)},collapse(t,i){let s=(t=e(t)).find("> div, > ul");s.css({height:"","max-height":""}),t.find(".sb-collapse-btn").remove(),t.hasClass("sb-collapse")&&e(s).prop("scrollHeight")>i&&(t.sbActive(!0).attr("data-height",i),t.append(`<a class="sb-btn-text sb-collapse-btn">${o("View more")}</a>`),s.css({height:i+"px","max-height":i+"px"}))},open_popup:!1,must_translate:!1,is_logout:!1,conversations:dt,users:ct,settings:ot,profile:ut,apps:nt};window.SBAdmin=pt,e(document).ready(function(){function c(e,i,s,a=0,n=[],r,l=!1,d=!1,u=!1,p=!1,h=!1){let f={whatsapp:["whatsapp-send-template","messages"," a phone number.","direct-whatsapp"],email:["create-email","emails"," an email address.",!1],custom_email:["send-custom-email","emails"," an email address.","direct-emails"],sms:["send-sms","text messages"," a phone number.","direct-sms"]}[r];SBF.ajax({function:f[0],to:e[i][a].value,recipient_id:e[i][a].id,sender_name:SB_ACTIVE_AGENT.full_name,sender_profile_image:SB_ACTIVE_AGENT.profile_image,subject:l,message:s,template_name:d,parameters:u,template_languages:p,template:!1,phone_id:h,user_name:!!e.first_name&&(e.first_name[a].value+" "+e.last_name[a].value).trim(),user_email:!!e.email&&e.email[a].value},g=>{let b=e[i].length,v="whatsapp"==r?k.find("#sb-whatsapp-send-template-box"):D;if(v.find(".sb-bottom > div").html(`${o("Sending")} ${o(f[1])}... ${a+1} / ${b}`),g){if(!0!==g&&("status"in g&&400==g.status||"error"in g&&![131030,131009].includes(g.error.code)))return SBForm.showErrorMessage(v,g.error?g.error.message:`${g.message} Details at ${g.more_info}`),console.error(g),v.find(".sb-loading").sbLoading(!1),void v.find(".sb-bottom > div").html("");if(a<b-1)return c(e,i,s,a+1,n,r,l,d,u,p,h);n.length?c(n,i,s,0,[],"sms",!1):(k.sbHideLightbox(),f[3]&&SBF.ajax({function:"reports-update",name:f[3],value:s.substr(0,18)+" | "+b})),t(1==b?"The message has been sent.":o("The message was sent to all users who have"+f[2]))}else console.warn(g)})}if(k=e(".sb-admin"),x=k.find("> .sb-header"),A=k.find(".sb-area-conversations"),B=A.find(".sb-conversation"),T=A.find(".sb-conversation .sb-list"),I=A.find(".sb-admin-list"),C=I.find(".sb-scroll-area ul"),F=I.find(".sb-select"),$=A.find(".sb-user-details"),U=k.find(".sb-area-users"),P=U.find(".sb-table-users"),q=U.find(".sb-menu-users"),O=U.find(".sb-filter-btn .sb-select"),H=k.find(".sb-profile-box"),V=k.find(".sb-profile-edit-box"),W=k.find(".sb-area-settings"),z=W.find(".sb-automations-area"),X=z.find(".sb-conditions"),J=z.find(" > .sb-select"),Y=z.find(" > .sb-tab > .sb-nav > ul"),Ie=k.find(".sb-area-reports"),Z=k.find(".sb-area-articles"),Q=Z.find(".sb-content-articles"),K=Z.find(".sb-content-categories"),te=k.find("#article-parent-categories"),ee=k.find("#article-categories"),Ee=A.find(".sb-replies"),ke=k.find(".sb-lightbox-overlay"),xe=typeof SB_URL!=et?SB_URL.substr(0,SB_URL.indexOf("-content")-3):"",Le=A.find(".sb-woocommerce-products"),De=Le.find(" > div > ul"),E=A.find(".sb-panel-notes"),N=A.find(".sb-panel-tags"),L=A.find(".sb-panel-attachments"),D=k.find(".sb-direct-message-box"),tt=nt.is("wordpress")&&e(".wp-admin").length,M=k.find(".sb-dialogflow-intent-box"),R=A.find(".sb-editor > .sb-suggestions"),j=A.find(".sb-btn-open-ai"),Ce=A.find("#conversation-department"),pe=k.find(".sb-upload-form-admin .sb-upload-files"),ie=k.find(".sb-area-chatbot"),se=ie.find("#sb-table-chatbot-files"),ae=ie.find("#sb-table-chatbot-website"),ne=ie.find("#sb-chatbot-qea"),oe=ie.find(".sb-playground-editor"),re=ie.find(".sb-playground-history"),le=ie.find(".sb-playground .sb-scroll-area"),de=ie.find('[data-id="flows"] > .sb-content'),ce=ie.find("#sb-flows-nav"),G=A.find(".sb-editor textarea"),window.onpopstate=function(){k.sbHideLightbox(),ze&&A.sbActive()&&B.sbActive()&&dt.mobileCloseConversation(),SBF.getURL("user")?(U.sbActive()||x.find("#sb-users").click(),ut.show(SBF.getURL("user"))):SBF.getURL("area")?x.find("#sb-"+SBF.getURL("area")).click():SBF.getURL("conversation")?(A.sbActive()||x.find("#sb-conversations").click(),dt.openConversation(SBF.getURL("conversation"))):SBF.getURL("setting")?(W.sbActive()||x.find("#sb-settings").click(),W.find("#tab-"+SBF.getURL("setting")).click()):SBF.getURL("report")&&(Ie.sbActive()||x.find("#sb-reports").click(),Ie.find("#"+SBF.getURL("report")).click())},SBF.getURL("area")&&setTimeout(()=>{x.find("#sb-"+SBF.getURL("area")).click()},300),typeof SB_ADMIN_SETTINGS==et){let t=k.find(".sb-intall"),i=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,"");return e(k).on("click",".sb-submit-installation",function(){if(a(this))return;let s=!1,n=t.find("#first-name").length;SBForm.errors(t)?s=n?"All fields are required. Minimum password length is 8 characters. Be sure you've entered a valid email.":"All fields are required.":n&&t.find("#password input").val()!=t.find("#password-check input").val()?s="The passwords do not match.":(SBF.cookie("SA_VGCKMENS",0,0,"delete"),i.includes("?")&&(i=i.substr(0,i.indexOf("?"))),e.ajax({method:"POST",url:i+"/include/ajax.php",data:{function:"installation",details:e.extend(SBForm.getAll(t),{url:i})}}).done(a=>{if(h(a)&&(a=JSON.parse(a)),(a=a[1])&&!a.error)return SBF.cookie("SA_VGCKMENS",a.cv,30,"set"),void setTimeout(()=>{window.location.href=i+"/admin.php?refresh=true"},1e3);!1!==(s=a.error?a.error:a)&&(SBForm.showErrorMessage(t,s),e("html, body").animate({scrollTop:0},500)),e(this).sbLoading(!1)})),!1!==s&&(SBForm.showErrorMessage(t,s),e("html, body").animate({scrollTop:0},500),e(this).sbLoading(!1))}),void fetch("https://board.support/synch/index.php?site="+encodeURI(i.split("?")[0]))}if(!k.length)return;if(n(),k.removeAttr("style"),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"))&&k.addClass("sb-pwa"),Ye&&r(),k.find(" > .sb-rich-login").length)return;SBF.storage("notifications-counter",[]),dt.message_drafts=SBF.storage("message-drafts")?SBF.storage("message-drafts"):{},SB_ADMIN_SETTINGS.pusher?(SBPusher.active=!0,SBPusher.init(()=>{SBPusher.presence(1,()=>{ct.updateUsersActivity()}),SBPusher.event("update-conversations",()=>{dt.update()},"agents"),SBPusher.event("set-agent-status",e=>{e.agent_id==SB_ACTIVE_AGENT.id&&(ct.setActiveAgentStatus("online"==e.status),Pe=!1)},"agents"),y()})):(y(),setInterval(function(){ct.updateUsersActivity()},1e4)),ct.table_extra=P.find("th[data-extra]").map(function(){return e(this).attr("data-field")}).get(),typeof SB_CLOUD_FREE!=et&&SB_CLOUD_FREE&&setTimeout(()=>{location.reload()},36e5),e(window).on("beforeunload",function(){s()&&e.ajax({method:"POST",url:SB_AJAX_URL,data:{function:"on-close"}})}),e(window).keydown(function(e){let t=e.which,i=!1;if($e=t,[13,27,32,37,38,39,40,46,90].includes(t)){if(k.find(".sb-dialog-box").sbActive()){let e=k.find(".sb-dialog-box");switch(t){case 46:case 27:e.find(".sb-cancel").click();break;case 32:case 13:e.find("info"!=e.attr("data-type")?".sb-confirm":".sb-close").click()}i=!0}else if([38,40,46,90].includes(t)&&A.sbActive()&&!k.find(".sb-lightbox").sbActive()){let s=G.is(":focus");if(46==t){if(s||"INPUT"==e.target.tagName)return;let t=A.find(" > div > .sb-conversation");t.find('.sb-top [data-value="'+(3==t.attr("data-conversation-status")?"delete":"archive")+'"]').click(),i=!0}else if(e.ctrlKey){let e=C.find(".sb-active");40==t?e.next().click():38==t?e.prev().click():90==t&&s&&dt.previous_editor_text&&(G.val(dt.previous_editor_text),dt.previous_editor_text=!1,i=!0),38!=t&&40!=t||(i=!0,dt.scrollTo())}}else if([37,39].includes(t)&&U.sbActive()&&k.find(".sb-lightbox").sbActive()){let e=P.find(`[data-user-id="${s().id}"]`);(e=39==t?e.next():e.prev()).length&&(k.sbHideLightbox(),ut.show(e.attr("data-user-id"))),i=!0}else if(27==t&&k.find(".sb-lightbox").sbActive())k.sbHideLightbox(),i=!0;else if(46==t){let e=k.find(".sb-search-btn.sb-active");e.length&&(e.find("i").click(),i=!0)}else 13==t&&ie.find(".sb-playground-editor textarea").is(":focus")&&(ie.find('.sb-playground-editor [data-value="send"]').click(),i=!0);i&&e.preventDefault()}}),e(window).keyup(function(e){$e=!1}),e(document).on("click keydown mousemove",function(){SBF.debounce(()=>{SBChat.tab_active||SBF.visibilityChange(),SBChat.tab_active=!0,clearTimeout(Ke),Ke=setTimeout(()=>{SBChat.tab_active=!1},1e4)},"#3",8e3),!ze&&SB_ADMIN_SETTINGS.away_mode&&SBF.debounce(()=>{Pe&&(ct.setActiveAgentStatus(),clearTimeout(we),we=setTimeout(()=>{ct.setActiveAgentStatus(!1)},6e5))},"#4",558e3)}),document.onpaste=function(e){let t=e.clipboardData.items[0];if(0===t.type.indexOf("image")){var i=new FileReader;i.onload=function(e){let t=e.target.result.split(","),i=t[0].indexOf("base64")>=0?atob(t[1]):decodeURI(t[1]),s=new Uint8Array(i.length);for(let e=0;e<i.length;e++)s[e]=i.charCodeAt(e);let a=new FormData;a.append("file",new Blob([s],{type:t[0].split(":")[1].split(";")[0]}),"image_print.jpg"),SBF.upload(a,function(e){SBChat.uploadResponse(e)})},i.readAsDataURL(t.getAsFile())}};let u=[o("Please go to Settings > Miscellaneous and enter the Envato Purchase Code of Support Board."),`${o("Your license key is expired. Please purchase a new license")} <a href="https://board.support/shop/{R}" target="_blank">${o("here")}</a>.`];e(x).on("click",".sb-version",function(){let e=k.find(".sb-updates-box");SBF.ajax({function:"get-versions"},t=>{let i="",s={sb:"Support Board",slack:"Slack",dialogflow:"Artificial Intelligence",tickets:"Tickets",woocommerce:"Woocommerce",ump:"Ultimate Membership Pro",perfex:"Perfex",whmcs:"WHMCS",aecommerce:"Active eCommerce",messenger:"Messenger",whatsapp:"WhatsApp",armember:"ARMember",telegram:"Telegram",viber:"Viber",line:"LINE",wechat:"WeChat",zalo:"Zalo",twitter:"Twitter",zendesk:"Zendesk",martfury:"Martfury",opencart:"OpenCart",zalo:"Zalo"},a=!1;for(var r in t)if(nt.is(r)){let e=SB_VERSIONS[r]==t[r];e||(a=!0),i+=`<div class="sb-input"><span>${s[r]}</span><div${e?' class="sb-green"':""}>${o(e?"You are running the latest version.":"Update available! Please update now.")} ${o("Your version is")} V ${SB_VERSIONS[r]}.</div></div>`}a?e.find(".sb-update").removeClass("sb-hide"):e.find(".sb-update").addClass("sb-hide"),n(!1),e.find(".sb-main").prepend(i),e.sbShowLightbox()}),n(),e.sbActive(!1),e.find(".sb-input").remove()}),e(k).on("click",".sb-updates-box .sb-update",function(){if(a(this))return;let i=k.find(".sb-updates-box");SBF.ajax({function:"update",domain:SB_URL},s=>{let a="";if(SBF.errorValidation(s,"envato-purchase-code-not-found"))a=u[0];else if(SBF.errorValidation(s))a=SBF.slugToString(s[1]);else{let e=!0;for(var n in s)if("success"!=s[n]){e=!1,"expired"==s[n]&&(a=u[1].replace("{R}",n)),"license-key-not-found"==s[n]&&(a=o("License key for the {R} app missing. Add it in Settings > Apps.").replace("{R}",SBF.slugToString(n.replace("dialogflow","Artificial Intelligence"))));break}e||a||(a=JSON.stringify(s))}r(),a?SBForm.showErrorMessage(i,a):(t("Update completed."),location.reload()),e(this).sbLoading(!1)})}),setTimeout(function(){let i=SBF.storage("last-update-check"),s=[Xe.getMonth(),Xe.getDate()];SB_ADMIN_SETTINGS.cloud||((0==i||s[0]!=i[0]||s[1]>i[1]+10)&&(SBF.storage("last-update-check",s),SB_ADMIN_SETTINGS.auto_updates?SBF.ajax({function:"update",domain:SB_URL},e=>{h(e)||Array.isArray(e)||(t("Automatic update completed. Reload the admin area to apply the update."),r())}):"admin"==SB_ACTIVE_AGENT.user_type&&SBF.ajax({function:"updates-available"},e=>{!0===e&&t(`${o("Update available.")} <span onclick="$('.sb-version').click()">${o("Click here to update now")}</span>`,"info")})),SBF.cookie("SA_VGCKMENS")||setTimeout(()=>{e("body").html("")},1e4))},1e3),e(k).on("click",".sb-apps > div:not(.sb-disabled)",function(){let t=k.find(".sb-app-box"),i=e(this).data("app"),s=SB_ADMIN_SETTINGS.cloud,a=nt.is(i)&&(!s||SB_CLOUD_ACTIVE_APPS.includes(i)),n="?utm_source=plugin&utm_medium=admin_area&utm_campaign=plugin";s||SBF.ajax({function:"app-get-key",app_name:i},e=>{t.find("input").val(e)}),t.setClass("sb-active-app",a),t.find("input").val(""),t.find(".sb-top-bar > div:first-child").html(e(this).find("h2").html()),t.find("p").html(e(this).find("p").html()),t.attr("data-app",i),t.find(".sb-btn-app-setting").sbActive(a),t.find(".sb-btn-app-puchase").attr("href","https://board.support/shop/"+i+n),t.find(".sb-btn-app-details").attr("href",(s?WEBSITE_URL:"https://board.support/")+i+n),t.sbShowLightbox()}),e(k).on("click",".sb-app-box .sb-activate",function(){let i=k.find(".sb-app-box"),s=i.find("input").val(),n=i.attr("data-app");if(s||SB_ADMIN_SETTINGS.cloud){if(a(this))return;SBF.ajax({function:"app-activation",app_name:n,key:s},a=>{if(SBF.errorValidation(a)){let t="";t="envato-purchase-code-not-found"==(a=a[1])?u[0]:"invalid-key"==a?"It looks like your license key is invalid. If you believe this is an error, please contact support.":"expired"==a?u[1].replace("{R}",s):"app-purchase-code-limit-exceeded"==a?SBF.slugToString(n)+" app purchase code limit exceeded.":"Error: "+a,SBForm.showErrorMessage(i,t),e(this).sbLoading(!1)}else t("Activation complete! Page reload in progress..."),setTimeout(function(){location.reload()},1e3)})}else SBForm.showErrorMessage(i,"Please insert the license key.")}),e(k).on("click",".sb-app-box .sb-btn-app-setting",function(){W.find("#tab-"+e(this).closest("[data-app]").attr("data-app")).click(),k.sbHideLightbox()}),typeof Notification===et||"all"!=SB_ADMIN_SETTINGS.desktop_notifications&&"agents"!=SB_ADMIN_SETTINGS.desktop_notifications||SB_ADMIN_SETTINGS.push_notifications||(dt.desktop_notifications=!0),["all","agents"].includes(SB_ADMIN_SETTINGS.flash_notifications)&&(dt.flash_notifications=!0),Xe.getDate()!=SBF.storage("admin-clean")&&setTimeout(function(){SBF.ajax({function:"cron-jobs"}),SBF.storage("admin-clean",Xe.getDate())},1e4),e(k).on("click",".sb-collapse-btn",function(){let t=e(this).sbActive(),i=t?e(this).parent().data("height")+"px":"";e(this).html(o(t?"View more":"Close")),e(this).parent().find("> div, > ul").css({height:i,"max-height":i}),e(this).sbActive(!t)}),e(k).on("click",".sb-popup-close",function(){k.sbHideLightbox()}),ze?($.find("> .sb-scroll-area").prepend('<div class="sb-profile"><img><span class="sb-name"></span></div>'),e(k).on("click",".sb-menu-mobile > i",function(){e(this).toggleClass("sb-active"),pt.open_popup=e(this).parent()}),e(k).on("click",".sb-menu-mobile a",function(){e(this).closest(".sb-menu-mobile").find(" > i").sbActive(!1)}),e(k).on("click",".sb-menu-wide,.sb-nav",function(){e(this).toggleClass("sb-active")}),e(k).on("click",".sb-menu-wide > ul > li, .sb-nav > ul > li",function(t){let i=e(this).parent().parent();return i.find("li").sbActive(!1),i.find("> div:not(.sb-menu-wide):not(.sb-btn)").html(e(this).html()),i.sbActive(!1),i.find("> .sb-menu-wide").length&&i.closest(".sb-scroll-area").scrollTop(i.next()[0].offsetTop-(k.hasClass("sb-header-hidden")?70:130)),t.preventDefault(),!1}),e(k).find(".sb-admin-list .sb-scroll-area, main > div > .sb-scroll-area,.sb-area-settings > .sb-tab > .sb-scroll-area,.sb-area-reports > .sb-tab > .sb-scroll-area").on("scroll",function(){let t=e(this).scrollTop();Je.last<t-10&&Je.header?(k.addClass("sb-header-hidden"),Je.header=!1):Je.last>t+10&&!Je.header&&!Je.always_hidden&&(k.removeClass("sb-header-hidden"),Je.header=!0),Je.last=t}),e(k).on("click",".sb-search-btn i,.sb-filter-btn i",function(){e(this).parent().sbActive()?(k.addClass("sb-header-hidden"),Je.always_hidden=!0):(Je.always_hidden=!1,C.parent().scrollTop()<10&&k.removeClass("sb-header-hidden"))}),e(k).on("click",".sb-top .sb-btn-back",function(){dt.mobileCloseConversation()}),e(P).find("th:first-child").html(o("Order by")),e(P).on("click","th:first-child",function(){e(this).parent().toggleClass("sb-active")}),document.addEventListener("touchstart",e=>{Ae=e.changedTouches[0].clientX,Te=e.changedTouches[0].clientY},!1),document.addEventListener("touchend",()=>{S()},!1),document.addEventListener("touchmove",e=>{var t=e.changedTouches[0].clientX,i=Ae-t,a=e.changedTouches[0].clientY,n=Te-a;if(Math.abs(i)>Math.abs(n)){var o=[];Be=A.sbActive()?[C.find(".sb-active"),T,1]:[P.find(`[data-user-id="${s().id}"]`),H,2],i>150?(1==Be[2]?Be[0].next().click():o=Be[0].next(),S()):i<-150&&(1==Be[2]?Be[0].prev().click():o=Be[0].prev(),S()),2==Be[2]&&o.length&&(k.sbHideLightbox(),ut.show(o.attr("data-user-id"))),(i>80||i<-80)&&(Be[1].css("transform","translateX("+-1*i+"px)"),Be[1].addClass("sb-touchmove"))}},!1)):SB_ADMIN_SETTINGS.hide_conversation_details?A.find('.sb-menu-mobile [data-value="panel"]').sbActive(!0):$.sbActive(!0),e(window).width()<913&&e(A).on("click","> .sb-btn-collapse",function(){e(this).toggleClass("sb-active"),A.find(".sb-admin-list").toggleClass("sb-active")}),e(x).on("click"," .sb-admin-nav a, #sb-settings",function(){switch(at=e(this).attr("id").substr(3),pt.active_admin_area=at,x.find(".sb-admin-nav a, #sb-settings").sbActive(!1),k.find(" > main > div").sbActive(!1),k.find(".sb-area-"+at).sbActive(!0),e(this).sbActive(!0),SBF.deactivateAll(),at){case"conversations":ze||SBF.getURL("conversation")||dt.clickFirst(),dt.update(),dt.startRealTime(),ct.stopRealTime();break;case"users":ct.startRealTime(),dt.stopRealTime(),ct.init||(n(),Ge=1,Ue=1,ct.get(e=>{ct.populate(e),ct.updateMenu(),ct.init=!0,ct.datetime_last_user=SBF.dateDB("now"),n(!1)}));break;case"settings":ot.init||(n(),SBF.ajax({function:"get-all-settings"},i=>{if(i){let e=i["external-settings-translations"];if(i["slack-agents"]){let e="";for(var s in i["slack-agents"][0])e+=`<div data-id="${s}"><select><option value="${i["slack-agents"][0][s]}"></option></select></div>`;W.find("#slack-agents .input").html(e)}ot.translations.translations=Array.isArray(e)&&!e.length?{}:e,delete i["external-settings-translations"];for(var s in i)ot.set(s,i[s])}SBF.getURL("refresh_token")&&(k.find("#google-refresh-token input").val(SBF.getURL("refresh_token")),ot.save(),t("Synchronization completed."),k.find("#google")[0].scrollIntoView()),W.find("textarea").each(function(){e(this).autoExpandTextarea(),e(this).manualExpandTextarea()}),W.find("[data-setting] .sb-language-switcher-cnt").each(function(){e(this).sbLanguageSwitcher(ot.translations.getLanguageCodes(e(this).closest("[data-setting]").attr("id")),"settings")}),ot.init=!0,n(!1),i&&!SB_ADMIN_SETTINGS.cloud&&ot.visibility(0,i["push-notifications"]&&"pusher"==i["push-notifications"][0]["push-notifications-provider"][0]),ot.visibility(1,!i.messenger||"manual"!=i.messenger[0]["messenger-sync-mode"][0]),ot.visibility(2,!i["open-ai"]||"assistant"!=i["open-ai"][0]["open-ai-mode"][0]),SBF.event("SBSettingsLoaded",i)})),ct.stopRealTime(),dt.stopRealTime();break;case"reports":Ie.sbLoading()&&ot.loadDatePicker(()=>{e.getScript(SB_URL+"/vendor/chart.min.js",()=>{Ie.find("#sb-date-picker").daterangepicker(ot.getDatePickerSettings()).val(""),lt.initReport("conversations"),Ie.sbLoading(!1)})}),ct.stopRealTime(),dt.stopRealTime();break;case"articles":let i=Z.find(".sb-menu-wide li").eq(0);Z.sbLoading()?(i.sbActive(!0).next().sbActive(!1),SBF.ajax({function:"init-articles-admin"},e=>{rt.categories.list=e[1],rt.translations.list=e[2],rt.page_url=e[3],rt.is_url_rewrite=e[4],rt.cloud_chat_id=e[5],rt.populate(e[0]),rt.populate(e[1],!0),rt.categories.update(),Z.sbLoading(!1)})):i.click(),ct.stopRealTime(),dt.stopRealTime();break;case"chatbot":se.sbLoading()&&nt.openAI.init(),nt.openAI.troubleshoot()}SBF.getURL("area")!=at&&("conversations"==at&&!SBF.getURL("conversation")||"users"==at&&!SBF.getURL("user")||"settings"==at&&!SBF.getURL("setting")||"reports"==at&&!SBF.getURL("report")||"articles"==at&&!SBF.getURL("article")||"chatbot"==at&&!SBF.getURL("chatbot"))&&f("?area="+at)}),e(x).on("click",".sb-profile",function(){e(this).next().toggleClass("sb-active")}),e(x).on("click",'[data-value="logout"],.logout',function(){pt.is_logout=!0,SBF.ajax({function:"on-close"}),ct.stopRealTime(),dt.stopRealTime(),setTimeout(()=>{SBF.logout()},300)}),e(x).on("click",'[data-value="edit-profile"],.edit-profile',function(){n();let e=new SBUser({id:SB_ACTIVE_AGENT.id});e.update(()=>{s(e),A.find(".sb-board").addClass("sb-no-conversation"),C.find(".sb-active").sbActive(!1),ut.showEdit(e)})}),e(x).on("click",'[data-value="status"]',function(){let t=!e(this).hasClass("sb-online");ct.setActiveAgentStatus(t),Pe=t}),e(x).find(".sb-account").setProfile(SB_ACTIVE_AGENT.full_name,SB_ACTIVE_AGENT.profile_image),e(G).on("focus input click",function(){G.parent().parent().addClass("sb-focus")}),e(G).on("focusout",function(){G.parent().parent().removeClass("sb-focus")}),e(C).on("click","li",function(){17==$e?e(this).sbActive(!e(this).sbActive()):(dt.openConversation(e(this).attr("data-conversation-id"),e(this).attr("data-user-id"),!1),SBF.deactivateAll())}),e(k).on("click",".sb-user-conversations li",function(){dt.openConversation(e(this).attr("data-conversation-id"),s().id,e(this).attr("data-conversation-status"))}),e(A).on("click",".sb-top ul a",function(){let t,n=dt.getSelectedConversations(),r=n.length,l=r>1?"All the selected conversations will be ":"The conversation will be ",c=(t,i)=>{let s=t.includes(".txt");e(this).sbLoading(!1),"email"==i&&actioninfoBottom(s?o("Transcript sent to user's email.")+' <a href="'+t+'" target="_blank">'+o("View transcript")+"</a>":"Transcript sending error: "+t,s?"":"error")};switch(e(this).attr("data-value")){case"inbox":t=1,l+="restored.";break;case"archive":l+="archived.",t=3;break;case"delete":l+="deleted.",t=4;break;case"empty-trash":t=5,l="All conversations in the trash (including their messages) will be deleted permanently.";break;case"transcript":let i=e(this).attr("data-action");"email"!=i||s()&&s().get("email")||(i=""),dt.transcript(n[0].id,n[0].user_id,i,e=>c(e,i)),a(this);break;case"read":t=1,l+="marked as read.";break;case"unread":t=2,l+="marked as unread.";break;case"panel":e([$,this]).toggleClass("sb-active")}t&&i(l,"alert",function(){let e=F.eq(0).find("p").attr("data-value"),i=n[r-1].id;for(var s=0;s<r;s++){let a=n[s],o=SBChat.conversation&&SBChat.conversation.id==a.id;SBF.ajax({function:"update-conversation-status",conversation_id:a.id,status_code:t},()=>{let s=w(a.id);if([0,3,4].includes(t))for(var n=0;n<Fe.length;n++)if(Fe[n].id==a.id){Fe[n].set("status_code",t);break}if(3==t&&(SB_ADMIN_SETTINGS.close_message&&(SBF.ajax({function:"close-message",conversation_id:a.id}),SB_ADMIN_SETTINGS.close_message_transcript&&dt.transcript(a.id,a.user_id,"email",e=>c(e))),SB_ADMIN_SETTINGS.rating&&o&&SBChat.conversation.get("source")&&SBF.ajax({function:"rating-message",conversation_id:a.id})),[0,1,2].includes(t)&&(s.attr("data-conversation-status",t),dt.updateMenu()),o&&nt.is("slack")&&[3,4].includes(t)&&SBF.ajax({function:"archive-slack-channels",conversation_user_id:SBChat.conversation.get("user_id")}),0==e&&[3,4].includes(t)||3==e&&[0,1,2,4].includes(t)||4==e&&4!=t){let e=!1;dt.updateMenu(),o&&(e=s.prev(),SBChat.conversation=!1),s.remove(),a.id==i&&dt.clickFirst(e)}4==e&&5==t&&(C.find("li").remove(),dt.updateMenu(),dt.clickFirst())}),o&&(SBChat.conversation.set("status_code",t),dt.setReadIcon(t))}})}),SBF.ajax({function:"saved-replies"},e=>{let t=`<p class="sb-no-results">${o("No saved replies found. Add new saved replies via Settings > Admin.")}</p>`;if(Array.isArray(e)&&e.length&&e[0]["reply-name"]){t="",Ne=e;for(var i=0;i<e.length;i++)t+=`<li><div>${e[i]["reply-name"]}</div><div>${e[i]["reply-text"].replace(/\\n/g,"\n")}</div></li>`}Ee.find(".sb-replies-list > ul").html(t).sbLoading(!1)}),e(A).on("click",".sb-btn-saved-replies",function(){Ee.sbTogglePopup(this),Ne.length>10&&Ee.find(".sb-search-btn").sbActive(!0).find("input").get(0).focus()}),e(Ee).on("click",".sb-replies-list li",function(){SBChat.insertText(e(this).find("div:last-child").text().replace(/\\n/g,"\n")),SBF.deactivateAll(),k.removeClass("sb-popup-active")}),e(Ee).on("input",".sb-search-btn input",function(){v(e(this).val().toLowerCase())}),e(Ee).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{v("")})}),e(k).on("click",".sb-btn-open-ai",function(){if(!SBChat.conversation||a(this))return;let t=e(this).hasClass("sb-btn-open-ai-editor"),i=t?G:M.find("textarea");nt.openAI.rewrite(i.val(),s=>{e(this).sbLoading(!1),s[0]&&(i.val(t?"":s[1]),t&&SBChat.insertText(s[1]))})}),e(Ee).on("click",".sb-add-saved-reply",function(){e(this).find("i").toggleClass("sb-icon-close"),Ee.find(".sb-replies-add-area").toggleClass("sb-active")}),e(Ee).on("click",".sb-replies-add-area a",function(){let t=Ee.find(".sb-replies-add-area input").map(function(){return e(this).val()});t[0]&&t[1]&&!a(this)&&SBF.ajax({function:"add-saved-reply",name:t[0],text:t[1]},i=>{e(this).sbLoading(!1),Ee.find(".sb-add-saved-reply i").removeClass("sb-icon-close"),Ee.find(".sb-replies-add-area").sbActive(!1),!0===i&&(Ne||(Ne=[],Ee.find(".sb-no-results").remove()),Ne.push({"reply-name":t[0],"reply-text":t[1]}),Ee.find(".sb-replies-list > ul").prepend(`<li><div>${t[0]}</div><div>${t[1].replace(/\\n/g,"\n")}</div></li>`))})}),e(I).find(".sb-scroll-area").on("scroll",function(){if(!Ze&&!dt.is_search&&d(this,!0)&&Re){let e=A.find(".sb-admin-list"),t=dt.filters();Ze=!0,e.append('<div class="sb-loading-global sb-loading"></div>'),SBF.ajax({function:"get-conversations",pagination:Me,status_code:t[0],department:t[1],source:t[2],tag:t[3],agent_id:t[4]},t=>{if(setTimeout(()=>{Ze=!1},500),Re=t.length){let e="";for(var i=0;i<Re;i++){let s=new SBConversation([new SBMessage(t[i])],t[i]);e+=dt.getListCode(s),Fe.push(s)}Me++,C.append(e)}e.find(" > .sb-loading").remove(),SBF.event("SBAdminConversationsLoaded",{conversations:t})})}}),e(document).on("SBMessageDeleted",function(){let e=SBChat.conversation.getLastMessage();0!=e?C.find("li.sb-active p").html(e.message):(C.find("li.sb-active").remove(),dt.clickFirst(),dt.scrollTo())}),e(document).on("SBMessageSent",function(s,a){let n=a.conversation_id,r=o("Error. Message not sent to"),l=a.conversation,c=a.user,d=!(!a.payload||!a.payload.reply)&&a.payload.reply;delete dt.message_drafts[n],SBF.storage("message-drafts",dt.message_drafts),a.conversation_status_code&&dt.updateMenu(),nt.messenger.check(l)&&nt.messenger.send(c.getExtra("facebook-id").value,l.get("extra"),a.message,a.attachments,a.message_id,a.message_id,d,e=>{for(var t=0;t<e.length;t++)e[t]&&e[t].error&&i(r+" Messenger: "+e[t].error.message,"info",!1,"error-fb")}),nt.whatsapp.check(l)&&nt.whatsapp.send(nt.whatsapp.activeUserPhone(c),a.message,a.attachments,l.get("extra"),d,a.message_id,e=>{(e.ErrorCode||e.meta&&!e.meta.success)&&i(r+" WhatsApp: "+("ErrorCode"in e?e.errorMessage:e.meta.developer_message),"info",!1,"error-wa")}),nt.telegram.check(l)&&nt.telegram.send(l.get("extra"),a.message,a.attachments,n,d,a.message_id,e=>{e&&e.ok||i(r+" Telegram: "+JSON.stringify(e),"info",!1,"error-tg")}),nt.viber.check(l)&&nt.viber.send(c.getExtra("viber-id").value,a.message,a.attachments,e=>{e&&"ok"==e.status_message||i(r+" Viber: "+JSON.stringify(e),"info",!1,"error-vb")}),nt.zalo.check(l)&&nt.zalo.send(c.getExtra("zalo-id").value,a.message,a.attachments,e=>{e&&e.error.error&&i(r+" Zalo: "+e.error.message?e.error.message:e.message,"info",!1,"error-za")}),nt.twitter.check(l)&&nt.twitter.send(c.getExtra("twitter-id").value,a.message,a.attachments,e=>{e&&!e.event?i(JSON.stringify(e),"info",!1,"error-tw"):a.attachments.length>1&&t("Only the first attachment was sent to Twitter.")}),nt.line.check(l)&&nt.line.send(c.getExtra("line-id").value,a.message,a.attachments,n,e=>{e.error&&i(r+" LINE: "+JSON.stringify(e),"info",!1,"error-ln")}),nt.wechat.check(l)&&nt.wechat.send(c.getExtra("wechat-id").value,a.message,a.attachments,e=>{e&&"ok"==e.errmsg||i(r+" WeChat: "+JSON.stringify(e),"info",!1,"error-wc")}),SB_ADMIN_SETTINGS.smart_reply&&R.html(""),SB_ADMIN_SETTINGS.assign_conversation_to_agent&&SBF.null(l.get("agent_id"))&&dt.assignAgent(n,SB_ACTIVE_AGENT.id,()=>{SBChat.conversation.id==n&&(SBChat.conversation.set("agent_id",SB_ACTIVE_AGENT.id),e(A).find("#conversation-agent > p").attr("data-value",SB_ACTIVE_AGENT.id).html(SB_ACTIVE_AGENT.full_name))})}),e(document).on("SBNewMessagesReceived",function(e,s){let a=s.messages;for(var n=0;n<a.length;n++){let e=a[n],r=e.payload(),l=SBF.isAgent(e.get("user_type"));if(setTimeout(function(){B.find(".sb-top .sb-status-typing").remove()},300),pt.must_translate){let t=B.find(`[data-id="${e.id}"]`),i=!!r["original-message"]&&r["original-message"];i?(t.replaceWith(e.getCode()),B.find(`[data-id="${e.id}"] .sb-menu`).prepend(`<li data-value="translation">${o("View translation")}</li>`),SB_ADMIN_SETTINGS.smart_reply&&nt.dialogflow.smartReply(SBF.escape(i))):e.message&&nt.dialogflow.translate([e.message],SB_ADMIN_SETTINGS.active_agent_language,i=>{i&&(e.payload("translation",i[0]),e.payload("translation-language",SB_ADMIN_SETTINGS.active_agent_language),t.replaceWith(e.getCode()),B.find(`[data-id="${e.id}"] .sb-menu`).prepend(`<li data-value="original">${o("View original message")}</li>`)),SB_ADMIN_SETTINGS.smart_reply&&nt.dialogflow.smartReply(i[0]),w(s.conversation_id).find("p").html(i[0])},[e.id],SBChat.conversation.id)}else SB_ADMIN_SETTINGS.smart_reply&&nt.dialogflow.smartReply(e.message);r&&(r.department&&dt.setActiveDepartment(r.department),r.agent&&dt.setActiveAgent(r.agent)),("ErrorCode"in r||r.errors&&r.errors.length)&&i("Error. Message not sent to WhatsApp. Error message: "+(r.ErrorCode?r.ErrorCode:r.errors[0].title)),"whatsapp-templates"in r&&t(`Message sent as text message.${"whatsapp-template-fallback"in r?" The user has been notified via WhatsApp Template notification.":""}`),"whatsapp-template-fallback"in r&&!("whatsapp-templates"in r)&&t("The user has been notified via WhatsApp Template notification."),l||SBChat.conversation.id!=s.conversation_id||SBChat.user_online||ct.setActiveUserStatus()}dt.update()}),e(document).on("SBNewConversationCreated",function(){dt.update()}),e(document).on("SBEmailSent",function(){t("The user has been notified by email.")}),e(document).on("SBSMSSent",function(){t("The user has been notified by text message.")}),e(document).on("SBNotificationsSent",function(e,i){t(`The user ${i.includes("cron")?"will be":"has been"} notified by email${i.includes("sms")?" and text message":""}.`)}),e(document).on("SBTyping",function(e,t){dt.typing(t)}),e(I).on("input",".sb-search-btn input",function(){dt.search(this)}),e(A).on("click",".sb-admin-list .sb-search-btn i",function(){SBF.searchClear(this,()=>{dt.search(e(this).next())})}),e(F).on("click","li",function(t){let i=C.parent();if(a(i))return t.preventDefault(),!1;setTimeout(()=>{let t=dt.filters();Me=1,Re=1,SBF.ajax({function:"get-conversations",status_code:t[0],department:t[1],source:t[2],tag:t[3],agent_id:t[4]},s=>{if(dt.populateList(s),B.attr("data-conversation-status",t[0]),s.length){if(!ze){if(SBChat.conversation){let e=w(SBChat.conversation.id);e.length?e.sbActive(!0):t[0]==SBChat.conversation.status_code?C.prepend(dt.getListCode(SBChat.conversation)):dt.clickFirst()}else dt.clickFirst();dt.scrollTo()}}else A.find(".sb-board").addClass("sb-no-conversation"),SBChat.conversation=!1;e(this).closest(".sb-filter-btn").attr("data-badge",F.slice(1).toArray().reduce((t,i)=>t+!!e(i).find("li.sb-active").data("value"),0)),i.sbLoading(!1)})},100)}),e(A).on("click",".sb-user-details .sb-profile,.sb-top > a",function(){let e=C.find(".sb-active").attr("data-user-id");s().id!=e&&s(je[e]),ut.show(s().id)}),e(k).on("click",".sb-profile-list-conversation li",function(){let a=e(this).find("label"),r=a.html();switch(e(this).attr("data-id")){case"location":i('<iframe src="https://maps.google.com/maps?q='+r.replace(", ","+")+'&output=embed"></iframe>',"map");break;case"timezone":SBF.getLocationTimeString(s().extra,e=>{n(!1),i(e)});break;case"current_url":window.open("//"+(SBF.null(a.attr("data-value"))?r:a.attr("data-value")));break;case"conversation-source":let c=r.toLowerCase();"whatsapp"==c&&s().getExtra("phone")?window.open("https://wa.me/"+nt.whatsapp.activeUserPhone()):"facebook"==c?window.open("https://www.facebook.com/messages/t/"+SBChat.conversation.get("extra")):"instagram"==c?window.open("https://www.instagram.com/direct/inbox/"):"twitter"==c&&window.open("https://twitter.com/messages/");break;case"wp-id":window.open(window.location.href.substr(0,window.location.href.lastIndexOf("/"))+"/user-edit.php?user_id="+s().getExtra("wp-id").value);break;case"envato-purchase-code":n(),SBF.ajax({function:"envato",purchase_code:r},e=>{let s="";if(e&&e.item){e.name=e.item.name;for(var a in e)!h(e[a])&&isNaN(e[a])||(s+=`<b>${SBF.slugToString(a)}</b> ${e[a]} <br>`);n(!1),i(s,"info",!1,"sb-envato-box")}else t(SBF.slugToString(e))});break;case"email":case"cc":if(SBChat.conversation&&"em"==SBChat.conversation.get("source")){let e=SBChat.conversation.get("extra").split(","),t='<div data-type="repeater" class="sb-setting sb-type-repeater"><div class="input"><div class="sb-repeater">';for(var l=0;l<e.length;l++)t+=`<div class="repeater-item"><div><input data-id="cc" type="text" value="${e[l]}"></div><i class="sb-icon-close"></i></div>`;t+=`</div><div class="sb-btn sb-btn-white sb-repeater-add sb-icon"><i class="sb-icon-plus"></i>${o("Add new item")}</div></div></div>`,pt.genericPanel("cc","Manage CC",t,["Save changes"],"",!0)}}}),e($).on("click",".sb-user-details-close",function(){A.find('.sb-menu-mobile [data-value="panel"]').click().sbActive(!0)}),e(M).on("click",'.sb-intent-add [data-value="add"]',function(){M.find("> div > .sb-type-text").last().after('<div class="sb-setting sb-type-text"><input type="text"></div>')}),e(M).on("click",'.sb-intent-add [data-value="previous"],.sb-intent-add [data-value="next"]',function(){let t=M.find(".sb-first input"),i=t.val(),s="next"==e(this).attr("data-value"),a=SBChat.conversation.getUserMessages(),n=a.length;for(var o=0;o<n;o++)if(a[o].message==i&&(s&&o<n-1||!s&&o>0)){o+=s?1:-1,t.val(a[o].message),M.attr("data-message-id",a[o].id),nt.openAI.generateQuestions(a[o].message);break}}),e(M).on("click",".sb-send",function(){nt.dialogflow.submitIntent(this)}),e(M).on("input",".sb-search-btn input",function(){nt.dialogflow.searchIntents(e(this).val())}),e(M).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{nt.dialogflow.searchIntents(e(this).val())})}),e(M).on("click","#sb-intent-preview",function(){nt.dialogflow.previewIntentDialogflow(M.find("#sb-intents-select").val())}),e(M).on("click","#sb-qea-preview",function(){nt.dialogflow.previewIntent(M.find("#sb-qea-select").val())}),e(M).on("change","#sb-intents-select",function(){let t=e(this).val();M.find(".sb-bot-response").css("opacity",t?.5:1).find("textarea").val(t?nt.dialogflow.getIntent(t).messages[0].text.text[0]:nt.dialogflow.original_response),M.find("#sb-train-chatbots").val(t?"dialogflow":"")}),e(M).on("change","#sb-qea-select",function(){let t=e(this).val();M.find(".sb-bot-response").setClass("sb-disabled",t).find("textarea").val(t?nt.dialogflow.qea[t][1]:nt.dialogflow.original_response),M.find("#sb-train-chatbots").val(t?"dialogflow":"")}),e(M).on("change","textarea",function(){clearTimeout(ve),ve=setTimeout(()=>{nt.dialogflow.original_response=M.find("textarea").val()},500)}),e(M).on("change","#sb-train-chatbots",function(){M.find(".sb-type-text:not(.sb-first)").setClass("sb-hide","open-ai"==e(this).val())}),e(Ce).on("click","li",function(t){let s=e(this).parent().parent();return e(this).data("id")==s.find(" > p").attr("data-id")?(setTimeout(()=>{e(this).sbActive(!1)},100),!0):SBChat.conversation?(s.sbLoading()||i(`${o("All agents assigned to the new department will be notified. The new department will be")} ${e(this).html()}.`,"alert",()=>{let t=e(this).data("id");s.sbLoading(!0),dt.assignDepartment(SBChat.conversation.id,t,()=>{dt.setActiveDepartment(t),s.sbLoading(!1)})}),t.preventDefault(),!1):(e(this).parent().sbActive(!1),t.preventDefault(),!1)}),e(A).on("click","#conversation-agent li",function(t){let s=e(this).parent().parent(),a=e(this).data("id");return a==s.find(" > p").attr("data-value")||(SBChat.conversation?(s.sbLoading()||i(`${o("The new agent will be")} ${e(this).html()}.`,"alert",()=>{s.sbLoading(!0);dt.getSelectedConversations().forEach(e=>{dt.assignAgent(e.id,a,()=>{SBChat.conversation&&SBChat.conversation.id==e.id&&dt.setActiveAgent(a)})}),s.sbLoading(!1)}),t.preventDefault(),!1):(e(this).parent().sbActive(!1),t.preventDefault(),!1))}),E.on("click","> i,.sb-edit-note",function(t){let i=!!e(this).hasClass("sb-edit-note")&&e(this).closest("[data-id]");if(pt.genericPanel("notes",i?"Edit note":"Add new note",`<div class="sb-setting sb-type-textarea"><textarea${i?' data-id="'+i.attr("data-id")+'"':""} placeholder="${o("Write here your note...")}">${i?i.find(".sb-note-text").html().replace(/<a\s+href="([^"]*)".*?>(.*?)<\/a>/gi,"$1").replaceAll("<br>","\n"):""}</textarea></div>`,[[i?"Update note":"Add note",i?"check":"plus"]]),nt.is("dialogflow")&&SB_ADMIN_SETTINGS.note_data_scrape){let e="";for(var s in SB_ADMIN_SETTINGS.note_data_scrape)e+=`<option value="${s}">${SB_ADMIN_SETTINGS.note_data_scrape[s]}</option>`;k.find("#sb-add-note").parent().prepend(`<div id="note-ai-scraping" class="sb-setting sb-type-select"><select><option value="">${o("Data scraping")}</option>${e}</select></div>`)}return t.preventDefault(),!1}),e(k).on("change","#note-ai-scraping select",function(){let i=e(this).val();i&&!a(e(this).parent())&&SBF.ajax({function:"data-scraping",conversation_id:SBChat.conversation.id,prompt_id:i},i=>{if(i&&i.error)return console.error(i),t(i.error.message,"error");e(this).parent().sbLoading(!1);let s=k.find(".sb-notes-box textarea");s.val((s.val()+"\n"+i).trim())})}),E.on("click",".sb-delete-note",function(){let t=e(this).parents().eq(1);dt.notes.delete(SBChat.conversation.id,t.attr("data-id"),e=>{!0===e?t.remove():SBF.error(e)})}),e(k).on("click","#sb-add-note, #sb-update-note",function(){let i=e(this).parent().parents().eq(1).find("textarea"),s=i.val(),n=i.attr("data-id");if(0==s.length)SBForm.showErrorMessage(k.find(".sb-notes-box"),"Please write something...");else{if(a(this))return;s=SBF.escape(s),dt.notes.add(SBChat.conversation.id,SB_ACTIVE_AGENT.id,SB_ACTIVE_AGENT.full_name,s,a=>{Number.isInteger(a)||!0===a?(e(this).sbLoading(!1),k.sbHideLightbox(),n&&E.find(`[data-id="${n}"]`).remove(),dt.notes.update([{id:n||a,conversation_id:SBChat.conversation.id,user_id:SB_ACTIVE_AGENT.id,name:SB_ACTIVE_AGENT.full_name,message:s}],!0),i.val(""),t(n?"Note successfully updated.":"New note successfully added.")):SBForm.showErrorMessage(a)},n)}}),N.on("click","> i",function(e){let t=dt.tags.getAll(SBChat.conversation.details.tags);return pt.genericPanel("tags","Manage tags",t?'<div class="sb-tags-cnt">'+t+"</div>":"<p>"+o("Add tags from Settings > Admin > Tags.")+"</p>",["Save tags"]),e.preventDefault(),!1}),e(k).on("click",".sb-tags-cnt > span",function(){e(this).toggleClass("sb-active")}),e(k).on("click","#sb-add-tag",function(){e('<input type="text">').insertBefore(this)}),e(k).on("click","#sb-save-tags",function(){if(a(this))return;let i=k.find(".sb-tags-box").find("span.sb-active").map(function(){return e(this).attr("data-value")}).toArray(),s=SBChat.conversation.id;SBF.ajax({function:"update-tags",conversation_id:s,tags:i},a=>{if(e(this).sbLoading(!1),!0===a&&(dt.tags.update(i),SBChat.conversation&&s==SBChat.conversation.id)){let t=dt.filters()[3],a=w(s);if(SBChat.conversation.set("tags",i),t&&!i.includes(t))a.remove(),dt.clickFirst();else if(SB_ADMIN_SETTINGS.tags_show){let t=a.find(".sb-tags-area"),s=dt.tags.codeLeft(i);t.length?t.replaceWith(s):e(s).insertAfter(a.find(".sb-name"))}}k.sbHideLightbox(),t(!0===a?"Tags have been successfully updated.":a)})}),e(R).on("click","span",function(){SBChat.insertText(e(this).text()),R.html("")}),e(R).on("mouseover","span",function(){ve=setTimeout(()=>{e(this).addClass("sb-suggestion-full")},2500)}),e(R).on("mouseout","span",function(){clearTimeout(ve),R.find("span").removeClass("sb-suggestion-full")}),e(A).on("click",".sb-list .sb-menu > li",function(){let t=e(this).closest("[data-id]"),i=t.attr("data-id"),s=SBChat.conversation.getMessage(i),a=s.get("user_type"),n=e(this).attr("data-value");switch(n){case"delete":SBChat.user_online?SBF.ajax({function:"update-message",message_id:i,message:"",attachments:[],payload:{event:"delete-message"}},()=>{SBChat.conversation.deleteMessage(i),t.remove()}):SBChat.deleteMessage(i);break;case"translation":case"original":let r="translation"==n,l=["translation","translation-language","original-message","original-message-language"],c=l.map(e=>s.payload(e)).concat(s.details.message);s.set("message",r?s.payload("translation")||s.get("message"):s.payload("original-message")||s.get("message")),l.forEach(e=>delete s.details.payload[e]),t.replaceWith(s.getCode().replace('sb-menu">',`sb-menu"><li data-value="${r?"original":"translation"}">${o(r?"View original message":"View translation")}</li>`)),l.forEach((e,t)=>s.payload(e,c[t])),s.details.message=c[4];break;case"bot":nt.dialogflow.showCreateIntentBox(e(this).closest("[data-id]").attr("data-id"));break;case"reply":let d=SBF.isAgent(a),u=s.get("message");u||s.attachments.forEach(e=>{u+='<i class="sb-icon-clip"></i>'+e[0]}),A.find(".sb-editor [data-reply]").remove(),A.find(".sb-editor").prepend(`<div data-reply="${i}"${d?' class="sb-reply-color"':""}><span>${d&&k||!d&&!k?o("You"):s.get("full_name")}</span>${u}<i class="sb-icon-close" onclick="SBChat.cancelReply()"></i></div>`),T.addClass("sb-reply-active")}}),e(A).on("click",".sb-filter-btn i",function(){e(this).parent().toggleClass("sb-active")}),e(A).on("click",".sb-filter-star",function(){e(this).parent().find("li").sbActive(!1),e(this).parent().find(`li[data-value="${e(this).sbActive()?"":e(this).attr("data-value")}"]`).last().sbActive(!0).click(),e(this).toggleClass("sb-active")}),L.on("click","#sb-attachments-filter li",function(){let t=L.find("a:not(.sb-collapse-btn)"),i=e(this).attr("data-value");t.each(function(){e(this).setClass("sb-hide",i&&SBF.getFileType(e(this).attr("href"))!=i)}),l(L,160)}),e(k).on("click",".sb-cc-box #sb-save-changes",function(){let t=k.find(".sb-cc-box .repeater-item input").map(function(){return e(this).val()}).get().join(",");a(this),SBF.ajax({function:"update-conversation-extra",conversation_id:SBChat.conversation.id,extra:t||"NULL"},()=>{SBChat.conversation.set("extra",t),dt.cc(t.split(",")),e(this).sbLoading(!1),k.sbHideLightbox()})}),SBF.getURL("user")&&(x.find(".sb-admin-nav #sb-users").click(),setTimeout(()=>{ut.show(SBF.getURL("user"))},500)),e(P).on("click","th :checkbox",function(){P.find("td :checkbox").prop("checked",e(this).prop("checked"))}),e(P).on("click",":checkbox",function(){let e=U.find('[data-value="delete"]'),t=U.find('[data-value="merge_users"]');P.find("td input:checked").length?e.removeAttr("style"):e.hide(),2==P.find("td input:checked").length?t.removeAttr("style"):t.hide()}),e(q).on("click","li",function(){ct.filter(e(this).data("type"))}),e(O).on("click","li",function(){let t=O.closest(".sb-filter-btn");setTimeout(()=>{ct.get(e=>{ct.populate(e)}),t.attr("data-badge",O.toArray().reduce((t,i)=>t+!!e(i).find("li.sb-active").data("value"),0))},100),t.sbActive(!1)}),e(U).on("input",".sb-search-btn input",function(){ct.search(this)}),e(U).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{ct.search(e(this).next())})}),e(P).on("click","th:not(:first-child)",function(){let t=e(this).hasClass("sb-order-asc")?"DESC":"ASC";e(this).toggleClass("sb-order-asc"),e(this).siblings().sbActive(!1),e(this).sbActive(!0),ct.sort(e(this).data("field"),t)}),e(P).parent().on("scroll",function(){!Ze&&!ct.search_query&&d(this,!0)&&Ue&&(Ze=!0,U.append('<div class="sb-loading-global sb-loading sb-loading-pagination"></div>'),ct.get(e=>{if(setTimeout(()=>{Ze=!1},500),Ue=e.length){let i="";for(var t=0;t<Ue;t++){let s=new SBUser(e[t],e[t].extra);i+=ct.getRow(s),je[s.id]=s}Ge++,P.find("tbody").append(i)}U.find(" > .sb-loading-pagination").remove()},!1,!0))}),e(V).on("click",".sb-delete",function(){if(SB_ACTIVE_AGENT.id==s().id)return t("You cannot delete yourself.","error");i("This user will be deleted permanently including all linked data, conversations, and messages.","alert",function(){ct.delete(s().id)})}),e(P).on("click","td:not(:first-child)",function(){ut.show(e(this).parent().attr("data-user-id"))}),e(H).on("click",".sb-top-bar .sb-edit",function(){ut.showEdit(s())}),e(U).on("click",".sb-new-user",function(){V.addClass("sb-user-new"),V.find(".sb-top-bar .sb-profile span").html(o("Add new user")),V.find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Add user")}`),V.find("input,select,textara").removeClass("sb-error"),V.removeClass("sb-cloud-admin"),"admin"==SB_ACTIVE_AGENT.user_type&&V.find("#user_type").find("select").html(`<option value="user">${o("User")}</option><option value="agent">${o("Agent")}</option><option value="admin">${o("Admin")}</option>`),ut.clear(V),ut.boxClasses(V),ut.updateRequiredFields("user"),V.sbShowLightbox()}),e(V).on("click",".sb-save",function(){if(a(this))return;let i=!!V.hasClass("sb-user-new"),n=V.attr("data-user-id"),r=ut.getAll(V.find(".sb-details")),l=ut.getAll(V.find(".sb-additional-details"));return e.map(r,function(e,t){r[t]=e[0]}),ut.errors(V)?(ut.showErrorMessage(V,SBF.isAgent(V.find("#user_type :selected").val())?"First name, last name, password and a valid email are required. Minimum password length is 8 characters.":V.find("#password").val().length<8?"Minimum password length is 8 characters.":"First name is required."),void e(this).sbLoading(!1)):SB_ACTIVE_AGENT.id==s().id&&"agent"==r.user_type&&"admin"==SB_ACTIVE_AGENT.user_type?(ut.showErrorMessage(V,"You cannot change your status from admin to agent."),void e(this).sbLoading(!1)):(r.user_type||(r.user_type="user"),void SBF.ajax({function:i?"add-user":"update-user",user_id:n,settings:r,settings_extra:l},a=>{if(SBF.errorValidation(a,"duplicate-email")||SBF.errorValidation(a,"duplicate-phone"))return ut.showErrorMessage(V,`This ${SBF.errorValidation(a,"duplicate-email")?"email":"phone number"} is already in use.`),void e(this).sbLoading(!1);i&&(n=a,s(new SBUser({id:n}))),s().update(()=>{je[n]=s(),i?(ut.clear(V),ct.update()):(ct.updateRow(s()),A.sbActive()&&dt.updateUserDetails(),n==SB_ACTIVE_AGENT.id&&(SBF.loginCookie(a[1]),SB_ACTIVE_AGENT.full_name=s().name,SB_ACTIVE_AGENT.profile_image=s().image,x.find(".sb-account").setProfile())),i&&V.find(".sb-profile").setProfile(o("Add new user")),e(this).sbLoading(!1),i||k.sbHideLightbox(),t(i?"New user added":"User updated")}),SBF.event("SBUserUpdated",{new_user:i,user_id:n})}))}),e(V).on("change","#user_type",function(){let t=e(this).find("option:selected").val();ut.boxClasses(V,t),ut.updateRequiredFields(t)}),e(H).on("click",".sb-user-conversations li",function(){dt.open(e(this).attr("data-conversation-id"),e(this).find("[data-user-id]").attr("data-user-id"))}),e(H).on("click",".sb-start-conversation",function(){dt.open(-1,s().id),dt.openConversation(-1,s().id),ze&&dt.mobileOpenConversation()}),e(H).on("click",".sb-top-bar [data-value]",function(){dt.showDirectMessageBox(e(this).attr("data-value"),[s().id])}),e(k).on("click","#sb-whatsapp-alert-btn",function(){dt.showDirectMessageBox("whatsapp",[s().id])}),e(U).on("click",".sb-top-bar [data-value]",function(){let s=e(this).data("value"),a=ct.getSelected();switch(s){case"whatsapp":m(a);break;case"message":case"custom_email":case"sms":dt.showDirectMessageBox(s,a);break;case"csv":ct.csv();break;case"delete":if(a.includes(SB_ACTIVE_AGENT.id))return t("You cannot delete yourself.","error");i("All selected users will be deleted permanently including all linked data, conversations, and messages.","alert",()=>{ct.delete(a),e(this).hide(),P.find("th:first-child input").prop("checked",!1)});break;case"merge_users":i("The selected users will be merged into one user.","alert",()=>{let t=P.find("td:first-child input:checked").map(function(){return e(this).closest("tr").attr("data-user-id")}).get();SBF.ajax({function:"merge-users",user_id_1:t[0],user_id_2:t[1]},e=>{let i=new SBUser(e,e.details);ct.updateRow(i),delete je[t[1]],je[t[0]]=i,P.find(`[data-user-id="${t[1]}"]`).remove(),n(!1)}),n()})}}),e(k).on("click",".sb-send-direct-message",function(){let i=e(this).attr("data-type")?e(this).attr("data-type"):D.attr("data-type"),s="whatsapp"==i,n=s?k.find("#sb-whatsapp-send-template-box"):D,o=n.find(".sb-direct-message-subject input").val(),r=s?"":n.find("textarea").val(),l=n.find(".sb-direct-message-users").val().replace(/ /g,""),d=!1,u=!1,p=[],h=!1;if(s){let e=n.find("#sb-whatsapp-send-template-list");d=e.val(),u=e.find("option:selected").attr("data-languages"),h=e.find("option:selected").attr("data-phone-id"),p=["header","body","button"].map(e=>n.find(`#sb-whatsapp-send-template-${e}`).val())}if(SBForm.errors(n))SBForm.showErrorMessage(n,"Please complete the mandatory fields.");else{if(a(this))return;let s=[];if((r.includes("recipient_name")||p.join("").includes("recipient_name"))&&s.push("first_name","last_name"),(r.includes("recipient_email")||p.join("").includes("recipient_email"))&&s.push("email"),"message"==i)SBF.ajax({function:"direct-message",user_ids:l,message:r},a=>{e(this).sbLoading(!1);let d=SB_ADMIN_SETTINGS.notify_user_email,u=SB_ADMIN_SETTINGS.sms_active_users;if(SBF.errorValidation(a))return SBForm.showErrorMessage(n,"An error has occurred. Please make sure all user ids are correct.");(d||u)&&SBF.ajax({function:"get-users-with-details",user_ids:l,details:s.concat(d&&u?["email","phone"]:[d?"email":"phone"])},e=>{d&&e.email.length?c(e,"email",r,0,u?e.phone:[],"email",o):u&&e.phone.length?c(e,"phone",r,0,[],"sms"):k.sbHideLightbox()}),t(`${SBF.slugToString(i)} sent to all users.`)});else{let t="custom_email"==i?"email":"phone";SBF.ajax({function:"get-users-with-details",user_ids:l,details:s.concat([t])},s=>{if(!s[t].length)return e(this).sbLoading(!1),SBForm.showErrorMessage(n,"No users found.");c(s,t,r,0,[],i,o,d,p,u,h)})}}}),e(U).on("click",".sb-filter-btn > i",function(){e(this).parent().toggleClass("sb-active")}),SBF.getURL("setting")&&ot.open(SBF.getURL("setting"),!0),e(W).on("click"," > .sb-tab > .sb-nav [id]",function(){let t=e(this).attr("id").substr(4);SBF.getURL("setting")!=t&&f("?setting="+t)}),e(k).on("click",'.sb-repeater-upload, [data-type="upload-image"] .image, [data-type="upload-file"] .sb-btn, #sb-chatbot-add-files, #sb-import-settings a, #sb-import-users a',function(){let s="";he=this,"sb-chatbot-add-files"==e(this).attr("id")?(s=".pdf,.txt,.json,.csv",se.find(".sb-pending").remove(),nt.openAI.train.skip_files=[],fe=function(){let e=pe.prop("files"),t="";for(var i=0;i<e.length;i++){let s=parseInt(e[i].size/1e3);t+=`<tr class="sb-pending" data-name="${e[i].name}"><td><input type="checkbox" /></td><td>${e[i].name}<label>${o("Pending")}</label></td><td>${s||1} KB</td><td><i class="sb-icon-delete"></i></td></tr>`}se.append(t)}):"sb-import-settings"==e(this).parent().parent().attr("id")?(s=".json",ge=(s=>{a(this)||(SBF.ajax({function:"import-settings",file_url:s},s=>{s?t("Settings saved. Reload to apply the changes."):i(s),e(this).sbLoading(!1)}),ge=!1)})):"sb-import-users"==e(this).parent().parent().attr("id")?(s=".csv",ge=(s=>{a(this)||(SBF.ajax({function:"import-users",file_url:s},s=>{s?t("Users imported successfully."):i(s),e(this).sbLoading(!1)}),ge=!1)})):e(this).hasClass("image")?s=".png,.jpg,.jpeg,.gif,.webp":e(this).hasClass("sb-repeater-upload")&&(ge=(t=>{let i=e(this).parent();i.find(".repeater-item:last-child input").val()&&ot.repeater.add(this),i.find(".repeater-item:last-child input").val(t)})),pe.attr("accept",s).prop("value","").click()}),e(W).on("click",'[data-type="upload-image"] .image > i',function(t){return SBF.ajax({function:"delete-file",path:e(this).parent().attr("data-value")}),e(this).parent().removeAttr("data-value").css("background-image",""),t.preventDefault(),!1}),e(k).on("click",".sb-repeater-add",function(){ot.repeater.add(this)}),e(k).on("click",".repeater-item > i",function(){setTimeout(()=>{ot.repeater.delete(this)},100)}),ot.initColorPicker(),e(W).find('[data-type="color"]').focusout(function(){let t=e(this).find("input").val();"rgb(255, 255, 255)"==t&&["color-admin-1","color-1"].includes(e(this).attr("id"))&&(t=""),setTimeout(()=>{e(this).find("input").val(t),e(this).find(".color-preview").css("background-color",t)},300),ot.set(e(this).attr("id"),[t,"color"])}),e(W).on("click",".sb-type-color .input i",function(t){e(this).parent().find("input").removeAttr("style").val("")}),e(W).on("click",".sb-color-palette span",function(){let t=e(this).sbActive();e(this).closest(".sb-repeater").find(".sb-active").sbActive(!1),e(this).sbActive(!t)}),e(W).on("click",".sb-color-palette ul li",function(){e(this).parent().parent().attr("data-value",e(this).data("value")).find("span").sbActive(!1)}),e(W).on("click",'[data-type="select-images"] .input > div',function(){e(this).siblings().sbActive(!1),e(this).sbActive(!0)}),e(W).on("click",".sb-select-checkbox-input",function(){e(this).toggleClass("sb-active")}),e(W).on("click",".sb-select-checkbox input",function(){let t=e(this).closest("[data-type]");t.find(".sb-select-checkbox-input").val(ot.get(t)[1].join(", "))}),e(W).on("click",".sb-save-changes",function(){ot.save(this)}),e(W).on("change",'#saved-replies [data-id="reply-name"], [data-id="rich-message-name"]',function(){e(this).val(e(this).val().replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-+/,"").replace(/-+$/,"").replace(/ /g,""))}),e(W).on("change",'#user-additional-fields [data-id="extra-field-name"]',function(){e(this).parent().next().find("input").val(SBF.stringToSlug(e(this).val()))}),e(W).on("click","#dialogflow-sync-btn a",function(e){let t="https://accounts.google.com/o/oauth2/auth?scope=https%3A%2F%2Fwww.googleapis.com/auth/dialogflow%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-translation%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-language"+(W.find("#google-calendar-active input").is(":checked")?"%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcalendar":"")+"&response_type=code&access_type=offline&redirect_uri="+SB_URL+"/apps/dialogflow/functions.php&client_id={client_id}&prompt=consent";if(!SB_ADMIN_SETTINGS.cloud||"auto"!=W.find("#google-sync-mode select").val()){let s=W.find("#google-client-id input").val();return s&&W.find("#google-client-secret input").val()?window.open(t.replace("{client_id}",s)):i("Before continuing enter Client ID and Client secret. Check the docs for more details."),e.preventDefault(),!1}if(SB_ADMIN_SETTINGS.credits)return window.open(t.replace("{client_id}",SB_ADMIN_SETTINGS.google_client_id)),e.preventDefault(),!1}),e(W).on("click","#dialogflow-redirect-url-btn a",function(e){return i(`<pre>${SB_URL}/apps/dialogflow/functions.php</pre>`),e.preventDefault(),!1}),e(W).on("click","#dialogflow-saved-replies a",function(t){return i("","alert",()=>{a(this)||SBF.ajax({function:"dialogflow-saved-replies"},()=>{e(this).sbLoading(!1)})}),t.preventDefault(),!1}),e(W).on("click","#test-email-user a, #test-email-agent a",function(){let t=e(this).parent().find("input").val();t&&t.indexOf("@")>0&&!a(this)&&SBF.ajax({function:"send-test-email",to:t,email_type:"test-email-user"==e(this).parent().parent().attr("id")?"user":"agent"},t=>{i(!0===t?"The message has been sent.":t,"info"),e(this).sbLoading(!1)})}),e(W).on("click","#email-server-troubleshoot a",function(e){return W.find("#test-email-user input").val(SB_ACTIVE_AGENT.email).next().click()[0].scrollIntoView({behavior:"smooth"}),e.preventDefault(),!1}),e(W).on("click","#test-sms-user a, #test-sms-agent a",function(){let t=e(this).parent().find("input").val();t&&!a(this)&&SBF.ajax({function:"send-sms",message:"Hello World!",to:t},t=>{i(t&&["sent","queued"].includes(t.status)?"The message has been sent.":`<pre>${JSON.stringify(t)}</pre>`),e(this).sbLoading(!1)})}),e(W).on("click",".sb-timetable > div > div > div",function(){let t=e(this).closest(".sb-timetable"),i=e(this).sbActive();if(e(t).find(".sb-active").sbActive(!1),i)e(this).sbActive(!1).find(".sb-custom-select").remove();else{let i=e(t).find("> .sb-custom-select").html();e(t).find(" > div .sb-custom-select").remove(),e(this).append(`<div class="sb-custom-select">${i}</div>`).sbActive(!0)}}),e(W).on("click",".sb-timetable .sb-custom-select span",function(){let t=[e(this).html(),e(this).attr("data-value")];e(this).closest(".sb-timetable").find("> div > div > .sb-active").html(t[0]).attr("data-value",t[1]),e(this).parent().sbActive(!1)}),e(W).on("click","#system-requirements a",function(e){let t="";return SBF.ajax({function:"system-requirements"},e=>{for(var i in e)t+=`<div class="sb-input"><span>${o(SBF.slugToString(i))}</span><div${e[i]?' class="sb-green"':""}>${o(e[i]?"Success":"Error")}</div></div>`;n(!1),pt.genericPanel("requirements","System requirements",t)}),n(),e.preventDefault(),!1}),e(W).on("click","#sb-path a",function(e){return SBF.ajax({function:"path"},e=>{i(`<pre>${e}</pre>`)}),e.preventDefault(),!1}),e(W).on("click","#sb-url a",function(e){return i(`<pre>${SB_URL}</pre>`),e.preventDefault(),!1}),e(W).on("click","#delete-leads a",function(t){return e(this).sbLoading()||i("All leads, including all the linked conversations and messages, will be deleted permanently.","alert",()=>{e(this).sbLoading(!0),SBF.ajax({function:"delete-leads"},()=>{i("Leads and conversations successfully deleted."),e(this).sbLoading(!1)})}),t.preventDefault(),!1}),e(W).on("click","#sb-export-settings a",function(t){if(t.preventDefault(),!a(this))return SBF.ajax({function:"export-settings"},t=>{_(t,"sb-export-settings-close","Settings exported"),e(this).sbLoading(!1)}),!1}),e(k).on("click","#sb-export-settings-close .sb-close, #sb-export-users-close .sb-close, #sb-export-report-close .sb-close",function(){SBF.ajax({function:"delete-file",path:k.find(".sb-dialog-box p pre").html()})}),SB_ADMIN_SETTINGS.cloud||(e(W).on("change","#push-notifications-provider select",function(){let t="pusher"==e(this).val();ot.visibility(0,t),SBF.ajax({function:"update-sw",url:t?"https://js.pusher.com/beams/service-worker.js":"https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.sw.js"})}),e(W).on("click","#push-notifications-sw-path a",function(e){let t=b(location.href.replace(location.host,"")).replace("admin.php","");return t.includes("?")&&(t=t.substring(0,t.indexOf("?"))),i("<pre>"+t+"</pre>"),e.preventDefault(),!1})),e(W).on("click","#push-notifications-btn a",function(e){return SB_ADMIN_SETTINGS.cloud||"onesignal"==W.find("#push-notifications-provider select").val()?typeof OneSignal!=et?OneSignal.Slidedown.promptPush({force:!0}):SBF.serviceWorker.initPushNotifications():Notification.requestPermission(),e.preventDefault(),!1}),e(W).on("input","#sb-search-settings",function(){let t=e(this).val().toLowerCase();SBF.search(t,()=>{let i="",s=W.find(".sb-search-dropdown-items");if(t.length>2){let s=W.find("> .sb-tab > .sb-nav li").map(function(){return e(this).text().trim()}).get();W.find(".sb-setting").each(function(){let a=e(this).attr("data-keywords"),n=e(this).attr("id");if(a&&a.includes(t)||n&&n.replaceAll("-","-").includes(t)||e(this).find(".sb-setting-content").text().toLowerCase().includes(t)){let t=e(this).parent().index();i+=`<div data-tab-index="${t}" data-setting="${e(this).attr("id")}">${s[t]} > ${e(this).find("h2").text()}</div>`}})}s.html(i),s.outerHeight()>e(window).height()-100?(s.css("max-height",e(window).height()-100),s.addClass("sb-scroll-area")):s.removeClass("sb-scroll-area")})}),e(W).on("click",".sb-search-dropdown-items div",function(){let t=e(this).attr("data-tab-index"),i=W.find("> .sb-tab > .sb-nav li").eq(t);i.click(),i.get(0).scrollIntoView(),W.find("#"+e(this).attr("data-setting"))[0].scrollIntoView()}),e(W).on("click","#slack-button a",()=>(window.open("https://board.support/synch/?service=slack&plugin_url="+SB_URL+g()),!1)),e(W).on("click","#slack-test a",function(t){if(!a(this))return SBF.ajax({function:"send-slack-message",user_id:!1,full_name:SB_ACTIVE_AGENT.full_name,profile_image:SB_ACTIVE_AGENT.profile_image,message:"Lorem ipsum dolor sit amete consectetur adipiscing elite incidido labore et dolore magna aliqua.",attachments:[["Example link",SB_URL+"/media/user.svg"],["Example link two",SB_URL+"/media/user.svg"]],channel:W.find("#slack-channel input").val()},t=>{i(SBF.errorValidation(t)?"slack-not-active"==t[1]?"Please first activate Slack, then save the settings and reload the admin area.":"Error. Response: "+JSON.stringify(t):"success"==t[0]?"Slack message successfully sent. Check your Slack app!":JSON.stringify(t)),e(this).sbLoading(!1)}),t.preventDefault(),!1}),e(W).on("click","#tab-slack",function(){let e=W.find("#slack-agents .input");e.html('<div class="sb-loading"></div>'),SBF.ajax({function:"slack-users"},t=>{let i="";if(SBF.errorValidation(t,"slack-token-not-found"))i=`<p>${o("Synchronize Slack and save changes before linking agents.")}</p>`;else{let e='<option value="-1"></option>';for(s=0;s<t.agents.length;s++)e+=`<option value="${t.agents[s].id}">${t.agents[s].name}</option>`;for(var s=0;s<t.slack_users.length;s++)i+=`<div data-id="${t.slack_users[s].id}"><label>${t.slack_users[s].name}</label><select>${e}</select></div>`}e.html(i),ot.set("slack-agents",[t.saved,"double-select"])})}),e(W).on("click","#slack-archive-channels a",function(t){t.preventDefault(),a(this)||SBF.ajax({function:"archive-slack-channels"},t=>{!0===t&&i("Slack channels archived successfully!"),e(this).sbLoading(!1)})}),e(W).on("click","#slack-channel-ids a",function(t){t.preventDefault(),a(this)||SBF.ajax({function:"slack-channels",code:!0},t=>{i(t,"info",!1,"","",!0),e(this).sbLoading(!1)})}),e(W).on("click",'#whatsapp-twilio-btn a, #whatsapp-twilio-get-configuartion-btn a, #sms-btn a, #wechat-btn a, #twitter-callback a, #viber-webhook a, #zalo-webhook a, [data-id="line-webhook"], #messenger-path-btn a',function(t){let s=e(this).closest("[id]").attr("id"),a="";if(t.preventDefault(),"line"==s){if(!(a=e(this).closest(".repeater-item").find('[data-id="line-secret"]').val()))return;a="?line_secret="+a}return i(`<pre>${SB_URL+("sms-btn"==s?"/include/api.php":"/apps/"+(s.includes("-")?s.substring(0,s.indexOf("-")):s)+"/post.php")+a+g().replace("&",a?"&":"?")}</pre>`),!1}),e(W).on("click",'[data-id="telegram-numbers-button"], #viber-button a, #whatsapp-360-button a',function(t){let s,n={"telegram-button":["#telegram-token input","telegram-synchronization",["result",!0]],"viber-button":["#viber-token input","viber-synchronization",["status_message","ok"]],"whatsapp-360-button":["#whatsapp-360-key input","whatsapp-360-synchronization",["success",!0]]},o=e(this).parent().attr("id"),r=!1;if(o)s=W.find(n[o][0]).val().trim();else{o={"telegram-numbers-button":"telegram-button"}[e(this).attr("data-id")],s=e(this).closest(".repeater-item").find(`[data-id="${{"telegram-button":"telegram-numbers-token"}[o]}"]`).val().trim(),r=!0}return n=n[o],t.preventDefault(),!(!s||a(this))&&(SBF.ajax({function:n[1],token:s,cloud_token:g(),is_additional_number:r},t=>{i(n[2][0]in t&&t[n[2][0]]==n[2][1]?"Synchronization completed.":JSON.stringify(t)),e(this).sbLoading(!1)}),!1)}),e(W).on("click","#whatsapp-test-template a",function(t){t.preventDefault();let s=e(this).parent().find("input").val();if(s&&!a(this))return SBF.ajax({function:"whatsapp-send-template",to:s},t=>{i(t?"error"in t?t.error.message?t.error.message:t.error:"Message sent, check your WhatsApp!":t),e(this).sbLoading(!1)}),!1}),e(W).on("click","#twitter-subscribe a",function(t){return t.preventDefault(),!a(this)&&(SBF.ajax({function:"twitter-subscribe",cloud_token:g()},t=>{i(!0===t?"Synchronization completed.":JSON.stringify(t)),e(this).sbLoading(!1)}),!1)}),SB_ADMIN_SETTINGS.cloud||e(W).on("click","#messenger-sync-btn a",()=>(window.open("https://board.support/synch/?service=messenger&plugin_url="+SB_URL+g()),!1)),e(W).on("change","#messenger-sync-mode select",function(){ot.visibility(1,"manual"!=e(this).val())}),e(W).on("click","#messenger-unsubscribe a",function(t){return t.preventDefault(),i("","alert",()=>{if(a(this))return!1;SBF.ajax({function:"messenger-unsubscribe"},t=>{e(this).sbLoading(!1),t?i(JSON.stringify(t)):(W.find("#messenger-pages .repeater-item > i").click(),setTimeout(()=>{ot.save(),i("Operation successful.")},300))})}),!1}),e(W).on("change","#open-ai-mode select",function(){ot.visibility(2,"assistant"!=e(this).val())}),e(W).on("click","#wp-sync a",function(t){return t.preventDefault(),!a(this)&&(nt.wordpress.ajax("wp-sync",{},t=>{!0===t||"1"===t?(ct.update(),i("WordPress users successfully imported.")):i("Error. Response: "+JSON.stringify(t)),e(this).sbLoading(!1)}),!1)}),e("body").on("click","#wp-admin-bar-logout",function(){SBF.logout(!1)}),e(W).on("click","#whatsapp-clear-flows a",function(e){e.preventDefault(),SBF.ajax({function:"whatsapp-clear-flows"})}),e(W).on("click","#tab-translations",function(){let e=W.find(".sb-translations > .sb-nav > ul");if(!e.html()){let i="";for(var t in SB_LANGUAGE_CODES)"en"!=t&&(i+=`<li data-code="${t}"><img src="${SB_URL}/media/flags/${t}.png" />${SB_LANGUAGE_CODES[t]}</li>`);e.html(i)}}),e(W).on("click",".sb-translations .sb-nav li",function(){ot.translations.load(e(this).data("code"))}),e(W).on("click",".sb-translations .sb-menu-wide li",function(){W.find(`.sb-translations [data-area="${e(this).data("value")}"]`).sbActive(!0).siblings().sbActive(!1)}),e(W).on("click",".sb-add-translation",function(){W.find(".sb-translations-list > .sb-active").prepend(`<div class="sb-setting sb-type-text sb-new-translation"><input type="text" placeholder="${o("Enter original text...")}"><input type="text" placeholder="${o("Enter translation...")}"></div></div>`)}),e(W).on("input",".sb-search-translation input",function(){let t=e(this).val().toLowerCase();SBF.search(t,()=>{t.length>1&&W.find(".sb-translations .sb-content > .sb-active label").each(function(){let i=e(this).html().toLowerCase();if(i.includes(t)&&i!=ye){let t=W.find(".sb-scroll-area");return t[0].scrollTop=0,t[0].scrollTop=e(this).position().top-80,ye=i,!1}})})}),e(W).on("click",'[data-id="email-piping-sync"]',function(t){a(this)||(SBF.ajax({function:"email-piping",force:!0},t=>{i(!0===t?"Syncronization completed.":t),e(this).sbLoading(!1)}),t.preventDefault())}),e(W).on("click","#tab-automations",function(){ot.automations.get(()=>{ot.automations.populate(),n(!1)},!0),n()}),e(k).on("click",".sb-add-condition",function(){ot.automations.addCondition(e(this).prev())}),e(k).on("change",".sb-condition-1 select",function(){ot.automations.updateCondition(this)}),e(k).on("change",".sb-condition-2 select",function(){e(this).parent().next().setClass("sb-hide",["is-set","is-not-set"].includes(e(this).val()))}),e(J).on("click","li",function(){ot.automations.populate(e(this).data("value"))}),e(Y).on("click","li",function(){ot.automations.show(e(this).attr("data-id"))}),e(z).on("click",".sb-add-automation",function(){ot.automations.add()}),e(Y).on("click","li i",function(){i("The automation will be deleted permanently.","alert",()=>{ot.automations.delete(this)})});let Se=["Settings > {R} won't work if Settings > {R2} is active."];e(W).on("click",".sb-setting",function(i){let s=e(this).attr("id");switch(e(this).hasClass("sb-type-multi-input")&&(s=e(i.target).parent().attr("id")),s){case"close-chat":case"close-message":W.find("#close-active input").is(":checked")&&W.find("#close-chat input").is(":checked")&&t(Se[0].replace("{R}","Messages > Close message").replace("{R2}","Chat > Close chat"),"info");break;case"chat-timetable":case"follow-message":case"queue":case"routing":("queue"==s&&W.find("#queue-active input").is(":checked")||"routing"==s&&W.find("#routing input").is(":checked")||"follow-message"==s&&W.find("#follow-active input").is(":checked")||"chat-timetable"==s&&W.find("#chat-timetable-active input").is(":checked"))&&W.find("#dialogflow-human-takeover-active input").is(":checked")&&t("Since Settings > Artificial Intelligence > Human takeover is active, this option will only take effect during human takeover.","info");break;case"notify-agent-email":case"push-notifications":case"sms":("sms"==s&&W.find("#sms-active-agents input").is(":checked")||"push-notifications"==s&&W.find("#push-notifications-active input").is(":checked")||"notify-agent-email"==s&&W.find("#notify-agent-email input").is(":checked"))&&W.find("#dialogflow-human-takeover-active input").is(":checked")&&t("Since Settings > Artificial Intelligence > Human takeover is active, notifications will be sent only after the human takeover.","info");break;case"privacy":W.find("#privacy-active input").is(":checked")&&W.find("#registration-required select").val()&&t(Se[0].replace("{R}","Messages > Privacy message").replace("{R2}","Users > Require registration"),"info");break;case"google-multilingual-translation":e(i.target).is(":checked")&&W.find("#open-ai-active input").is(":checked")&&!W.find("#open-ai-training-data-language select").val()&&t("If your OpenAI training data isn't in English, set the default language under OpenAI > Training data language.","info");break;case"open-ai-prompt":t("Custom prompts may break the chatbot, we advise leaving it empty.","info");break;case"open-ai-tokens":case"open-ai-temperature":case"open-ai-presence-penalty":case"open-ai-frequency-penalty":case"open-ai-logit-bias":case"open-ai-custom-model":t("This is an advanced setting, incorrect values may break the chatbot. If you're unsure, leave it empty.","info");break;case"open-ai-user-train-conversations":e(i.target).is(":checked")&&t("This method is not recommended. See the docs for details.","info");break;case"google-calendar-active":t("Sync Google again from Settings > Artificial Intelligence > Google > Synchronization.","info");break;case"google-calendar-slot-time":t("Set the available booking times under Settings > Miscellaneous > Scheduled Office Hours.","info");break;case"welcome-disable-office-hours":case"follow-disable-office-hours":("follow-disable-office-hours"==s&&W.find("#follow-disable-office-hours input").is(":checked")||"welcome-disable-office-hours"==s&&W.find("#welcome-disable-office-hours input").is(":checked"))&&t("Set office hours in Settings > Miscellaneous > Office Hours.","info")}}),e(q).on("click",'[data-type="online"]',function(){SB_ADMIN_SETTINGS.visitors_registration||t("Settings > Users > Register all visitors must be enabled to see online users.","info")}),e(W).on("click","#dialogflow-active,#dialogflow-welcome,#dialogflow-departments",function(e){t("Warning! We will stop supporting Dialogflow by the end of 2025. All its features will be available through OpenAI. Please use OpenAI instead of Dialogflow.","info")}),e(W).on("change","#registration-required select",function(){let i=e(this).val();["registration-login"].includes(i)&&!W.find('[id="reg-email"] input').is(":checked")&&t("The email field is required to activate the login form.","info"),i&&W.find("#privacy-active input").is(":checked")&&t(Se[0].replace("{R}","Messages > Privacy message").replace("{R2}","Users > Require registration"),"info")}),e(ie).on("click","#sb-flow-add",function(){pt.genericPanel("flow-add","Enter the flow name",'<div class="sb-setting"><input type="text"></div>',["Add new flow"])}),e(k).on("click","#sb-add-new-flow",function(){nt.openAI.flows.set(k.find(".sb-flow-add-box input").val()),k.sbHideLightbox()}),e(de).on("click",".sb-flow-block",function(){de.find(".sb-flow-block,.sb-flow-add-block").sbActive(!1),e(this).sbActive(!0);let t,i=nt.openAI.flows.blocks.get(),s="",a=e(this).attr("data-type"),n=`<div class="sb-title">{R}</div><div data-type="repeater" class="sb-setting sb-type-repeater"><div class="input"><div class="sb-repeater">{R2}</div><div class="sb-btn sb-btn-white sb-repeater-add sb-icon"><i class="sb-icon-plus"></i>${o("Add new item")}</div></div></div>`,r=`<div class="sb-title">${o("Conditions")}</div><div class="sb-flow-conditions"></div><div class="sb-add-condition sb-btn sb-icon sb-btn-white"><i class="sb-icon-plus"></i>${o("Add condition")}</div>`,l=`<div class="sb-title">${o("Message")}</div><div class="sb-setting"><textarea placeholder="${o("The message sent to the user...")}">${i.message}</textarea></div>`,c=nt.openAI.getCode.select_user_details();switch(a){case"start":(s=ot.getSelectDepartments(i.department))&&(s=`<div class="sb-title">${o("Department")}</div><div class="sb-setting">${s}</div>`),s+=`<div class="sb-title">${o("Source")}</div><div class="sb-setting">${nt.getSelectMessagingApps(i.conversation_source,!0)}</div>`,t=`<div class="sb-title">${o("Start event")}</div><div class="sb-setting"><select class="sb-flow-start-select"><option value="message"${"message"==i.start?" selected":""}>${o("User message")}</option><option value="conversation"${"conversation"==i.start?" selected":""}>${o("New conversation started")}</option><option value="load"${"load"==i.start?" selected":""}>${o("On page load")}</option></select></div><div class="sb-title sb-title-flow-start${"message"==i.start?"":" sb-hide"}">${o("User message")}</div><div data-type="repeater" class="sb-setting sb-flow-start-messages sb-type-repeater"><div class="input"><div class="sb-repeater"><div class="repeater-item"><div class="sb-setting"><textarea data-id="message" placeholder="${o("Enter the message the user must send to start this flow")}"></textarea></div><i class="sb-icon-close"></i></div></div><div class="sb-btn sb-btn-white sb-repeater-add sb-icon"><i class="sb-icon-plus"></i>${o("Add message")}</div></div></div>${r}${s}<div class="sb-title">${o("Disabled")}</div><div class="sb-setting"><input type="checkbox" id="sb-flow-disabled"${i.disabled?" checked":""}></div>`;break;case"choices":case"button_list":i.options&&i.options.length||(i.options=[""]);for(u=0;u<i.options.length;u++)s+=`<div class="repeater-item"><div><input data-id type="text" value="${i.options[u].replaceAll("\\,",", ").replaceAll("  "," ")}"></div><i class="sb-icon-close"></i></div>`;t=l+n.replace("{R}",o("Choices")).replace("{R2}",s)+`<div class="sb-title">${o("Conversational mode")}</div><div class="sb-setting"><input type="checkbox" id="sb-conversational-mode"${i.conversational_mode?" checked":""}></div>`;break;case"message":i.attachments&&i.attachments.length||(i.attachments=[""]);for(u=0;u<i.attachments.length;u++)s+=`<div class="repeater-item"><div><input data-id type="text" value="${i.attachments[u]}" placeholder="${o("Enter a link...")}"></div><i class="sb-icon-close"></i></div>`;t=l+n.replace("{R}",o("Attachments")).replace("{R2}",s).replace("</div></div></div>",'</div><i class="sb-repeater-upload sb-btn-icon sb-icon-clip"></i></div></div>');break;case"video":t=`${l}<div class="sb-title">${o("Video URL")}</div><div class="sb-setting"><input type="url" placeholder="${o("Enter a YouTube or Vimeo link...")}" value="${i.url}"></div>`;break;case"get_user_details":i.details&&i.details.length||(i.details=[["","",!1]]);for(u=0;u<i.details.length;u++)s+=`<div class="repeater-item"><div>${c.replace(`"${i.details[u][0]}"`,`"${i.details[u][0]}" selected`)}<div class="sb-setting"><input type="text" placeholder="${o("Enter a description...")}" value="${i.details[u][1]}" /></div><div class="sb-setting"><label>${o("Required")}</label><input type="checkbox" ${i.details[u][2]?" checked":""}></div></div><i class="sb-icon-close"></i></div>`;t=l+n.replace("{R}",o("User details")).replace("{R2}",s).replace("sb-type-repeater","sb-type-repeater sb-repeater-block-user-details");break;case"set_data":t=nt.openAI.getCode.set_data(i.data);break;case"action":t=nt.openAI.getCode.actions(i.actions);break;case"rest_api":let e=["headers","save_response"];t=`<div class="sb-title">${o("URL")}</div><div class="sb-setting"><input type="url" class="sb-rest-api-url" value="${i.url}"></div><div class="sb-title">${o("Method")}</div><div class="sb-setting"><select class="sb-rest-api-method"><option value="GET"${"GET"==i.method?" selected":""}>GET</option><option value="POST"${"POST"==i.method?" selected":""}>POST</option><option value="PUT"${"PUT"==i.method?" selected":""}>PUT</option><option value="PATH"${"PATH"==i.method?" selected":""}>PATH</option><option value="DELETE"${"DELETE"==i.method?" selected":""}>DELETE</option></select></div><div class="sb-title">${o("Body")}</div><div class="sb-setting"><textarea placeholder="JSON">${i.body}</textarea></div>`;for(u=0;u<e.length;u++){let s=i[e[u]];s&&s.length||(s=[["",""]]),t+=`<div class="sb-title">${o(SBF.slugToString(e[u]))}</div><div data-type="repeater" class="sb-setting sb-type-repeater sb-repeater-block-rest-api sb-rest-api-${e[u]}"><div class="input"><div class="sb-repeater">`;for(var d=0;d<s.length;d++)t+=`<div class="repeater-item"><div>${1==u?c.replace(`"${s[d][0]}"`,`"${s[d][0]}" selected`):`<div class="sb-setting"><input type="text" placeholder="${o("Key")}" value="${s[d][0]}" /></div>`}<div class="sb-setting"><input type="text" placeholder="${o(1==u?"e.g. data.id":"Value")}" value="${s[d][1]}" /></div></div><i class="sb-icon-close"></i></div>`;t+=`</div><div class="sb-btn sb-btn-white sb-repeater-add sb-icon"><i class="sb-icon-plus"></i>${o("Add new item")}</div></div></div>`}break;case"condition":t=r;break;case"tools":let p=i.headers,h=i.properties;t=l+`<div class="sb-title">${o("URL")}</div><div class="sb-setting"><input type="url" class="sb-tools-url" value="${i.url}"></div><div class="sb-title">${o("Method")}</div><div class="sb-setting"><select class="sb-tools-method"><option value="GET"${"GET"==i.method?" selected":""}>GET</option><option value="POST"${"POST"==i.method?" selected":""}>POST</option><option value="PUT"${"PUT"==i.method?" selected":""}>PUT</option><option value="PATH"${"PATH"==i.method?" selected":""}>PATH</option><option value="DELETE"${"DELETE"==i.method?" selected":""}>DELETE</option></select></div>`,p&&p.length||(p=[["",""]]),h&&h.length||(h=[["","",""]]);for(u=0;u<p.length;u++)s+=`<div class="repeater-item"><div><input type="text" placeholder="${o("Key")}" value="${p[u][0]}" /><input type="text" placeholder="${o("Value")}" value="${p[u][1]}" /></div><i class="sb-icon-close"></i></div>`;t+=n.replace("{R}",o("Headers")).replace("{R2}",s).replace("sb-type-repeater","sb-type-repeater sb-setting sb-repeater-inputs-h sb-repeater-block-tools-headers"),s="";for(u=0;u<h.length;u++)s+=`<div class="repeater-item"><div><input type="text" placeholder="${o("Name")}" value="${h[u][0]}" /></div><div><input type="text" placeholder="${o("Description")}" value="${h[u][1]}" /></div><div><input type="text" placeholder="${o("Allowed values separated by commas")}" value="${h[u][2]}" /></div><i class="sb-icon-close"></i></div>`;t+=n.replace("{R}",o("Properties")).replace("{R2}",s).replace("sb-type-repeater","sb-type-repeater sb-setting sb-repeater-inputs-v sb-repeater-block-tools-properties");break;case"flow_connector":t=`<div class="sb-title">${o("Flow")}</div><div class="sb-setting"><select class="sb-flows-select">`;let f=nt.openAI.flows.flows;for(var u=0;u<f.length;u++)f[u].name!=nt.openAI.flows.getActiveName()&&(t+=`<option value="${f[u].name}" ${f[u].name==i.flow_name?" selected":""}>${f[u].name}</option>`);t+="</div>"}if("start"!=a&&(t+=`<div id="sb-block-delete" class="sb-btn-text"><i class="sb-icon-delete"></i>${o("Delete")}</div>`),pt.genericPanel("flow-block",SBF.slugToString(a),t,["Save changes"],"",!0),"start"==a||"condition"==a){let e=k.find(".sb-flow-start-messages .sb-repeater"),t=ot.repeater.set(i.message,e.find(".repeater-item:last-child"));ot.automations.setConditions(i.conditions,k.find(".sb-flow-conditions")),t&&e.html(t)}We=[],de.find("> div").each(function(){We.push(e(this).find("> div")[0].scrollTop)})}),e(k).on("click",".sb-flow-block-box #sb-save-changes",function(){let t=nt.openAI.flows.blocks.get(),i=k.find(".sb-flow-block-box");switch(t.message=i.find("textarea").val(),t.type){case"start":if(t.start=i.find("select").val(),t.message="message"==t.start?ot.repeater.get(i.find(".sb-flow-start-messages .repeater-item")):"",t.disabled=i.find("#sb-flow-disabled").is(":checked"),t.department=i.find(".sb-select-departments").val(),t.conversation_source=i.find(".sb-select-messaging-apps").val(),t.conditions=ot.automations.getConditions(i.find(".sb-flow-conditions")),t.message.length&&t.message[0].message.trim().split(" ").length<3)return i.find(".sb-info").sbActive(!0).html(o("The message must contain at least 3 words."));break;case"choices":case"button_list":t.options=i.find(".sb-repeater input").map(function(){return e(this).val().trim().replaceAll(",","\\,")}).get().filter(function(e){return""!=e}),t.conversational_mode=i.find("#sb-conversational-mode").is(":checked");break;case"message":t.attachments=i.find(".sb-repeater input").map(function(){return e(this).val().trim()}).get().filter(function(e){return""!=e});break;case"video":t.url=i.find("input").val();break;case"get_user_details":t.details=i.find(".repeater-item").map(function(){return[[e(this).find("select").val(),e(this).find("input[type=text]").val(),e(this).find("input[type=checkbox]").is(":checked")]]}).get();break;case"action":case"set_data":t["action"==t.type?"actions":"data"]=i.find(".repeater-item").map(function(){return[[e(this).find("select").val(),e(this).find("input").length?e(this).find("input").val().replace(/https?:\/\/|["|:]/g,""):""]]}).get();break;case"rest_api":t.headers=i.find(".sb-rest-api-headers .repeater-item").map(function(){return[[e(this).find("input").eq(0).val(),e(this).find("input").eq(1).val()]]}).get(),t.save_response=i.find(".sb-rest-api-save_response .repeater-item").map(function(){return[[e(this).find("select").val(),e(this).find("input").val()]]}).get(),t.url=i.find(".sb-rest-api-url").val(),t.method=i.find(".sb-rest-api-method").val(),t.body=i.find("textarea").val(),delete t.message;break;case"condition":t.conditions=ot.automations.getConditions(i.find(".sb-flow-conditions"));break;case"tools":t.url=i.find(".sb-tools-url").val(),t.method=i.find(".sb-tools-method").val(),t.headers=i.find(".sb-repeater-block-tools-headers .repeater-item").map(function(){return[[e(this).find("input").eq(0).val(),e(this).find("input").eq(1).val()]]}).get(),t.properties=i.find(".sb-repeater-block-tools-properties .repeater-item").map(function(){return[[e(this).find("input").eq(0).val(),e(this).find("input").eq(1).val(),e(this).find("input").eq(2).val()]]}).get(),1!=t.properties.length||t.properties[0][0]||(t.properties=[]),1!=t.headers.length||t.headers[0][0]||(t.headers=[]);break;case"flow_connector":t.flow_name=i.find(".sb-flows-select").val()}nt.openAI.flows.blocks.set(t),de.find("> div").each(function(){e(this).find("> div")[0].scrollTop=We[e(this).index()]}),k.sbHideLightbox()}),e(k).on("change",".sb-repeater-block-actions select",function(){e(this).parent().next().remove(),e(this).parent().parent().append(nt.openAI.getCode.action(e(this).val(),""))}),e(k).on("change",".sb-flow-start-select",function(){k.find(".sb-title-flow-start, .sb-flow-start-messages").setClass("sb-hide","message"!=e(this).val())}),e(de).on("mouseleave",".sb-flow-connectors > div, .sb-flow-block",function(){de.find(".sb-flow-block-cnt").sbActive(!1),He=!1,e(this).parent().hasClass("sb-flow-connectors")?nt.openAI.flows.blocks.activateLinkedCnts(e(this).closest(".sb-flow-block")):de.find(".sb-flow-connectors > div").sbActive(!1)}),e(de).on("mouseenter",".sb-flow-connectors > div",function(){let t=e(this).closest(".sb-flow-block").parent(),i=nt.openAI.flows.blocks.getNextCntIndexes(nt.openAI.flows.getActiveIndex(),t.parent().parent().index(),t.index());He=!0,de.find("> div").eq(t.parent().parent().index()+1).find(".sb-flow-block-cnt").sbActive(!1).eq(i[e(this).index()]).sbActive(!0)}),e(de).on("mouseenter",".sb-flow-block",function(){nt.openAI.flows.blocks.activateLinkedCnts(this)}),e(de).on("click",".sb-flow-add-block",function(){de.find(".sb-flow-block,.sb-flow-add-block").sbActive(!1),e(this).sbActive(!0);let t=nt.openAI.flows.steps.get()[nt.openAI.flows.blocks.getActiveCntIndex()].map(e=>e.type),i=!t.some(e=>["message","button_list","choices","video","get_user_details","condition"].includes(e)),s=[["set_data","Set data"],["action","Action"],["condition","Condition"],["tools","Tools calling"],["rest_api","REST API"],["flow_connector","Flow connector"]],a="";for(var n=0;n<s.length;n++)t.includes(s[n][0])||"condition"==s[n][0]&&t.includes("choices")||(a+=`<li data-value="${s[n][0]}">${o(s[n][1])}</li>`);pt.genericPanel("flows-blocks-nav","",`<ul class="sb-menu">${i?`<li>${o("Messages")} <ul><li data-value="message">${o("Send message")}</li><li data-value="choices">${o("Send choices")}</li><li data-value="video">${o("Send video")}</li></ul></li>`:""}<li>${o("More")} <ul>${i?`<li data-value="get_user_details">${o("Get user details")}</li>`:""}${a}</ul></li></ul>`)}),e(k).on("click","#sb-block-delete",function(){nt.openAI.flows.blocks.delete(),k.sbHideLightbox()}),e(ce).on("click","li",function(){nt.openAI.flows.show(e(this).attr("data-value"))}),e(ce).on("click","li i",function(t){return i("The flow will be deleted.","alert",()=>{nt.openAI.flows.delete(e(this).parent().attr("data-value"))}),t.preventDefault(),!1}),e(k).on("click",".sb-flows-blocks-nav-box [data-value]",function(){nt.openAI.flows.blocks.add(e(this).data("value")),k.sbHideLightbox()}),e(k).on("mouseenter",".sb-flow-scroll",function(){let t=e(this).hasClass("sb-icon-arrow-left");ue=setInterval(()=>{de[0].scrollLeft+=10*(t?-1:1)},10)}),e(k).on("mouseleave",".sb-flow-scroll",function(){clearInterval(ue)}),e(ie).on("click","#sb-train-chatbot",function(t){let s="The chatbot has been successfully trained.",n=ie.find('.sb-nav [data-value="conversations"]');if(i("<br><br><br><br><br>","info",!1,"sb-embeddings-box"),t.preventDefault(),SB_ADMIN_SETTINGS.cloud&&SBCloud.creditsAlert(this,t))return!1;if(a(this))return!1;if("flows"==ie.find(".sb-menu-chatbot .sb-active").attr("data-type"))return nt.openAI.flows.save(()=>{i(s,"info",!1,!1,"Success")}),void e(this).sbLoading(!1);if(n.sbActive()){let t=[];for(var r=0;r<Ve.length;r++){let i=ie.find(`#sb-chatbot-conversations [data-index="${r}"]`);i.length?(i=[i.find("input").val(),i.find("textarea").val()])[0]==e("<textarea />").html(Ve[r].question).text()&&i[1]==e("<textarea />").html(Ve[r].answer).text()||(Ve[r].question=i[0],Ve[r].answer=i[1],t.push(Ve[r])):(Ve[r].question=!1,Ve[r].answer=!1,t.push(Ve[r]))}return void(t.length?SBF.ajax({function:"open-ai-save-conversation-embeddings",qea:t},t=>{!0===t[0]?i(s,"info",!1,!1,"Success"):nt.openAI.train.isError(t[0])||i(t[0]),n.click(),e(this).sbLoading(!1)}):(e(this).sbLoading(!1),i(s,"info",!1,!1,"Success")))}nt.openAI.train.errors=[];return nt.openAI.train.files(t=>{nt.openAI.train.urls=ie.find('[data-id="open-ai-sources-url"]').map(function(){return e(this).val().trim()}).get(),nt.openAI.train.extract_url=ie.find('[data-id="open-ai-sources-extract-url"]').map(function(){return e(this).is(":checked")}).get(),nt.openAI.train.website(t=>{nt.openAI.train.qea(t=>{nt.openAI.train.articles(t=>{nt.openAI.init(),ie.find("#sb-repeater-chatbot-website .repeater-item i").click(),nt.openAI.train.errors.length?(i(o("The chatbot has been trained with errors. Check the console for more details.")+"\n\n<pre>"+nt.openAI.train.errors.join("<br>").replaceAll("false,","")+"</pre>","info",!1,"sb-errors-list-box",!1,!0),console.error(nt.openAI.train.errors)):nt.openAI.train.isError(t)||i(s,"info",!1,!1,"Success"),e(this).sbLoading(!1)})})})}),!1}),e(ie).on("click","#sb-table-chatbot-files td i, #sb-table-chatbot-website td i, #sb-chatbot-delete-files, #sb-chatbot-delete-website, #sb-chatbot-delete-all-training, #sb-chatbot-delete-all-training-conversations",function(){let s=e(this).is("i"),n=!!s&&e(this).closest("tr");return s&&n.hasClass("sb-pending")?(nt.openAI.train.skip_files.push(n.attr("data-name")),void n.remove()):(i("The training data will be permanently deleted.","alert",()=>{let o=[],r=e(this).attr("id");if(s)o=[n.attr("data-url")];else if("sb-chatbot-delete-all-training"==r)o="all";else if("sb-chatbot-delete-all-training-conversations"==r)o="all-conversations";else{let t=e("sb-chatbot-delete-files"==r?se:ae);t.find("input:checked").length||t.find("input").prop("checked",!0),t.find("tr").each(function(){if(e(this).find("input:checked").length)if(e(this).hasClass("sb-pending"))nt.openAI.train.skip_files.push(e(this).attr("data-name")),e(this).remove();else{let t=e(this).attr("data-url");o.push(t),nt.openAI.train.sitemap_processed_urls.indexOf(t)>-1&&(nt.openAI.train.sitemap_processed_urls[nt.openAI.train.sitemap_processed_urls.indexOf(t)]=!1)}})}if(o.length){if(a(this))return;SBF.ajax({function:"open-ai-embeddings-delete",sources_to_delete:o},s=>{nt.openAI.init(),"all"==o?ie.find('.sb-nav [data-value="info"]').click():"all-conversations"==o&&ie.find('.sb-nav [data-value="conversations"]').click(),!0===s?t("Training data deleted."):i(s),e(this).sbLoading(!1)})}}),!1)}),e(ie).on("click",'.sb-nav [data-value="conversations"]',function(){let e=ie.find("#sb-chatbot-conversations");a(e)||SBF.ajax({function:"open-ai-get-conversation-embeddings"},t=>{if(t.length){let s="";Ve=t;for(var i=0;i<t.length;i++)s+=`<div class="repeater-item" data-value="${t[i].id}" data-index=${i}><div><label>${o("Question")}</label><input data-id="q" type="text" value="${t[i].question}" /></div><div class="sb-qea-repeater-answer"><label>${o("Answer")}</label><textarea data-id="a">${t[i].answer}</textarea></div><i class="sb-icon-close"></i></div>`;e.find(".sb-repeater").html(s)}else e.html(`<p class="sb-no-results">${o("No conversations found.")}</p>`);e.sbLoading(!1)})}),e(ie).on("click",'.sb-nav [data-value="info"]',function(){let e=ie.find("#sb-chatbot-info");a(e)||SBF.ajax({function:"open-ai-get-information"},t=>{let i=[["files","Files"],["website","Website URLs"],["qea","Q&A"],["flows","Flows"],["articles","Articles"],["conversations","Conversations"]],s=`<h2>${o("Sources")}</h2><p>`;for(var a=0;a<i.length;a++)s+=t[i[a][0]]?`${t[i[a][0]][1]} ${o(i[a][1])} (${t[i[a][0]][0]} ${o("chars")})<br>`:"";s+=`</p><h2>${o("Total detected characters")}</h2><p>${t.total} ${o("chars")+(t.limit?" / "+t.limit+" "+o("limit"):"")}</p><hr><div id="sb-chatbot-delete-all-training" class="sb-btn sb-btn-white">${o("Delete all training data")}</div>`,e.html(s),e.sbLoading(!1)})}),e(ie).on("click",".sb-menu-chatbot [data-type]",function(t){let i=e(this).data("type");switch(i){case"flows":case"training":case"playground":let e=ie.find(`> [data-id="${i}"]`);ie.find("> [data-id]").sbActive(!1),e.sbActive(!0),"flows"==i&&e.sbLoading()&&SBF.ajax({function:"open-ai-flows-get"},t=>{for(s=0;s<t.length;s++)t[s]&&t[s].steps&&t[s].name&&nt.openAI.flows.flows.push(t[s]);let i="";for(var s=0;s<t.length;s++)t[s]&&(i+=nt.openAI.flows.navCode(t[s].name,t[s].label));ce.html(i),ce.find("li:first-child").click(),e.sbLoading(!1)});break;case"settings":return ot.open("dialogflow",!0),t.preventDefault,!1}}),e(ae).on("click","[data-url]",function(t){"I"!=t.target.nodeName&&window.open(e(this).attr("data-url"))}),e(ne).on("click",".sb-enlarger-function-calling",function(){e(this).parent().parent().find(".sb-qea-repeater-answer").addClass("sb-hide")}),e(ne).on("change",'[data-id="open-ai-faq-set-data"] select',function(){e(this).parent().next().find("input").setClass("sb-hide",["transcript","transcript_email","human_takeover","archive_conversation"].includes(e(this).val()))}),e(ne).on("input click",'[data-id="open-ai-faq-answer"]',function(){e(this).prev().find("i").sbActive(e(this).val().length>2&&e(this).val().indexOf(" "))}),e(ne).on("click",".sb-qea-repeater-answer > label > i",function(){let t=e(this).closest(".repeater-item").find('[data-id="open-ai-faq-answer"]');a(this)||nt.openAI.rewrite(t.val(),i=>{e(this).sbLoading(!1),i[0]&&t.val(i[1])})}),e(oe).on("click",'[data-value="send"]',function(){let t=oe.find("textarea"),s=t.val().trim(),n=oe.find('[data-value="auto-clear"]').is(".sb-active");if(t.val(""),!a(this)){let t=`<div><div>${o("User")}</div><div><div><div class="sb-cnt"><div class="sb-message">${s}</div></div></div></div></div>`,a=SBF.storage("playground-history");a||(a=[]),a.includes(s)||a.push(s),SBF.storage("playground-history",a),n?le.html(t):le.append(t),le[0].scrollTop=le[0].scrollHeight,SBF.ajax({function:"open-ai-playground-message",message:s,clear:!1===nt.openAI.playground.last_response||n},t=>{if(t.conversation){let e="";for(var s in t.conversation.messages){let i=t.conversation.messages[s];i.message&&(e+=`<div data-type="${i.user_type}" data-message-id="${i.id}"><div>${o(SBF.isAgent(i.user_type)?"Assistant":"User")}<div><i class="sb-icon-close sb-btn-icon sb-btn-red"></i></div></div><div>${new SBMessage(i).getCode()}</div></div>`)}if(le.html(e),le[0].scrollTop=le[0].scrollHeight,t.playground){let e="";for(var s in t.playground.usage)["string","number"].includes(typeof t.playground.usage[s])&&(e+=`<b>${SBF.slugToString(s)}</b>: ${t.playground.usage[s]}<br>`);nt.openAI.playground.last_response=t.playground,ie.find(".sb-playground-info").html(e+`<div id="sb-playground-query" class="sb-btn-text">${o("View code")}</div>${t.playground.embeddings?`<div id="sb-playground-embeddings" class="sb-btn-text">${o("Embeddings")}</div>`:""}`)}}else i(t),console.error(t);e(this).sbLoading(!1)})}}),e(ie).on("click","#sb-playground-query",function(){i("<pre>"+JSON.stringify(nt.openAI.playground.last_response.query,null,4).replaceAll('\\"','"')+"</pre>","info",!1,"sb-playground-query-panel",!1,!0)}),e(ie).on("click","#sb-playground-embeddings",function(){let e="",t=nt.openAI.playground.last_response.embeddings;for(var s=t.length-1;s>-1;s--)e+=`<span><b>${o("Source")}</b>: ${t[s].source?t[s].source.autoLink({target:"_blank"}):""}<br><b>${o("Score")}</b>: ${t[s].score}<br><span>${t[s].text}</span></span>`;i(e,"info",!1,"sb-playground-embeddings-panel",!1,!0)}),e(oe).on("click",'[data-value="clear"]',function(){a(this)||nt.openAI.playground.deleteData("delete",()=>{e(this).sbLoading(!1),le.html(""),ie.find(".sb-playground-info").html("")})}),e(oe).on("click",'[data-value="auto-clear"]',function(){e(this).toggleClass("sb-active")}),e(oe).on("click",'[data-value="history"]',function(){let e,t=SBF.storage("playground-history");t&&t.length?(e="<ul>",t.forEach(t=>{e+=`<li>${t}</li>`}),e+="</ul>"):e=`<p class="sb-no-results">${o("No results found.")}</p>`,re.html(e),re.toggleClass("sb-active")}),e(re).on("click","li",function(){oe.find("textarea").val(e(this).text()),re.sbActive(!1),oe.find('[data-value="send"]').click()}),e(le).on("click",".sb-icon-close",function(){if(!a(this)){let t=e(this).closest("[data-type]");nt.openAI.playground.deleteData("delete-message",()=>{e(this).sbLoading(!1),t.remove()},t.attr("data-message-id"))}}),e(le).on("click",".sb-rich-chips .sb-btn",function(){oe.find("textarea").val(e(this).html()),oe.find('[data-value="send"]').click()}),e(k).on("click","#open-ai-troubleshoot a, #google-troubleshoot a",function(s){let n=e(this).parent().attr("id");return s.preventDefault(),!("google-troubleshoot"!=n&&![!0,"mode"].includes(nt.openAI.troubleshoot()))&&(a(this)?void 0:(SBF.ajax({function:e(this).parent().attr("id")},s=>{!0===s?t("Success. No issues found."):i(s),e(this).sbLoading(!1),e(A).find(".sb-admin-list .sb-select li.sb-active").click()}),!1))}),e(Z).on("click",".ce-settings__button--delete.ce-settings__button--confirm",function(){let e=Z.find(".image-tool--filled img").attr("src");e&&SBF.ajax({function:"delete-file",path:e})}),e(Z).on("click",".ul-articles li",function(t){i("The changes will be lost.","alert",()=>{rt.show(e(this).attr("data-id")),Z.find(".sb-scroll-area:not(.sb-nav)").scrollTop(0)},!1,!1,!1,!qe,()=>{e(this).parent().find("li").sbActive(!1),e(this).parent().find(`[data-id="${rt.activeID()}"]`).sbActive(!0)})}),e(Z).on("click",".ul-categories li",function(t){rt.categories.show(e(this).attr("data-id"))}),e(Z).on("click",".sb-add-article",function(){rt.add()}),e(Z).on("click",".sb-add-category",function(){rt.categories.add()}),e(Z).on("click",".sb-nav i",function(t){let s=e(this).parent(),n=s.closest("ul"),o=n.hasClass("ul-categories");return i(`The ${o?"category":"article"} will be deleted permanently.`,"alert",()=>{let t=s.attr("data-id");if(o)rt.categories.delete(t);else{if(Z.find("#editorjs .image-tool__image-picture").each(function(){SBF.ajax({function:"delete-file",path:e(this).attr("src")})}),!t)return s.remove();a(Q),rt.delete(t,e=>{Q.sbLoading(!1),p(),n.find("li").length>1&&setTimeout(()=>{s.prev().length?s.prev().click():s.next().click(),s.remove()},300)})}}),t.preventDefault(),!1}),e(Z).on("click",".sb-menu-wide li",function(){let t=e(this).data("type");"settings"==t?ot.open("articles",!0):"reports"==t?lt.open("articles-searches"):(Z.attr("data-type",t),rt.categories.update())}),e(Z).on("click",".sb-save-articles",function(){a(this)||("categories"==Z.attr("data-type")?rt.categories.save(t=>{e(this).sbLoading(!1)}):rt.save(t=>{e(this).sbLoading(!1)}))}),e(Z).on("change input","input, textarea, select",function(){qe=!0}),e(ee).on("change",function(){te.val()||(t("Select a parent category first.","error"),e(this).val(""))}),e(Ie).on("click",".sb-nav [id]",function(){let t=e(this).attr("id");lt.active_report=!1,Ie.find("#sb-date-picker").val(""),Ie.attr("class","sb-area-reports sb-active sb-report-"+t),lt.initReport(e(this).attr("id")),SBF.getURL("report")!=t&&f("?report="+t)}),e(Ie).on("change","#sb-date-picker",function(){lt.initReport(!1,e(this).val())}),e(Ie).on("click",".sb-report-export",function(){e(this).sbLoading()||lt.export(t=>{e(this).sbLoading(!1),t&&_(t,"sb-export-report-close","Report exported")})}),SBF.getURL("report")&&(Ie.sbActive()||x.find(".sb-admin-nav #sb-reports").click(),setTimeout(()=>{Ie.find("#"+SBF.getURL("report")).click()},500)),e(A).on("click",".sb-panel-woocommerce > i",function(){nt.woocommerce.conversationPanel()}),e(A).on("click",".sb-woocommerce-orders > div > span",function(t){let i=e(this).parent();e(t.target).is("span")&&(i.sbActive()||nt.woocommerce.conversationPanelOrder(i.attr("data-id")))}),e(A).on("click",".sb-btn-woocommerce",function(){(De.sbLoading()||0!=s()&&s().language!=nt.itemsPanel.panel_language)&&nt.itemsPanel.populate("woocommerce"),Le.find(".sb-search-btn").sbActive(!0).find("input").get(0).focus(),Le.sbTogglePopup(this)}),e(Le).find(".sb-woocommerce-products-list").on("scroll",function(){d(this,!0)&&nt.itemsPanel.pagination(this,"woocommerce")}),e(Le).on("click",".sb-select li",function(){nt.itemsPanel.filter(this,"woocommerce")}),e(Le).on("input",".sb-search-btn input",function(){nt.itemsPanel.search(this,"woocommerce")}),e(Le).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{nt.itemsPanel.search(e(this).next(),"woocommerce")})}),e(Le).on("click",".sb-woocommerce-products-list li",function(){let t=Le.attr("data-action"),i=e(this).data("id");SBF.null(t)?SBChat.insertText(`{product_card id="${i}"}`):(De.sbLoading(!0),A.find(".sb-add-cart-btn").sbLoading(!0),SBChat.sendMessage(-1,"",[],e=>{e&&(nt.woocommerce.conversationPanelUpdate(i),k.sbHideLightbox())},{event:"woocommerce-update-cart",action:"cart-add",id:i})),SBF.deactivateAll(),k.removeClass("sb-popup-active")}),e(A).on("click",".sb-panel-woocommerce .sb-add-cart-btn",function(){e(this).sbLoading()||(SBChat.user_online?(nt.itemsPanel.populate("woocommerce"),Le.sbShowLightbox(!0,"cart-add")):i("The user is offline. Only the carts of online users can be updated."))}),e(A).on("click",".sb-panel-woocommerce .sb-list-items > a > i",function(t){let i=e(this).parent().attr("data-id");return SBChat.sendMessage(-1,"",[],()=>{nt.woocommerce.conversationPanelUpdate(i,"removed")},{event:"woocommerce-update-cart",action:"cart-remove",id:i}),e(this).sbLoading(!0),t.preventDefault(),!1}),e(A).on("click",".sb-integration-calendar-cancel",function(s){return i("The booking will be cancelled.","alert",()=>{a(this)||nt.calendar.cancelBooking(e(this).parent().attr("data-id"),i=>{!0===i&&(e(this).parent().remove(),t("Booking cancelled."))})}),s.preventDefault(),!1}),e(A).on("click",".sb-panel-calendar > i",function(){ot.loadDatePicker(()=>{pt.genericPanel("calendar","Booking",'<input type="text"><div class="sb-split"><div id="sb-calendar-cnt"></div><div id="sb-slot-list"></div></div>',["Add booking"],"",!0),k.find(".sb-calendar-box input").daterangepicker({...ot.getDatePickerSettings(!0,!0),...{parentEl:"#sb-calendar-cnt"}}).click()})}),e(k).on("change",".sb-calendar-box input",function(){let t=k.find("#sb-slot-list");t.html("").sbLoading(!0),nt.calendar.getAvailableSlots(e(this).val(),e=>{let i="";e&&e.forEach(e=>{i+=`<div data-id="${e}">${e}</div>`}),t.html(i||`<p class="sb-no-results">${o("No results found.")}</p>`).sbLoading(!1)})}),e(k).on("click","#sb-add-booking",function(){let i=k.find("#sb-slot-list .sb-active").attr("data-id");k.find(".sb-calendar-box .sb-info").html("").sbActive(!1),i&&!a(this)&&nt.calendar.addBooking(k.find(".sb-calendar-box input").val()+" "+i,i=>{e(this).sbLoading(!1),!0===i?(t("Booking successfully created."),nt.calendar.conversationPanel(),k.sbHideLightbox()):k.find(".sb-calendar-box .sb-info").html(i).sbActive(!0)})}),e(k).on("click","#sb-slot-list > div",function(){e(this).siblings().sbActive(!1),e(this).toggleClass("sb-active")}),e(A).on("click",".sb-panel-ump > i",function(){nt.ump.conversationPanel()}),e(A).on("click",".sb-panel-armember > i",function(){nt.armember.conversationPanel()}),e(A).on("click",".sb-panel-opencart > i",function(){nt.opencart.conversationPanel()}),e(A).on("click",".sb-opencart-orders > a",function(){nt.opencart.openOrder(e(this).attr("data-id"))}),e(W).on("click","#opencart-sync a",function(t){t.preventDefault(),a(this)||SBF.ajax({function:"opencart-sync"},t=>{e(this).sbLoading(!1),i(!0===t?"Users successfully imported.":t)})}),e(W).on("click","#perfex-sync a, #whmcs-sync a, #perfex-articles-sync a, #whmcs-articles-sync a, #aecommerce-sync a, #aecommerce-sync-admins a, #aecommerce-sync-sellers a, #martfury-sync a, #martfury-sync-sellers a",function(t){if(a(this))return;let s=e(this).closest("[id]").attr("id"),n=s.indexOf("article")>0;SBF.ajax({function:s},t=>{!0===t?(n||ct.update(),i(n?"Articles successfully imported.":"Users successfully imported.")):i("Error. Response: "+JSON.stringify(t)),e(this).sbLoading(!1)}),t.preventDefault()}),e(A).on("click","#sb-zendesk-btn",function(t){a(this)||(SBF.ajax({function:"zendesk-create-ticket",conversation_id:SBChat.conversation.id},t=>{!0===t?nt.zendesk.conversationPanel():i("Error. Response: "+JSON.stringify(t)),e(this).sbLoading(!1)}),t.preventDefault())}),e(A).on("click","#sb-zendesk-update-ticket",function(t){if(!a(this))return SBF.ajax({function:"zendesk-update-ticket",conversation_id:SBChat.conversation.id,zendesk_ticket_id:e(this).closest("[data-id]").attr("data-id")},()=>{e(this).sbLoading(!1)}),t.preventDefault(),!1}),e(k).on("click",'[data-id="rating"]',function(){dt.highlightMessage(e(this).attr("data-message-id"))}),e(k).on("click",".sb-enlarger",function(){e(this).sbActive(!0)}),e(k).on("mouseenter","[data-sb-tooltip-init]",function(){e(this).parent().sbInitTooltips(),e(this).removeAttr("data-sb-tooltip-init"),e(this).trigger("mouseenter")}),e(k).on("click",".sb-language-switcher > i",function(){let t=e(this).parent(),i=t.find("[data-language]").map(function(){return e(this).attr("data-language")}).get(),s="";i.push("en");for(var a in SB_LANGUAGE_CODES)i.includes(a)||(s+=`<div data-language="${a}"><img src="${SB_URL}/media/flags/${a}.png" />${o(SB_LANGUAGE_CODES[a])}</div>`);be=t,pt.genericPanel("languages","Choose a language",s,[],' data-source="'+t.attr("data-source")+'"',!0)}),e(k).on("click",".sb-language-switcher img",function(){let t=e(this).parent(),s=t.sbActive(),a=!s&&t.attr("data-language");switch(t.parent().attr("data-source")){case"article-categories":rt.categories.show(rt.categories.activeID(),a);break;case"articles":let e=Q.find(".sb-language-switcher .sb-active");i("The changes will be lost.","alert",()=>{let e=t.attr("data-id");e||s?rt.show(e&&!s?e:rt.activeID(!0)):rt.clear()},!1,!1,!1,!qe,()=>{t.sbActive(!1),e.sbActive(!0)});break;case"automations":ot.automations.show(!1,a);break;case"settings":let n=t.parent().find("[data-language].sb-active");ot.translations.save(t,s?t.attr("data-language"):!!n.length&&n.attr("data-language")),ot.translations.activate(t,a)}t.siblings().sbActive(!1),t.sbActive(!s)}),e(k).on("click",".sb-language-switcher span > i",function(){let t=e(this).parent(),s=t.attr("data-language");i(o("The {T} translation will be deleted.").replace("{T}",o(SB_LANGUAGE_CODES[s])),"alert",()=>{switch(t.parent().attr("data-source")){case"article-categories":rt.categories.translations.delete(s);break;case"articles":rt.translations.delete(s);break;case"automations":ot.automations.deleteTranslation(!1,s),ot.automations.show();break;case"settings":ot.translations.delete(t,s)}t.remove()})}),e(k).on("click",".sb-languages-box [data-language]",function(){let t=e(this).parents().eq(1),s=e(this).attr("data-language"),a=!0;switch(t.attr("data-source")){case"article-categories":rt.categories.translations.add(s);break;case"articles":i("The changes will be lost.","alert",()=>{rt.translations.add(s),k.sbHideLightbox()},!1,!1,!1,!qe),a=!1;break;case"automations":ot.automations.addTranslation(!1,!1,s),ot.automations.show(!1,s);break;case"settings":ot.translations.add(s)}a&&k.sbHideLightbox()}),e(k).on("click",".sb-lightbox .sb-top-bar .sb-close",function(){k.sbHideLightbox()}),e(k).on("click",".sb-lightbox .sb-info",function(){e(this).sbActive(!1)}),e(k).on("click",".sb-dialog-box a",function(){let t=e(this).closest(".sb-lightbox");e(this).hasClass("sb-confirm")&&me(),e(this).hasClass("sb-cancel")&&_e&&_e(),1==k.find(".sb-lightbox.sb-active").length&&ke.sbActive(!1),pt.open_popup=!1,t.sbActive(!1)}),e(k).on("click",".sb-menu-wide li, .sb-nav li",function(){e(this).siblings().sbActive(!1),e(this).sbActive(!0)}),e(k).on("click",".sb-nav:not(.sb-nav-only) li:not(.sb-tab-nav-title)",function(){let t=e(this).closest(".sb-tab"),i=e(t).find(" > .sb-content > div").sbActive(!1).eq(e(this).parent().find("li:not(.sb-tab-nav-title)").index(this));i.sbActive(!0),i.find("textarea").each(function(){e(this).autoExpandTextarea(),e(this).manualExpandTextarea()}),t.find(".sb-scroll-area:not(.sb-nav)").scrollTop(0)}),e(k).sbInitTooltips(),e(k).on("click",'[data-button="toggle"]',function(){let t=k.find("."+e(this).data("show")),i=k.find("."+e(this).data("hide"));t.addClass("sb-show-animation").show(),i.hide(),pt.open_popup=!(!t.hasClass("sb-lightbox")&&!t.hasClass("sb-popup"))&&t}),e(k).on("click",".sb-info-card",function(){e(this).sbActive(!1)}),e(pe).on("change",function(){fe?(fe(),fe=!1):(e(he).sbLoading(e(this).prop("files").length),e(this).sbUploadFiles(t=>{if(e(he).sbLoading(!1),"success"==(t=JSON.parse(t))[0]){"upload-image"==e(he).closest("[data-type]").data("type")&&(e(he).attr("data-value")&&SBF.ajax({function:"delete-file",path:e(he).attr("data-value")}),e(he).attr("data-value",t[1]).css("background-image",`url("${t[1]}")`)),ge&&ge(t[1])}else console.log(t[1])}))}),e(k).on("click",".sb-accordion > div > span",function(t){let i=e(this).parent(),s=e(i).sbActive();e(t.target).is("span")&&(i.siblings().sbActive(!1),i.sbActive(!s))}),e(k).on("mousedown",function(t){if(e(pt.open_popup).length){let i=e(pt.open_popup);i.is(t.target)||0!==i.has(t.target).length||["sb-btn-saved-replies","sb-btn-emoji","sb-btn-woocommerce","sb-btn-shopify","sb-btn-open-ai"].includes(e(t.target).attr("class"))||(i.hasClass("sb-popup")?i.sbTogglePopup():i.hasClass("sb-select")?i.find("ul").sbActive(!1):i.hasClass("sb-menu-mobile")?i.find("i").sbActive(!1):i.hasClass("sb-menu")?i.sbActive(!1):pt.open_popup&&["sb-embeddings-box"].includes(pt.open_popup.attr("id"))||k.sbHideLightbox(),pt.open_popup=!1)}})})}(jQuery),function(e,t){"object"==typeof exports?module.exports=t(e):"function"==typeof define&&define.amd?define("colors",[],function(){return t(e)}):e.Colors=t(e)}(this,function(e,t){function i(e,i,a,n,o){if("string"==typeof i){a=(i=m.txt2color(i)).type,p[a]=i[a],o=o!==t?o:i.alpha}else if(i)for(var c in i)e[a][c]=r(i[c]/l[a][c][1],0,1);return o!==t&&(e.alpha=r(+o,0,1)),s(a,n?e:t)}function s(e,t){var i,s,r,h=t||p,f=m,g=u.options,b=l,v=h.RND,_="",S="",w={hsl:"hsv",rgb:e},y=v.rgb;if("alpha"!==e){for(var k in b)if(!b[k][k]){e!==k&&(S=w[k]||"rgb",h[k]=f[S+"2"+k](h[S])),v[k]||(v[k]={}),i=h[k];for(_ in i)v[k][_]=d(i[_]*b[k][_][1])}y=v.rgb,h.HEX=f.RGB2HEX(y),h.equivalentGrey=g.grey.r*h.rgb.r+g.grey.g*h.rgb.g+g.grey.b*h.rgb.b,h.webSave=s=a(y,51),h.webSmart=r=a(y,17),h.saveColor=y.r===s.r&&y.g===s.g&&y.b===s.b?"web save":y.r===r.r&&y.g===r.g&&y.b===r.b?"web smart":"",h.hueRGB=m.hue2RGB(h.hsv.h),t&&(h.background=function(e,t,i){var s=u.options.grey,a={};return a.RGB={r:e.r,g:e.g,b:e.b},a.rgb={r:t.r,g:t.g,b:t.b},a.alpha=i,a.equivalentGrey=d(s.r*e.r+s.g*e.g+s.b*e.b),a.rgbaMixBlack=o(t,{r:0,g:0,b:0},i,1),a.rgbaMixWhite=o(t,{r:1,g:1,b:1},i,1),a.rgbaMixBlack.luminance=n(a.rgbaMixBlack,!0),a.rgbaMixWhite.luminance=n(a.rgbaMixWhite,!0),u.options.customBG&&(a.rgbaMixCustom=o(t,u.options.customBG,i,1),a.rgbaMixCustom.luminance=n(a.rgbaMixCustom,!0),u.options.customBG.luminance=n(u.options.customBG,!0)),a}(y,h.rgb,h.alpha))}var x,B,A,T=h.rgb,$=h.alpha,I="luminance",C=h.background;return x=o(T,{r:0,g:0,b:0},$,1),x[I]=n(x,!0),h.rgbaMixBlack=x,B=o(T,{r:1,g:1,b:1},$,1),B[I]=n(B,!0),h.rgbaMixWhite=B,g.customBG&&(A=o(T,C.rgbaMixCustom,$,1),A[I]=n(A,!0),A.WCAG2Ratio=function(e,t){var i=1;return i=e>=t?(e+.05)/(t+.05):(t+.05)/(e+.05),d(100*i)/100}(A[I],C.rgbaMixCustom[I]),h.rgbaMixBGMixCustom=A,A.luminanceDelta=c.abs(A[I]-C.rgbaMixCustom[I]),A.hueDelta=function(e,t,i){return(c.max(e.r-t.r,t.r-e.r)+c.max(e.g-t.g,t.g-e.g)+c.max(e.b-t.b,t.b-e.b))*(i?255:1)/765}(C.rgbaMixCustom,A,!0)),h.RGBLuminance=n(y),h.HUELuminance=n(h.hueRGB),g.convertCallback&&g.convertCallback(h,e),h}function a(e,t){var i={},s=0,a=t/2;for(var n in e)s=e[n]%t,i[n]=e[n]+(s>a?t-s:-s);return i}function n(e,t){for(var i=t?1:255,s=[e.r/i,e.g/i,e.b/i],a=u.options.luminance,n=s.length;n--;)s[n]=s[n]<=.03928?s[n]/12.92:c.pow((s[n]+.055)/1.055,2.4);return a.r*s[0]+a.g*s[1]+a.b*s[2]}function o(e,i,s,a){var n={},o=s!==t?s:1,r=a!==t?a:1,l=o+r*(1-o);for(var c in e)n[c]=(e[c]*o+i[c]*r*(1-o))/l;return n.a=l,n}function r(e,t,i){return e>i?i:t>e?t:e}var l={rgb:{r:[0,255],g:[0,255],b:[0,255]},hsv:{h:[0,360],s:[0,100],v:[0,100]},hsl:{h:[0,360],s:[0,100],l:[0,100]},alpha:{alpha:[0,1]},HEX:{HEX:[0,16777215]}},c=e.Math,d=c.round,u={},p={},h={r:.298954,g:.586434,b:.114612},f={r:.2126,g:.7152,b:.0722},g=function(e){this.colors={RND:{}},this.options={color:"rgba(0,0,0,0)",grey:h,luminance:f,valueRanges:l},b(this,e||{})},b=function(e,s){var a,n=e.options;v(e);for(var o in s)s[o]!==t&&(n[o]=s[o]);a=n.customBG,n.customBG="string"==typeof a?m.txt2color(a).rgb:a,p=i(e.colors,n.color,t,!0)},v=function(e){u!==e&&(u=e,p=e.colors)};g.prototype.setColor=function(e,a,n){return v(this),e?i(this.colors,e,a,t,n):(n!==t&&(this.colors.alpha=r(n,0,1)),s(a))},g.prototype.setCustomBackground=function(e){return v(this),this.options.customBG="string"==typeof e?m.txt2color(e).rgb:e,i(this.colors,t,"rgb")},g.prototype.saveAsBackground=function(){return v(this),i(this.colors,t,"rgb",!0)},g.prototype.toString=function(e,t){return m.color2text((e||"rgb").toLowerCase(),this.colors,t)};var m={txt2color:function(e){var t={},i=e.replace(/(?:#|\)|%)/g,"").split("("),s=(i[1]||"").split(/,\s*/),a=i[1]?i[0].substr(0,3):"rgb",n="";if(t.type=a,t[a]={},i[1])for(var o=3;o--;)n=a[o]||a.charAt(o),t[a][n]=+s[o]/l[a][n][1];else t.rgb=m.HEX2rgb(i[0]);return t.alpha=s[3]?+s[3]:1,t},color2text:function(e,t,i){var s=!1!==i&&d(100*t.alpha)/100,a="number"==typeof s&&!1!==i&&(i||1!==s),n=t.RND.rgb,o=t.RND.hsl,r="hex"===e&&a,l="hex"===e&&!r,c="rgb"===e||r?n.r+", "+n.g+", "+n.b:l?"#"+t.HEX:o.h+", "+o.s+"%, "+o.l+"%";return l?c:(r?"rgb":e)+(a?"a":"")+"("+c+(a?", "+s:"")+")"},RGB2HEX:function(e){return((e.r<16?"0":"")+e.r.toString(16)+(e.g<16?"0":"")+e.g.toString(16)+(e.b<16?"0":"")+e.b.toString(16)).toUpperCase()},HEX2rgb:function(e){return e=e.split(""),{r:+("0x"+e[0]+e[e[3]?1:0])/255,g:+("0x"+e[e[3]?2:1]+(e[3]||e[1]))/255,b:+("0x"+(e[4]||e[2])+(e[5]||e[2]))/255}},hue2RGB:function(e){var t=6*e,i=~~t%6,s=6===t?0:t-i;return{r:d(255*[1,1-s,0,0,s,1][i]),g:d(255*[s,1,1,1-s,0,0][i]),b:d(255*[0,0,s,1,1,1-s][i])}},rgb2hsv:function(e){var t,i,s,a=e.r,n=e.g,o=e.b,r=0;return o>n&&(n=o+(o=n,0),r=-1),i=o,n>a&&(a=n+(n=a,0),r=-2/6-r,i=c.min(n,o)),t=a-i,s=a?t/a:0,{h:1e-15>s?p&&p.hsl&&p.hsl.h||0:t?c.abs(r+(n-o)/(6*t)):0,s:a?t/a:p&&p.hsv&&p.hsv.s||0,v:a}},hsv2rgb:function(e){var t=6*e.h,i=e.s,s=e.v,a=~~t,n=t-a,o=s*(1-i),r=s*(1-n*i),l=s*(1-(1-n)*i),c=a%6;return{r:[s,r,o,o,l,s][c],g:[l,s,s,r,o,o][c],b:[o,o,l,s,s,r][c]}},hsv2hsl:function(e){var t=(2-e.s)*e.v,i=e.s*e.v;return i=e.s?1>t?t?i/t:0:i/(2-t):0,{h:e.h,s:e.v||i?i:p&&p.hsl&&p.hsl.s||0,l:t/2}},rgb2hsl:function(e,t){var i=m.rgb2hsv(e);return m.hsv2hsl(t?i:p.hsv=i)},hsl2rgb:function(e){var t=6*e.h,i=e.s,s=e.l,a=.5>s?s*(1+i):s+i-i*s,n=s+s-a,o=~~t,r=a*(a?(a-n)/a:0)*(t-o),l=n+r,c=a-r,d=o%6;return{r:[a,c,n,n,l,a][d],g:[l,a,a,c,n,n][d],b:[n,n,l,a,a,c][d]}}};return g}),function(e,t){"object"==typeof exports?module.exports=t(e,require("jquery"),require("colors")):"function"==typeof define&&define.amd?define(["jquery","colors"],function(i,s){return t(e,i,s)}):t(e,e.jQuery,e.Colors)}(this,function(e,t,i,s){function a(e){return e.value||e.getAttribute("value")||t(e).css("background-color")||"#FFF"}function n(e){return(e=e.originalEvent&&e.originalEvent.touches?e.originalEvent.touches[0]:e).originalEvent?e.originalEvent:e}function o(e){return t(e.find(f.doRender)[0]||e[0])}function r(i){var s=t(this),n=s.offset(),r=t(e),u=f.gap;i?(g=o(s),g._colorMode=g.data("colorMode"),p.$trigger=s,(b||l()).css(f.positionCallback.call(p,s)||{left:(b._left=n.left)-((b._left+=b._width-(r.scrollLeft()+r.width()))+u>0?b._left+u:0),top:(b._top=n.top+s.outerHeight())-((b._top+=b._height-(r.scrollTop()+r.height()))+u>0?b._top+u:0)}).show(f.animationSpeed,function(){!0!==i&&(w.toggle(!!f.opacity)._width=w.width(),m._width=m.width(),m._height=m.height(),v._height=v.height(),h.setColor(a(g[0])),d(!0))}).off(".tcp").on(A,".cp-xy-slider,.cp-z-slider,.cp-alpha",c)):p.$trigger&&t(b).hide(f.animationSpeed,function(){d(!1),p.$trigger=null}).off(".tcp")}function l(){return t("head")[f.cssPrepend?"prepend":"append"]('<style type="text/css" id="tinyColorPickerStyles">'+(f.css||F)+(f.cssAddon||"")+"</style>"),t(C).css({margin:f.margin}).appendTo("body").show(0,function(){p.$UI=b=t(this),$=f.GPU&&b.css("perspective")!==s,v=t(".cp-z-slider",this),m=t(".cp-xy-slider",this),_=t(".cp-xy-cursor",this),S=t(".cp-z-cursor",this),w=t(".cp-alpha",this),y=t(".cp-alpha-cursor",this),f.buildCallback.call(p,b),b.prepend("<div>").children().eq(0).css("width",b.children().eq(0).width()),b._width=this.offsetWidth,b._height=this.offsetHeight}).hide()}function c(e){var i=this.className.replace(/cp-(.*?)(?:\s*|$)/,"$1").replace("-","_");(e.button||e.which)>1||(e.preventDefault&&e.preventDefault(),e.returnValue=!1,g._offset=t(this).offset(),(i="xy_slider"===i?function(e){var t=n(e),i=t.pageX-g._offset.left,s=t.pageY-g._offset.top;h.setColor({s:i/m._width*100,v:100-s/m._height*100},"hsv")}:"z_slider"===i?function(e){var t=n(e).pageY-g._offset.top;h.setColor({h:360-t/v._height*360},"hsv")}:function(e){var t=(n(e).pageX-g._offset.left)/w._width;h.setColor({},"rgb",t)})(e),d(),k.on(T,function(){k.off(".tcp")}).on(B,function(e){i(e),d()}))}function d(e){var t=h.colors,i=t.hueRGB,a=(t.RND.rgb,t.RND.hsl,f.dark),n=f.light,o=h.toString(g._colorMode,f.forceAlpha),r=t.HUELuminance>.22?a:n,l=t.rgbaMixBlack.luminance>.22?a:n,c=(1-t.hsv.h)*v._height,d=t.hsv.s*m._width,p=(1-t.hsv.v)*m._height,b=t.alpha*w._width,k=$?"translate3d":"",x=g[0].value,B=g[0].hasAttribute("value")&&""===x&&e!==s;m._css={backgroundColor:"rgb("+i.r+","+i.g+","+i.b+")"},_._css={transform:k+"("+d+"px, "+p+"px, 0)",left:$?"":d,top:$?"":p,borderColor:t.RGBLuminance>.22?a:n},S._css={transform:k+"(0, "+c+"px, 0)",top:$?"":c,borderColor:"transparent "+r},w._css={backgroundColor:"#"+t.HEX},y._css={transform:k+"("+b+"px, 0, 0)",left:$?"":b,borderColor:l+" transparent"},g._css={backgroundColor:B?"":o,color:B?"":t.rgbaMixBGMixCustom.luminance>.22?a:n},g.text=B?"":x!==o?o:"",e!==s?u(e):I(u)}function u(e){m.css(m._css),_.css(_._css),S.css(S._css),w.css(w._css),y.css(y._css),f.doRender&&g.css(g._css),g.text&&g.val(g.text),f.renderCallback.call(p,g,"boolean"==typeof e?e:s)}var p,h,f,g,b,v,m,_,S,w,y,k=t(document),x=t(),B="touchmove.tcp mousemove.tcp pointermove.tcp",A="touchstart.tcp mousedown.tcp pointerdown.tcp",T="touchend.tcp mouseup.tcp pointerup.tcp",$=!1,I=e.requestAnimationFrame||e.webkitRequestAnimationFrame||function(e){e()},C='<div class="cp-color-picker"><div class="cp-z-slider"><div class="cp-z-cursor"></div></div><div class="cp-xy-slider"><div class="cp-white"></div><div class="cp-xy-cursor"></div></div><div class="cp-alpha"><div class="cp-alpha-cursor"></div></div></div>',F=".cp-color-picker{position:absolute;overflow:hidden;padding:6px 6px 0;background-color:#444;color:#bbb;font-family:Arial,Helvetica,sans-serif;font-size:12px;font-weight:400;cursor:default;border-radius:5px}.cp-color-picker>div{position:relative;overflow:hidden}.cp-xy-slider{float:left;height:128px;width:128px;margin-bottom:6px;background:linear-gradient(to right,#FFF,rgba(255,255,255,0))}.cp-white{height:100%;width:100%;background:linear-gradient(rgba(0,0,0,0),#000)}.cp-xy-cursor{position:absolute;top:0;width:10px;height:10px;margin:-5px;border:1px solid #fff;border-radius:100%;box-sizing:border-box}.cp-z-slider{float:right;margin-left:6px;height:128px;width:20px;background:linear-gradient(red 0,#f0f 17%,#00f 33%,#0ff 50%,#0f0 67%,#ff0 83%,red 100%)}.cp-z-cursor{position:absolute;margin-top:-4px;width:100%;border:4px solid #fff;border-color:transparent #fff;box-sizing:border-box}.cp-alpha{clear:both;width:100%;height:16px;margin:6px 0;background:linear-gradient(to right,#444,rgba(0,0,0,0))}.cp-alpha-cursor{position:absolute;margin-left:-4px;height:100%;border:4px solid #fff;border-color:#fff transparent;box-sizing:border-box}",E=function(e){h=this.color=new i(e),f=h.options,p=this};E.prototype={render:d,toggle:r},t.fn.colorPicker=function(i){var s=this,n=function(){};return i=t.extend({animationSpeed:150,GPU:!0,doRender:!0,customBG:"#FFF",opacity:!0,renderCallback:n,buildCallback:n,positionCallback:n,body:document.body,scrollResize:!0,gap:4,dark:"#222",light:"#DDD"},i),!p&&i.scrollResize&&t(e).on("resize.tcp scroll.tcp",function(){p.$trigger&&p.toggle.call(p.$trigger[0],!0)}),x=x.add(this),this.colorPicker=p||new E(i),this.options=i,t(i.body).off(".tcp").on(A,function(e){-1===x.add(b).add(t(b).find(e.target)).index(e.target)&&r()}),this.on("focusin.tcp click.tcp",function(e){p.color.options=t.extend(p.color.options,f=s.options),r.call(this,e)}).on("change.tcp",function(){h.setColor(this.value||"#FFF"),s.colorPicker.render(!0)}).each(function(){var e=a(this),s=e.split("("),n=o(t(this));n.data("colorMode",s[1]?s[0].substr(0,3):"HEX").attr("readonly",f.preventFocus),i.doRender&&n.css({"background-color":e,color:function(){return h.setColor(e).rgbaMixBGMixCustom.luminance>.22?i.dark:i.light}})})},t.fn.colorPicker.destroy=function(){t("*").off(".tcp"),p.toggle(!1),x=t()}});